<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ckJava</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ckjava.com/"/>
  <updated>2019-07-23T14:16:01.055Z</updated>
  <id>http://ckjava.com/</id>
  
  <author>
    <name>ck</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Java 中 JVM 参数和系统属性的读取与设置</title>
    <link href="http://ckjava.com/2019/07/23/Java-jvm-system-properties-read-write-practice/"/>
    <id>http://ckjava.com/2019/07/23/Java-jvm-system-properties-read-write-practice/</id>
    <published>2019-07-22T16:00:00.000Z</published>
    <updated>2019-07-23T14:16:01.055Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>打开 Java VisualVM，在每个 JVM 中都可以发现 JVM 参数和系统属性两个 tab 视图，信息非常丰富，这里介绍一下如何在程序中获取这些内容，以及如何设置新的内容。</p><h2 id="2-JVM-参数"><a href="#2-JVM-参数" class="headerlink" title="2 JVM 参数"></a>2 JVM 参数</h2><h4 id="2-1-获取"><a href="#2-1-获取" class="headerlink" title="2.1 获取"></a>2.1 获取</h4><p>这里通过 <code>java.lang.management.ManagementFactory</code> 对象来获取，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; inputArguments = ManagementFactory.getRuntimeMXBean().getInputArguments();</span><br><span class="line">inputArguments.forEach(str -&gt; System.out.println(str));</span><br></pre></td></tr></table></figure><p>部分内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-agentlib:jdwp=transport=dt_socket,address=127.0.0.1:65016,suspend=y,server=n</span><br><span class="line">-Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure><h2 id="2-2-设置"><a href="#2-2-设置" class="headerlink" title="2.2 设置"></a>2.2 设置</h2><ol><li>在 IDE 的 VM options 中输入如下内容</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xmx1024m</span><br><span class="line">-Xms1024m</span><br><span class="line">-Dspring.profiles.active=dev</span><br></pre></td></tr></table></figure><ol start="2"><li>或者在用 java 命令启动可执行 jar 的时候指定</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx1024m -Xms1024m -Dspring.profiles.active=pro -jar userProject.jar</span><br></pre></td></tr></table></figure><p>都可以修改 JVM 参数。</p><h2 id="3-系统属性"><a href="#3-系统属性" class="headerlink" title="3 系统属性"></a>3 系统属性</h2><h4 id="3-1-获取"><a href="#3-1-获取" class="headerlink" title="3.1 获取"></a>3.1 获取</h4><p>通过 <code>java.lang.System</code> 对象来获取，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.getProperties().forEach((key, value) -&gt; System.out.println(String.format(&quot;%s=%s&quot;, key, value)));</span><br></pre></td></tr></table></figure><p>部分内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">os.name=Windows 10</span><br><span class="line">user.variant=</span><br><span class="line">java.vm.specification.vendor=Oracle Corporation</span><br><span class="line">line.separator=</span><br><span class="line"></span><br><span class="line">java.endorsed.dirs=C:\Program Files\Java\jdk1.8.0_121\jre\lib\endorsed</span><br><span class="line">user.country=CN</span><br><span class="line">user.script=</span><br><span class="line">sun.java.launcher=SUN_STANDARD</span><br><span class="line">sun.os.patch.level=</span><br><span class="line">java.vm.name=Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">file.encoding.pkg=sun.io</span><br><span class="line">path.separator=;</span><br><span class="line">java.vm.vendor=Oracle Corporation</span><br><span class="line">java.vendor.url=http://java.oracle.com/</span><br><span class="line">sun.boot.library.path=C:\Program Files\Java\jdk1.8.0_121\jre\bin</span><br><span class="line">java.vm.version=25.121-b13</span><br><span class="line">java.runtime.name=Java(TM) SE Runtime Environment</span><br></pre></td></tr></table></figure><h4 id="3-2-设置"><a href="#3-2-设置" class="headerlink" title="3.2 设置"></a>3.2 设置</h4><p>设置系统属性如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Properties properties = System.getProperties();</span><br><span class="line">properties.put(<span class="string">"user.env"</span>, <span class="string">"FAT"</span>);</span><br><span class="line">properties.forEach((key, value) -&gt; System.out.println(String.format(<span class="string">"%s=%s"</span>, key, value)));</span><br></pre></td></tr></table></figure><p>打印后的内容中会多出 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.env=FAT</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Java 中 JVM 参数和系统属性的读取与设置
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>关于 npm 的基本使用</title>
    <link href="http://ckjava.com/2019/07/22/npm-registry-proxy-install-usage/"/>
    <id>http://ckjava.com/2019/07/22/npm-registry-proxy-install-usage/</id>
    <published>2019-07-21T16:00:00.000Z</published>
    <updated>2019-07-22T14:15:14.256Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文介绍 npm 依赖的安装，卸载。以及通过设置镜像和代理来安装。</p><h2 id="2-镜像-registry"><a href="#2-镜像-registry" class="headerlink" title="2 镜像 registry"></a>2 镜像 registry</h2><h4 id="2-1-全局镜像维护"><a href="#2-1-全局镜像维护" class="headerlink" title="2.1 全局镜像维护"></a>2.1 全局镜像维护</h4><ol><li>获取当前镜像，默认是: <a href="https://registry.npmjs.org" target="_blank" rel="noopener">https://registry.npmjs.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure><ol start="2"><li>设置镜像为 <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><ol start="3"><li>删除镜像 <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config delete registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h4 id="2-2-局部镜像"><a href="#2-2-局部镜像" class="headerlink" title="2.2 局部镜像"></a>2.2 局部镜像</h4><p>局部镜像是指在安装某个依赖的时候临时使用镜像</p><ol><li>下面通过淘宝的 NPM 镜像 <code>https://registry.npm.taobao.org</code> 来安装 <code>node-sass</code> 组件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h4 id="2-3-镜像地址"><a href="#2-3-镜像地址" class="headerlink" title="2.3 镜像地址"></a>2.3 镜像地址</h4><ul><li>淘宝 npm 镜像</li></ul><ol><li>搜索地址：<a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a></li><li>registry 地址：<a href="http://registry.npm.taobao.org/" target="_blank" rel="noopener">http://registry.npm.taobao.org/</a></li></ol><ul><li>cnpmjs 镜像</li></ul><ol><li>搜索地址：<a href="http://cnpmjs.org/" target="_blank" rel="noopener">http://cnpmjs.org/</a></li><li>registry地址：<a href="http://r.cnpmjs.org/" target="_blank" rel="noopener">http://r.cnpmjs.org/</a></li></ol><h2 id="3-代理-proxy"><a href="#3-代理-proxy" class="headerlink" title="3 代理 proxy"></a>3 代理 proxy</h2><ol><li>设置代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy=http://127.0.0.1:8087</span><br><span class="line">npm config set https-proxy http://server:port</span><br></pre></td></tr></table></figure><ol start="2"><li>使用用户名和密码设置代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy http://username:password@server:port</span><br><span class="line">npm confit set https-proxy http://username:password@server:port</span><br></pre></td></tr></table></figure><ol start="3"><li>删除代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure><ol start="4"><li>获取当前代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config get proxy</span><br><span class="line">npm config get https-proxy</span><br></pre></td></tr></table></figure><h2 id="4-依赖的安装和卸载"><a href="#4-依赖的安装和卸载" class="headerlink" title="4 依赖的安装和卸载"></a>4 依赖的安装和卸载</h2><h4 id="4-1-安装依赖"><a href="#4-1-安装依赖" class="headerlink" title="4.1 安装依赖"></a>4.1 安装依赖</h4><p>基本安装命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i angular-ui-select</span><br></pre></td></tr></table></figure><ol><li><code>i</code> 或者 <code>install</code> 表示安装</li><li><code>-g</code> 或者 <code>--global</code> 选项表示全局安装： <code>npm i -g angular-ui-select</code> <ul><li>带上表示会安装到 npm 组件所在的目录下的 node_modules 文件夹下</li><li>不带表示仅安装到当前目录的 node_modules 文件夹下</li></ul></li><li>带上 <a href="mailto:angular-ui-select@0.19.8" target="_blank" rel="noopener">angular-ui-select@0.19.8</a> 表示安装指定版本的包</li><li><code>-S</code> 或者 <code>--save</code> 选项表示增加在 package.json 中 dependencies 下的对应信息</li><li><code>-D</code> 或者 <code>--save-dev</code> 选项表示增加在 package.json 中 devDependencies 下的对应信息</li><li><code>-O</code> 或者 <code>--save-optional</code> 选项表示增加在 package.json 中 optionalDependencies 下的对应信息</li><li><code>-B</code> 或者 <code>--save-bundle</code> 选项表示增加在 package.json 中 bundleDependencies 下的对应信息</li></ol><h4 id="4-2-卸载依赖"><a href="#4-2-卸载依赖" class="headerlink" title="4.2 卸载依赖"></a>4.2 卸载依赖</h4><p>基本删除命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uni angular-ui-select</span><br></pre></td></tr></table></figure><p>删除本地模块时你应该思考的问题：是否将在 package.json 上的相应依赖信息也消除？</p><ol><li><code>uni</code> 或者 <code>uninstall</code> 选项表示默认删除模块，但不删除留在 package.json 中的对应信息</li><li><code>-g</code> 或者 <code>--global</code> 选项表示全局删除</li><li><code>-S</code> 或者 <code>--save</code> 选项表示删除在 package.json 中 dependencies 下的对应信息</li><li><code>-D</code> 或者 <code>--save-dev</code> 选项表示删除在 package.json 中 devDependencies 下的对应信息</li><li><code>-O</code> 或者 <code>--save-optional</code> 选项表示删除在 package.json 中 optionalDependencies 下的对应信息</li><li><code>-B</code> 或者 <code>--save-bundle</code> 选项表示删除在 package.json 中 bundleDependencies 下的对应信息</li></ol><h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5 参考"></a>5 参考</h2><ul><li><a href="https://www.npmjs.com/" target="_blank" rel="noopener">npmjs 官网</a></li><li><a href="http://www.cnblogs.com/penghuwan/p/6973702.html" target="_blank" rel="noopener">【npm】利用npm安装/删除/发布/更新/撤销发布包</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文介绍 npm 依赖的安装，卸载。以及通过设置镜像和代理来安装。
    
    </summary>
    
      <category term="npm" scheme="http://ckjava.com/categories/npm/"/>
    
    
      <category term="npm" scheme="http://ckjava.com/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>深入分析 AngularJS 中 href 属性值由 javascript_void(0) 自动转成 unsafe_javascript_void(0) 的问题</title>
    <link href="http://ckjava.com/2019/07/22/AngularJS-href-unsafe-javascript-void/"/>
    <id>http://ckjava.com/2019/07/22/AngularJS-href-unsafe-javascript-void/</id>
    <published>2019-07-21T16:00:00.000Z</published>
    <updated>2019-07-22T14:05:28.144Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>原始的 html 如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>AngularJS 编译后如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"unsafe:javascript:void(0)"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(p)"</span> <span class="attr">class</span>=<span class="string">"ng-binding"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在 Firefox Quantum 68.0.1 (64 位) 中提示 <code>unsafe:javascript:void(0)</code>，点击后浏览器地址栏为：<code>unsafe:javascript:void(0)</code>，页面内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">无法理解该网址</span><br><span class="line"></span><br><span class="line">Firefox 不知道如何打开这个地址，因为协议 (unsafe) 未与任何程序关联，或此环境下不可打开该协议的地址。</span><br><span class="line"></span><br><span class="line">    您可能需要安装其他软件才能打开此网址。</span><br></pre></td></tr></table></figure><h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2 原因"></a>2 原因</h2><p>这里先思考一个问题：为什么 href 和 ng-click 中的表达式都会执行，有先后顺序吗？</p><ul><li>a 链接元素点击后通过 href 和 target 属性可以跳转到指定的页面，如果不需要跳转通过设置: <code>href=&quot;javascript:void(0)&quot;</code> 即可</li><li><code>href=&quot;javascript:void(0)&quot;</code> 表示不进行页面跳转而是执行 <code>void(0)</code> 的 javascript 方法，该方法只是用来计算一个空值，事情都不做</li><li>ng-click 属性可以让点击 a 链接元素后触发一个点击事件，执行一个函数，其属性值为一个函数名称</li><li>a 链接元素中 onclick、href、target 在不同浏览器下的处理顺序如下：<ul><li>chrome 下是 onclick、href、target</li><li>ie和firefox 下是 onclick、target、href</li></ul></li></ul><p>再回到上面的问题，由于 AngularJS 编译后自动加上了 <code>unsafe:</code> 前缀，变成了 <code>unsafe:javascript:void(0)</code>，因此 Firefox 无法识别这个协议，所以无法执行 <code>void(0)</code> 这个函数，浏览器地址栏变成了：<code>unsafe:javascript:void(0)</code>，说明进行了跳转，这里可以通过加上 <code>target=&quot;_blank&quot;</code> 属性验证这一点。</p><p>在 Chrome 上没有这个问题，是因为 Chrome 能够识别这个 unsafe 协议。</p><p>由此可见，Firefox 和 Chrome 在一些标准上开始出现了不一致的情况，以后这种情况可能会越来越多。</p><h2 id="3-解决方法"><a href="#3-解决方法" class="headerlink" title="3 解决方法"></a>3 解决方法</h2><p>根据上面的原因分析，我们可以通过两种方法来解决这个问题：</p><ol><li>方法一：直接去掉 href 属性</li><li>方法二：让 AngularJS 不会修改 href 属性值</li></ol><p>具体如下</p><h4 id="3-1-方法一：直接去掉-href-属性"><a href="#3-1-方法一：直接去掉-href-属性" class="headerlink" title="3.1 方法一：直接去掉 href 属性"></a>3.1 方法一：直接去掉 href 属性</h4><p>直接去掉 href 属性，修改成如下的方式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"cursor: pointer"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中 <code>style=&quot;cursor: pointer&quot;</code> 可以让 a 链接元素拥有可点击样式，看起来的效果和 href 属性一样。</p><h4 id="3-2-让-AngularJS-不会修改-href-属性值"><a href="#3-2-让-AngularJS-不会修改-href-属性值" class="headerlink" title="3.2 让 AngularJS 不会修改 href 属性值"></a>3.2 让 AngularJS 不会修改 href 属性值</h4><p>配置编译白名单，让 AngularJS 不会编译 href 属性值中含有正则表达式：<code>/^\s*(https?|ftp|mailto|tel|file|sms|javascript):/</code> 指定的内容，具体如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstApp = angular.module(<span class="string">'firstApp'</span>, []);</span><br><span class="line">firstApp.config([<span class="string">'$compileProvider'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">$compileProvider</span>) </span>&#123;</span><br><span class="line">    $compileProvider.aHrefSanitizationWhitelist(<span class="regexp">/^\s*(https?|ftp|mailto|tel|file|sms|javascript):/</span>); <span class="comment">// 此处是正则表达式</span></span><br><span class="line">    <span class="comment">// Angular v1.2 之前使用 $compileProvider.urlSanitizationWhitelist(...)</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure><h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><ul><li>实际上这里使用 a 链接元素的目的在于：让待点击的元素拥有一个 a 链接元素的可点击样式，在 css2 中通过 <code>style=&quot;cursor: hand&quot;</code> 可以实现，在 css3 以上可以通过 <code>style=&quot;cursor: pointer&quot;</code> 实现，也就是上面的方法一</li><li>如果依赖的框架中有些 a 链接元素中既有 href 和 ng-click，那么只能通过方法二来解决</li></ul>]]></content>
    
    <summary type="html">
    
      深入分析 AngularJS 中 href 属性值由 javascript_void(0) 自动转成 unsafe_javascript_void(0) 的问题，最后提出两个解决方法。
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS 下拉框组件 ui-select 使用介绍</title>
    <link href="http://ckjava.com/2019/06/27/AngularJS-ui-select-practice/"/>
    <id>http://ckjava.com/2019/06/27/AngularJS-ui-select-practice/</id>
    <published>2019-06-26T16:00:00.000Z</published>
    <updated>2019-06-27T13:25:09.270Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>一般情况下在 AngularJS 中使用 select 的方式如下</p><ol><li>在 Controller 中定义下拉框选项值</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$scope.envOptions = [</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'fat'</span>, <span class="attr">value</span>: <span class="string">'FAT'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'fws'</span>, <span class="attr">value</span>: <span class="string">'FWS'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'uat'</span>, <span class="attr">value</span>: <span class="string">'UAT'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'prd'</span>, <span class="attr">value</span>: <span class="string">'PRD'</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">$scope.onEnvChange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>在页面上使用如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>环境<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"increment.env"</span> <span class="attr">ng-change</span>=<span class="string">"onEnvChange()"</span> <span class="attr">class</span>=<span class="string">"form-control input-group-sm"</span> <span class="attr">ng-init</span>=<span class="string">"increment.env = 'fat'"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">ng-repeat</span>=<span class="string">"item in envOptions"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;item.key&#125;&#125;"</span>&gt;</span>&#123;&#123;item.value&#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果要更加复杂的效果怎么办，比如输入一个字符自动加载相关的选项？下面来一一介绍 ui-select 的安装与具体的使用。</p><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2 安装"></a>2 安装</h2><ul><li>npm 依赖 <a href="https://www.npmjs.com/package/ui-select" target="_blank" rel="noopener">AngularJS ui-select</a></li><li>npm 安装： <code>npm i ui-select -S</code></li><li>复制到 <code>app\lib</code> 目录下</li><li>index.html 引入: <ul><li><code>&lt;script src=&quot;lib/ui-select/dist/select.js&quot;&gt;&lt;/script&gt;</code></li><li><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;lib/ui-select/dist/select.css&quot;&gt;</code></li></ul></li><li>js 的 module 中引入</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'myApp'</span>, [</span><br><span class="line">    <span class="string">'ui.select'</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><h2 id="3-基本使用"><a href="#3-基本使用" class="headerlink" title="3 基本使用"></a>3 基本使用</h2><p>ui-select 指令包含了如下几个指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ui-select</span><br><span class="line">ui-select-match</span><br><span class="line">ui-select-header</span><br><span class="line">ui-select-choices</span><br><span class="line">ui-select-no-choice</span><br><span class="line">ui-select-footer</span><br><span class="line">uis-open-close</span><br></pre></td></tr></table></figure><p>基本的使用格式如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ui-select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-match</span>&gt;</span><span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-header</span>&gt;</span>Top of the list!<span class="tag">&lt;/<span class="name">ui-select-header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-choices</span>&gt;</span><span class="tag">&lt;<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-footer</span>&gt;</span>Bottom of the list.<span class="tag">&lt;/<span class="name">ui-select-footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-ui-select"><a href="#3-1-ui-select" class="headerlink" title="3.1 ui-select"></a>3.1 ui-select</h4><ul><li>使用 <code>theme=&quot;select2&quot;</code> 主题</li></ul><h4 id="3-2-ui-select-choices"><a href="#3-2-ui-select-choices" class="headerlink" title="3.2 ui-select-choices"></a>3.2 ui-select-choices</h4><ul><li>通过 <code>refresh=&quot;searchApp($select)&quot;</code> 和 <code>refresh-delay=&quot;300&quot;</code> 动态从后端 api 搜索下拉选项</li></ul><h4 id="3-3-设置通用属性"><a href="#3-3-设置通用属性" class="headerlink" title="3.3 设置通用属性"></a>3.3 设置通用属性</h4><ul><li>通过 uiSelectConfig 对象</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular.module(<span class="string">'myApp.pages.index'</span>, [<span class="string">'ui.router'</span>, <span class="string">'daterangepicker'</span>, <span class="string">'angular-uuid'</span>, <span class="string">'ui.select'</span>, <span class="string">'ngSanitize'</span>])</span><br><span class="line">        .config(pageConfig);</span><br><span class="line">    <span class="comment">/** @ngInject */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pageConfig</span>(<span class="params">$stateProvider, uiSelectConfig</span>) </span>&#123;</span><br><span class="line">        $stateProvider.state(<span class="string">'index'</span>, &#123;</span><br><span class="line">            url: <span class="string">'/index'</span>,</span><br><span class="line">            templateUrl: <span class="string">'pages/index/manage/searchIndex.html'</span>,</span><br><span class="line">            controller: <span class="string">'MyAppCtrl'</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 ui.select 的通用属性</span></span><br><span class="line">        uiSelectConfig.theme = <span class="string">'select2'</span>;</span><br><span class="line">        uiSelectConfig.resetSearchInput = <span class="literal">false</span>;</span><br><span class="line">        uiSelectConfig.appendToBody = <span class="literal">true</span>;</span><br><span class="line">        uiSelectConfig.searchEnabled = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h4 id="3-4-html-部分"><a href="#3-4-html-部分" class="headerlink" title="3.4 html 部分"></a>3.4 html 部分</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>appId<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ui-select</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ng-model</span>=<span class="string">"myApp.app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">"app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">theme</span>=<span class="string">"select2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">append-to-body</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">search-enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">reset-search-input</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ng-disabled</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"width: 300px;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">title</span>=<span class="string">"选择一个app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ui-select-match</span> <span class="attr">placeholder</span>=<span class="string">"按照 app 的 id，名称，描述进行搜索"</span>&gt;</span></span><br><span class="line">                &#123;&#123;$select.selected.appId&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">refresh</span>=<span class="string">"searchApp($select)"</span> <span class="attr">refresh-delay</span>=<span class="string">"300"</span> <span class="attr">repeat</span>=<span class="string">"app in searchRes track by $index"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.appId | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h6</span>&gt;</span></span><br><span class="line">                    appName: &#123;&#123;app.appName&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    description: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.description | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>append-to-body=”true” 将下拉列表框追加到输入框下面</li><li>search-enabled=”true” 支持搜索下拉框中的内容</li><li>reset-search-input=”false” 选择一个选项后清除搜索输入框中的内容</li><li>其中 <code>ng-bind-html</code> 需要依赖 ngSanitize 模块</li></ul><h4 id="3-5-js-部分"><a href="#3-5-js-部分" class="headerlink" title="3.5 js 部分"></a>3.5 js 部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认选择</span></span><br><span class="line">$scope.searchRes = [&#123;<span class="string">"appId"</span>:<span class="string">"123456"</span>,<span class="string">"appName"</span>:<span class="string">"userService"</span>,<span class="string">"name"</span>:<span class="string">"用户信息服务"</span>,<span class="string">"description"</span>:<span class="string">"用户信息服务"</span>&#125;];</span><br><span class="line">$scope.myApp.app = $scope.searchRes[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">$scope.searchApp = <span class="function"><span class="keyword">function</span>(<span class="params">$select</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!$select.search) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    MyAppService.doSearchApp($select.search)</span><br><span class="line">        .then(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                $scope.searchRes = value.data;</span><br><span class="line">            &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">'searchApp has error, value:'</span> + <span class="built_in">JSON</span>.stringify(value));</span><br><span class="line">                toastr.error(<span class="string">'searchApp has error'</span>, <span class="string">'提示'</span>, $scope.notificationConfig);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"searchApp has error"</span> + e.toString());</span><br><span class="line">        &#125;)</span><br><span class="line">        .finally(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'searchApp finally'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSearchApp</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = $q.defer();</span><br><span class="line"></span><br><span class="line">    $http.get($localStorage.sysInfo[<span class="string">'api_base'</span>] + urls.SLASH + urls.APP_SEARCH, &#123; <span class="attr">params</span> : &#123;<span class="string">'keyword'</span>: keyword &#125; &#125;)</span><br><span class="line">        .then(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'doSearchApp successfully'</span>);</span><br><span class="line">                deferred.resolve(&#123;</span><br><span class="line">                    data: response.data.data</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">errResponse</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">'error doSearchApp, errResponse = '</span> + <span class="built_in">JSON</span>.stringify(errResponse));</span><br><span class="line">                deferred.reject(errResponse);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="4 使用场景"></a>4 使用场景</h2><h4 id="4-1-如何清空已经选择的选项"><a href="#4-1-如何清空已经选择的选项" class="headerlink" title="4.1 如何清空已经选择的选项"></a>4.1 如何清空已经选择的选项</h4><ol><li>如果使用的是 <code>select2</code> 主题，可以在 <code>ui-select-match</code> 元素中增加 <code>allow-clear=&quot;true&quot;</code> 属性，选择选项后右边会增加一个 <code>x</code> 图标，点击该图标就会清空已经选择的选项，具体如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ui-select-match allow-clear=<span class="string">"true"</span> placeholder=<span class="string">"Select or search a country in the list..."</span>&gt;</span><br><span class="line">&lt;span&gt;&#123;&#123;$select.selected.name&#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/ui</span>-select-match&gt;</span><br></pre></td></tr></table></figure><p>注意：<strong>点击 <code>x</code> 图标后会触发 ui-select 的 on-select 事件</strong></p><ol start="2"><li>手动在 <code>ui-select-match</code> 元素内增加一个 <code>x</code> 图标，并定义处理逻辑，具体如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ui-select-match placeholder=<span class="string">"Select or search a country in the list..."</span>&gt;</span><br><span class="line">&lt;span&gt;&#123;&#123;$select.selected.name&#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;button class="clear" ng-click="clear($event)"&gt;&lt;span class="fa fa-remove"&gt;&lt;/</span>span&gt;<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/ui-select-match&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>clear 函数如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$scope.clear = <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</span><br><span class="line">   $event.stopPropagation(); </span><br><span class="line">   $scope.country.selected = <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>参考 <a href="https://stackoverflow.com/questions/26389542/clear-selected-option-in-ui-select-angular" target="_blank" rel="noopener">Clear selected option in ui-select angular</a>    </li></ul><h4 id="4-2-搜索选项的时候从-http-api-获取数据"><a href="#4-2-搜索选项的时候从-http-api-获取数据" class="headerlink" title="4.2 搜索选项的时候从 http api 获取数据"></a>4.2 搜索选项的时候从 http api 获取数据</h4><ol><li>在 <code>ui-select-choices</code> 元素中增加 <code>refresh=&quot;searchApp($select)&quot;</code> 和 <code>refresh-delay=&quot;300&quot;</code> 属性，具体如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">refresh</span>=<span class="string">"searchApp($select)"</span> <span class="attr">refresh-delay</span>=<span class="string">"300"</span> <span class="attr">repeat</span>=<span class="string">"app in searchRes track by $index"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.appId | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span></span><br><span class="line">appName: &#123;&#123;app.appName&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">description: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.description | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>searchApp 函数如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$scope.searchApp = <span class="function"><span class="keyword">function</span>(<span class="params">$select</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!$select.search) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">MyAppService.doSearchApp($select.search)</span><br><span class="line">.then(</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">$scope.searchAppRes = value.data;</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">'searchApp has error, value:'</span> + <span class="built_in">JSON</span>.stringify(value));</span><br><span class="line">toastr.error(<span class="string">'searchApp has error'</span>, <span class="string">'提示'</span>, $scope.notificationConfig);</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">"searchApp has error"</span> + e.toString());</span><br><span class="line">&#125;)</span><br><span class="line">.finally(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'searchApp finally'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="4-3-搜索选项的时候从数组中筛选数据"><a href="#4-3-搜索选项的时候从数组中筛选数据" class="headerlink" title="4.3 搜索选项的时候从数组中筛选数据"></a>4.3 搜索选项的时候从数组中筛选数据</h4><p>通过系统自带的 filter 函数：<code>mtd in searchAppRes | filter:$select.search track by $index</code>, 具体使用如下</p><ol><li>js 如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$scope.searchAppRes = [];</span><br></pre></td></tr></table></figure><ol start="2"><li>html如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>方法<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select</span></span></span><br><span class="line"><span class="tag"><span class="attr">ng-model</span>=<span class="string">"increment.method"</span></span></span><br><span class="line"><span class="tag"><span class="attr">name</span>=<span class="string">"method"</span></span></span><br><span class="line"><span class="tag"><span class="attr">ng-disabled</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"width: 400px;"</span></span></span><br><span class="line"><span class="tag"><span class="attr">title</span>=<span class="string">"选择一个App"</span></span></span><br><span class="line"><span class="tag"><span class="attr">on-select</span>=<span class="string">"submit()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-match</span> <span class="attr">allow-clear</span>=<span class="string">"true"</span> <span class="attr">placeholder</span>=<span class="string">"按照 app 名称进行搜索"</span>&gt;</span></span><br><span class="line">&#123;&#123;$select.selected&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">repeat</span>=<span class="string">"mtd in searchAppRes | filter:$select.search track by $index"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span></span><br><span class="line">Method: <span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:1 | highlight: $select.search"</span> /&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Service: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:0 | highlight: $select.search"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-no-choice</span>&gt;</span></span><br><span class="line">404: 搜索不到结果</span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-no-choice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-依赖"><a href="#5-依赖" class="headerlink" title="5 依赖"></a>5 依赖</h2><h4 id="5-1-npm-textAngular-或者-npm-angular-sanitize"><a href="#5-1-npm-textAngular-或者-npm-angular-sanitize" class="headerlink" title="5.1 npm textAngular 或者 npm angular-sanitize"></a>5.1 <a href="https://www.npmjs.com/package/textangular" target="_blank" rel="noopener">npm textAngular</a> 或者 <a href="https://www.npmjs.com/package/angular-sanitize" target="_blank" rel="noopener">npm angular-sanitize</a></h4><ul><li>引入 <code>&lt;script src=&quot;lib/angular-sanitize/angular-sanitize.js&quot;&gt;&lt;/script&gt;</code></li><li>引入 ngSanitize 模块</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angular.module(&apos;ngTest&apos;, [</span><br><span class="line">    &apos;ui.select&apos;, &apos;ngSanitize&apos;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h4 id="5-2-npm-select2"><a href="#5-2-npm-select2" class="headerlink" title="5.2 npm select2"></a>5.2 <a href="https://www.npmjs.com/package/select2" target="_blank" rel="noopener">npm select2</a></h4><ul><li>使用 <a href="mailto:`select2@3.4.5" target="_blank" rel="noopener">`select2@3.4.5</a>` 的版本</li><li>引入 <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;lib/select2/select2.css&quot;&gt;</code></li></ul><h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6 参考"></a>6 参考</h2><ul><li><a href="https://angular-ui.github.io/ui-select/" target="_blank" rel="noopener">UI Select 官网</a></li><li><a href="https://github.com/angular-ui/ui-select/wiki" target="_blank" rel="noopener">ui-select wiki</a></li></ul>]]></content>
    
    <summary type="html">
    
      AngularJS 下拉框组件 ui-select 使用介绍
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
      <category term="ui-select" scheme="http://ckjava.com/tags/ui-select/"/>
    
  </entry>
  
  <entry>
    <title>如何优雅的处理 Java 内部类（匿名方法）传值与返回的问题</title>
    <link href="http://ckjava.com/2019/06/24/Java-innerclass-value-propagation-practice/"/>
    <id>http://ckjava.com/2019/06/24/Java-innerclass-value-propagation-practice/</id>
    <published>2019-06-23T16:00:00.000Z</published>
    <updated>2019-06-24T13:22:56.895Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>传入 Java 内部类的对象必须是 final 的，如何将内部类中计算的结果返回呢？比如下面这个，如何将最终的 total 返回到外面？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numberList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    numberList.add(<span class="number">1</span>);</span><br><span class="line">    numberList.add(<span class="number">2</span>);</span><br><span class="line">    numberList.add(<span class="number">3</span>);</span><br><span class="line">    numberList.forEach(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        total += n;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="2-解决方法"><a href="#2-解决方法" class="headerlink" title="2 解决方法"></a>2 解决方法</h2><h4 id="2-1-通过-AtomicReference-包裹最终返回的对象"><a href="#2-1-通过-AtomicReference-包裹最终返回的对象" class="headerlink" title="2.1 通过 AtomicReference 包裹最终返回的对象"></a>2.1 通过 AtomicReference 包裹最终返回的对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AtomicReference&lt;Integer&gt; atomicReference = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">numberList.forEach(n -&gt; atomicReference.set(n + atomicReference.get()));</span><br><span class="line"></span><br><span class="line">System.out.println(atomicReference.get());</span><br><span class="line">Assert.assertTrue(atomicReference.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure><h4 id="2-2-通过-ThreadLocal-包裹最终返回的对象"><a href="#2-2-通过-ThreadLocal-包裹最终返回的对象" class="headerlink" title="2.2 通过 ThreadLocal 包裹最终返回的对象"></a>2.2 通过 ThreadLocal 包裹最终返回的对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;Integer&gt; threadLocal = ThreadLocal.withInitial(() -&gt; <span class="number">0</span>);</span><br><span class="line">numberList.forEach(n -&gt; threadLocal.set(n + threadLocal.get()));</span><br><span class="line"></span><br><span class="line">System.out.println(threadLocal.get());</span><br><span class="line">Assert.assertTrue(threadLocal.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3 总结"></a>3 总结</h2><h4 id="3-1-共同点："><a href="#3-1-共同点：" class="headerlink" title="3.1 共同点："></a>3.1 共同点：</h4><ol><li>包裹最终返回的对象</li><li>通过 get 方法可以获取，通过 set 方法保存</li></ol><h4 id="3-2-不同点："><a href="#3-2-不同点：" class="headerlink" title="3.2 不同点："></a>3.2 不同点：</h4><ol><li>AtomicReference 有带参数的构造方法，ThreadLocal 没有</li></ol><h2 id="4-自定义一个包裹类"><a href="#4-自定义一个包裹类" class="headerlink" title="4 自定义一个包裹类"></a>4 自定义一个包裹类</h2><p>根据上面的总结，自定义的包裹类类有以下两个特征：</p><ol><li>通过 get 方法可以获取，通过 set 方法保存</li><li>通过构造函数设置初始值</li></ol><p>具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperUtils</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapperUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WrapperUtils <span class="title">init</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapperUtils</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WrapperUtils&lt;Integer&gt; wrapperUtils = <span class="keyword">new</span> WrapperUtils&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">numberList.forEach(t -&gt; wrapperUtils.set(wrapperUtils.get()+t));</span><br><span class="line">Assert.assertTrue(wrapperUtils.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      传入 Java 内部类的对象必须是 final 的，如何将内部类中计算的结果返回呢？
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="innerclass" scheme="http://ckjava.com/tags/innerclass/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 中的 Optional 使用详解</title>
    <link href="http://ckjava.com/2019/06/22/understand-Java-8-Optional/"/>
    <id>http://ckjava.com/2019/06/22/understand-Java-8-Optional/</id>
    <published>2019-06-21T16:00:00.000Z</published>
    <updated>2019-06-22T10:48:26.307Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ul><li>Optional 的完整路径是 <code>java.util.Optional</code>，使用它是为了避免代码中的 <code>if (obj != null) { }</code> 这样范式的代码，可以采用链式编程的风格</li><li>而且通过 Optional 中提供的 filter 方法可以判断对象是否符合条件，在符合条件的情况下才会返回；map 方法可以在返回对象前修改对象中的属性</li><li>下面将一一分析这些方法的用法</li></ul><h2 id="2-方法列表"><a href="#2-方法列表" class="headerlink" title="2 方法列表"></a>2 方法列表</h2><ol><li><code>public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper)</code>: 将 Optional 中的对象转成 其他对象，或者修改对象中的属性</li><li><code>public&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T, Optional&lt;U&gt;&gt; mapper)</code>：将 Optional 中的对象转成 Optional 对象，或者修改对象中的属性</li><li><code>public T orElse(T other)</code>: 在构造 Optional 的时候，如果其中的对象为 null, 通过 orElse 方法可以给定一个默认值</li><li><code>public T orElseGet(Supplier&lt;? extends T&gt; other)</code>：在构造 Optional 的时候，如果其中的对象为 null, 通过 orElseGet 方法可以动态构造一个对象;与 orElse 相比，orElseGet 的参数是 Supplier 接口对象</li><li><code>public void ifPresent(Consumer&lt;? super T&gt; consumer)</code>：ifPresent 表示 Optional 中的对象存在才会执行 Consumer 接口对象中的方法</li><li><code>public Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code>：Optional 中的对象在不为空，并且满足某个条件的时候才会返回</li><li><code>public &lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) throws X</code>：在使用 Optional 包装的对象前，如果对象为 null 抛出自定义的异常</li></ol><h2 id="3-构造函数"><a href="#3-构造函数" class="headerlink" title="3 构造函数"></a>3 构造函数</h2><p>Optional 的三种构造方式: Optional.of(obj),  Optional.ofNullable(obj) 和明确的 Optional.empty()</p><ol><li><code>Optional.of(obj)</code>: 它要求传入的 obj 不能是 null 值的, 否则直接报 NullPointerException 异常。</li><li><code>Optional.ofNullable(obj)</code>: 它以一种智能的, 宽容的方式来构造一个 Optional 实例. 来者不拒, 传 null 进到就得到 Optional.empty(), 非 null 就调用 Optional.of(obj).</li><li><code>Optional.empty()</code>：返回一个空的 Optional 对象</li></ol><p>具体测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. empty() 返回一个空的 Optional 对象</span></span><br><span class="line"><span class="comment"> * 2. ofNullable 传入的对象可以是 null, 如果为 null 返回一个空的 Optional 对象</span></span><br><span class="line"><span class="comment"> * 3. of 传入的对象一定不能为 null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. empty() 返回一个空的 Optional 对象</span></span><br><span class="line">    Assert.assertTrue(Optional.empty().isPresent() == <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. of 里面如果为 null 直接抛出 NullPointerException 异常</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional.of(<span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> NullPointerException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ofNullable 如果参数为 null，返回空的集合</span></span><br><span class="line">    Assert.assertFalse(Optional.ofNullable(<span class="keyword">null</span>).isPresent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="4 使用场景"></a>4 使用场景</h2><p>这里结合具体的使用场景来使用 Optional 中的方法</p><h4 id="4-1-ifPresent：调用其他方法返回一个集合，在不通过-if-判断是否为-null-就可以放心的遍历"><a href="#4-1-ifPresent：调用其他方法返回一个集合，在不通过-if-判断是否为-null-就可以放心的遍历" class="headerlink" title="4.1 ifPresent：调用其他方法返回一个集合，在不通过 if 判断是否为 null 就可以放心的遍历"></a>4.1 ifPresent：调用其他方法返回一个集合，在不通过 if 判断是否为 null 就可以放心的遍历</h4><ul><li>通过 Optional 的 ofNullable 构造函数封装</li><li>然后通过其中的 ifPresent 方法：如果对象不为 null, 才会执行 Consumer 接口对象中的方法</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(userList)</span><br><span class="line">        .ifPresent()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIfPresent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ifPresent 表示 Optional 中的对象存在才会执行 Consumer 接口对象中的方法</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 不为空没有值的集合</span></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"1"</span>); <span class="comment">// 输出 1</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 为 null 的集合, 自动判断为 null, 没有执行 Consumer 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">null</span>;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"2"</span>); <span class="comment">// 没有执行</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 有值的集合</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"a"</span>);</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"3"</span>); <span class="comment">// 输出 3</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 过去的方式, 多了 if 判断</span></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.getSize(dataList) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        dataList.forEach(a -&gt; System.out.println(a));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-filter：在判断是否为-null-后，仅遍历集合中符合条件的对象"><a href="#4-2-filter：在判断是否为-null-后，仅遍历集合中符合条件的对象" class="headerlink" title="4.2 filter：在判断是否为 null 后，仅遍历集合中符合条件的对象"></a>4.2 filter：在判断是否为 null 后，仅遍历集合中符合条件的对象</h4><ul><li>在通过 ifPresent 方法返回对象前通过 filter 方法设置过滤条件</li><li>filter 不会减少集合中对象的数量，只要集合中的任意一个对象满足条件就会返回整个集合，否则返回空集合</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(userList)</span><br><span class="line">        .filter()</span><br><span class="line">        .ifPresent()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化 user 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initEveryTestBefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">22</span>, <span class="string">"王旭"</span>, <span class="string">"wang.xu"</span>,<span class="string">"123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">21</span>, <span class="string">"孙萍"</span>, <span class="string">"sun.ping"</span>,<span class="string">"a123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">23</span>, <span class="string">"步传宇"</span>, <span class="string">"bu.zhuan.yu"</span>, <span class="string">"b123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">18</span>, <span class="string">"蔡明浩"</span>,  <span class="string">"cai.ming.hao"</span>,<span class="string">"c123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">17</span>, <span class="string">"郭林杰"</span>, <span class="string">"guo.lin.jie"</span>, <span class="string">"d123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">29</span>, <span class="string">"韩凯"</span>, <span class="string">"han.kai"</span>, <span class="string">"e123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">22</span>, <span class="string">"韩天琪"</span>,  <span class="string">"han.tian.qi"</span>,<span class="string">"f123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">21</span>, <span class="string">"郝玮"</span>,  <span class="string">"hao.wei"</span>,<span class="string">"g123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">19</span>, <span class="string">"胡亚强"</span>,  <span class="string">"hu.ya.qing"</span>,<span class="string">"h123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">14</span>, <span class="string">"季恺"</span>,  <span class="string">"ji.kai"</span>,<span class="string">"i123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">17</span>, <span class="string">"荆帅"</span>,  <span class="string">"jing.shuai"</span>,<span class="string">"j123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">16</span>, <span class="string">"姜有琪"</span>,  <span class="string">"jiang.you.qi"</span>,<span class="string">"k123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    logger.info(<span class="string">"initEveryTestBefore, size &#123;&#125;"</span>, userList.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// filter: optional 中的对象在不为空，并且满足某个条件的时候才会返回</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 在集合中有年龄大于 18 岁的才会返回所有对象</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .filter(t -&gt; t.stream().anyMatch(u -&gt; u.getAge() &gt; <span class="number">18</span>))</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 因为集合中没有年龄大于 50 岁的，因此不会返回任何对象</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .filter(t -&gt; t.stream().anyMatch(u -&gt; u.getAge() &gt; <span class="number">50</span>))</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">22:24:31.666 [main] INFO  c.toulezu.test.optional.TestOptional - initEveryTestBefore, size 12</span><br><span class="line">1:User&#123;age=22, name=&apos;王旭&apos;, enName=&apos;wang.xu&apos;, password=&apos;123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=21, name=&apos;孙萍&apos;, enName=&apos;sun.ping&apos;, password=&apos;a123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=23, name=&apos;步传宇&apos;, enName=&apos;bu.zhuan.yu&apos;, password=&apos;b123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=18, name=&apos;蔡明浩&apos;, enName=&apos;cai.ming.hao&apos;, password=&apos;c123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=17, name=&apos;郭林杰&apos;, enName=&apos;guo.lin.jie&apos;, password=&apos;d123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=29, name=&apos;韩凯&apos;, enName=&apos;han.kai&apos;, password=&apos;e123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=22, name=&apos;韩天琪&apos;, enName=&apos;han.tian.qi&apos;, password=&apos;f123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=21, name=&apos;郝玮&apos;, enName=&apos;hao.wei&apos;, password=&apos;g123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=19, name=&apos;胡亚强&apos;, enName=&apos;hu.ya.qing&apos;, password=&apos;h123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=14, name=&apos;季恺&apos;, enName=&apos;ji.kai&apos;, password=&apos;i123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=17, name=&apos;荆帅&apos;, enName=&apos;jing.shuai&apos;, password=&apos;j123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=16, name=&apos;姜有琪&apos;, enName=&apos;jiang.you.qi&apos;, password=&apos;k123456&apos;, gender=1, hasMarried=false&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3-orElse：在目标集合对象为-null-的时候可以设定默认值"><a href="#4-3-orElse：在目标集合对象为-null-的时候可以设定默认值" class="headerlink" title="4.3 orElse：在目标集合对象为 null 的时候可以设定默认值"></a>4.3 orElse：在目标集合对象为 null 的时候可以设定默认值</h4><ul><li>通过 orElse 函数设定默认值</li><li>ofNullable 函数为目标集合对象，如果为 null, 才会使用 orElse 函数设定的默认值</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElse()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在构造 Optional 的时候，如果其中的对象为 null, 通过 orElse 方法可以给定一个默认值</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会返回 orElse 方法提供的对象</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会返回 orElse 方法提供的对象</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"aa"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ab"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ac"</span>);</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 给定的对象不为 null 但是为 empty, 不会返回 orElse 方法提供的对象</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"3:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1:a</span><br><span class="line">1:b</span><br><span class="line">1:c</span><br><span class="line">1:d</span><br><span class="line">2:aa</span><br><span class="line">2:ab</span><br><span class="line">2:ac</span><br></pre></td></tr></table></figure><h4 id="4-4-orElseGet：在目标集合对象为-null-的时候，可以动态从其他地方加载集合"><a href="#4-4-orElseGet：在目标集合对象为-null-的时候，可以动态从其他地方加载集合" class="headerlink" title="4.4 orElseGet：在目标集合对象为 null 的时候，可以动态从其他地方加载集合"></a>4.4 orElseGet：在目标集合对象为 null 的时候，可以动态从其他地方加载集合</h4><ul><li>在构造 Optional 的时候，如果其中的对象为 null, 通过 orElseGet 方法可以动态构造一个对象，比如可以再从数据库中加载</li><li>orElseGet 直接返回的是 Optional 中的对象</li><li>与 orElse 相比，orElseGet 的参数是 Supplier 接口对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElseGet()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElseGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"aa"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ab"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ac"</span>);</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 给定的对象不为 null 但是 empty, 不会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"3:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-5-orElseThrow：如果目标对象为-null，-抛出自定义的异常"><a href="#4-5-orElseThrow：如果目标对象为-null，-抛出自定义的异常" class="headerlink" title="4.5 orElseThrow：如果目标对象为 null， 抛出自定义的异常"></a>4.5 orElseThrow：如果目标对象为 null， 抛出自定义的异常</h4><ul><li>在使用 optional 包装的对象前，如果对象为 null 抛出自定义的异常</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElseThrow()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElseThrow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    RuntimeException runtimeException = <span class="keyword">new</span> RuntimeException(<span class="string">"dataList 对象为空"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会抛出异常</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional.ofNullable(dataList)</span><br><span class="line">                .orElseThrow(() -&gt; runtimeException)</span><br><span class="line">                .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> RuntimeException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会抛出异常</span></span><br><span class="line">    dataList = tempList;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseThrow(() -&gt; runtimeException)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-6-map：将-optional-中的对象转成-其他对象，或者修改对象中的属性"><a href="#4-6-map：将-optional-中的对象转成-其他对象，或者修改对象中的属性" class="headerlink" title="4.6 map：将 optional 中的对象转成 其他对象，或者修改对象中的属性"></a>4.6 map：将 optional 中的对象转成 其他对象，或者修改对象中的属性</h4><ul><li>用于修改 Optional 中的对象，并返回对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .map()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 返回 optional 中的对象年龄在 18 岁以上的</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .map(t -&gt; &#123;</span><br><span class="line">                List&lt;User&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u.getAge() &gt; <span class="number">18</span>) &#123;</span><br><span class="line">                        tempList.add(u);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> tempList;</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将 optional 中的 User 对象的英文名改成大写</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .map(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    u.setEnName(u.getEnName().toUpperCase());</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-7-flatMap：将-optional-中的对象转成-optional-对象，或者修改对象中的属性"><a href="#4-7-flatMap：将-optional-中的对象转成-optional-对象，或者修改对象中的属性" class="headerlink" title="4.7 flatMap：将 optional 中的对象转成 optional 对象，或者修改对象中的属性"></a>4.7 flatMap：将 optional 中的对象转成 optional 对象，或者修改对象中的属性</h4><ul><li>用于修改 Optional 中的对象，并返回 Optional 对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .flatMap()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFlatMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 返回 Optional 中的对象年龄在 18 岁以上的</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .flatMap(t -&gt; &#123;</span><br><span class="line">                List&lt;User&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u.getAge() &gt; <span class="number">18</span>) &#123;</span><br><span class="line">                        tempList.add(u);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> Optional.of(tempList);</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将 optional 中的 User 对象的英文名改成大写</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .flatMap(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    u.setEnName(u.getEnName().toUpperCase());</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> Optional.of(t);</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-基于-Optional-设计一个-CRUD-的接口"><a href="#5-基于-Optional-设计一个-CRUD-的接口" class="headerlink" title="5 基于 Optional 设计一个 CRUD 的接口"></a>5 基于 Optional 设计一个 CRUD 的接口</h2><ul><li>在接口中定义返回 Optional 包裹的对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.toulezu.test.stream.api.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;User&gt; <span class="title">getUser</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;T&gt;&gt; findAll();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;T&gt;&gt; search(String keyword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在假设数据库中查询返回为 null 的情况</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.toulezu.test.stream.api.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">BaseService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;User&gt; <span class="title">getUser</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;User&gt;&gt; findAll() &#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;User&gt;&gt; search(String keyword) &#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过 ifPresent 方法可以避免 null 判断，具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">    userService.getUser(<span class="number">1l</span>)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(t != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    userService.findAll()</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(userList != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    userService.search(<span class="string">"a"</span>)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(userList != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Optional 的完整路径是 java.util.Optional，使用它是为了避免代码中的 if (obj != null) { } 这样范式的代码，可以采用链式编程的风格。而且通过 Optional 中提供的 filter 方法可以判断对象是否符合条件，在符合条件的情况下才会返回；map 方法可以在返回对象前修改对象中的属性
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
      <category term="Optional" scheme="http://ckjava.com/tags/Optional/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS 判断类型函数使用总结</title>
    <link href="http://ckjava.com/2019/05/31/AngularJS-function-practice/"/>
    <id>http://ckjava.com/2019/05/31/AngularJS-function-practice/</id>
    <published>2019-05-30T16:00:00.000Z</published>
    <updated>2019-05-31T00:43:26.558Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>AngularJS 中判断类型的函数共有 10 个，类似 9 个<code>angular.isXXX</code> 这种以及 <code>angular.equals</code>，这里将一一介绍这些函数的使用。</p><h2 id="2-angular-isUndefined"><a href="#2-angular-isUndefined" class="headerlink" title="2 angular.isUndefined"></a>2 angular.isUndefined</h2><ul><li><code>angular.isUndefined(value);</code></li></ul><h4 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h4><p>判断 value 是否是 undefined</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="2-2-具体使用"><a href="#2-2-具体使用" class="headerlink" title="2.2 具体使用"></a>2.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// true</span></span><br><span class="line">a = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a.name)); <span class="comment">// true</span></span><br><span class="line">a = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="3-angular-isDefined"><a href="#3-angular-isDefined" class="headerlink" title="3 angular.isDefined"></a>3 angular.isDefined</h2><ul><li><code>angular.isDefined(value);</code></li></ul><h4 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h4><p>判断参数 value 是否定义</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="3-2-具体使用"><a href="#3-2-具体使用" class="headerlink" title="3.2 具体使用"></a>3.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// false</span></span><br><span class="line">b = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b.name)); <span class="comment">// false</span></span><br><span class="line">b = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="4-angular-isObject"><a href="#4-angular-isObject" class="headerlink" title="4 angular.isObject"></a>4 angular.isObject</h2><ul><li><code>angular.isObject(value);</code></li></ul><h4 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h4><p>判断 value 是否是 Object，注意数组也认为是 Object</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="4-2-具体使用"><a href="#4-2-具体使用" class="headerlink" title="4.2 具体使用"></a>4.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// true</span></span><br><span class="line">c = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// true</span></span><br><span class="line">c = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="5-angular-isString"><a href="#5-angular-isString" class="headerlink" title="5 angular.isString"></a>5 angular.isString</h2><ul><li><code>angular.isString(value);</code></li></ul><h4 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h4><p>判断 value 是否是 String</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型，字符串，<code>&#39;&#39;</code> 以及 <code>&quot;&quot;</code> 都会返回 true</li></ul><h4 id="5-2-具体使用"><a href="#5-2-具体使用" class="headerlink" title="5.2 具体使用"></a>5.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="6-angular-isNumber"><a href="#6-angular-isNumber" class="headerlink" title="6 angular.isNumber"></a>6 angular.isNumber</h2><ul><li><code>angular.isNumber(value);</code></li></ul><h4 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h4><p>判断 value 是否是 Number 对象，注意 <code>NaN</code>, <code>+Infinity</code> and <code>-Infinity</code> 这些特殊的 Number，判断它们也会返回 true, 通过 isFinite 方法判断才返回 false</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="6-2-具体使用"><a href="#6-2-具体使用" class="headerlink" title="6.2 具体使用"></a>6.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> j;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="number">12</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = <span class="literal">NaN</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = +<span class="literal">Infinity</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = -<span class="literal">Infinity</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"NaN isNaN:%s"</span>, <span class="built_in">isNaN</span>(<span class="literal">NaN</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"NaN isFinite:%s"</span>, <span class="built_in">isFinite</span>(<span class="literal">NaN</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"+Infinity isFinite:%s"</span>, <span class="built_in">isFinite</span>(+<span class="literal">Infinity</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"-Infinity isFinite:%s"</span>, <span class="built_in">isFinite</span>(-<span class="literal">Infinity</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="7-angular-isArray"><a href="#7-angular-isArray" class="headerlink" title="7 angular.isArray"></a>7 angular.isArray</h2><ul><li><code>angular.isArray(value);</code></li></ul><h4 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h4><p>判断 value 是否是 Array 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="7-2-具体使用"><a href="#7-2-具体使用" class="headerlink" title="7.2 具体使用"></a>7.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// true</span></span><br><span class="line">d = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="8-angular-isDate"><a href="#8-angular-isDate" class="headerlink" title="8 angular.isDate"></a>8 angular.isDate</h2><ul><li><code>angular.isDate(value);</code></li></ul><h4 id="8-1-概述"><a href="#8-1-概述" class="headerlink" title="8.1 概述"></a>8.1 概述</h4><p>判断 value 是否是 Date 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="8-2-具体使用"><a href="#8-2-具体使用" class="headerlink" title="8.2 具体使用"></a>8.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// true</span></span><br><span class="line">e = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="9-angular-isFunction"><a href="#9-angular-isFunction" class="headerlink" title="9 angular.isFunction"></a>9 angular.isFunction</h2><ul><li><code>angular.isFunction(value);</code></li></ul><h4 id="9-1-概述"><a href="#9-1-概述" class="headerlink" title="9.1 概述"></a>9.1 概述</h4><p>判断 value 是否是 Function 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="9-2-具体使用"><a href="#9-2-具体使用" class="headerlink" title="9.2 具体使用"></a>9.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// true</span></span><br><span class="line">f = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="10-angular-isElement"><a href="#10-angular-isElement" class="headerlink" title="10 angular.isElement"></a>10 angular.isElement</h2><ul><li><code>angular.isElement(value);</code></li></ul><h4 id="10-1-概述"><a href="#10-1-概述" class="headerlink" title="10.1 概述"></a>10.1 概述</h4><p>判断 value 是否是 DOM element 对象或者 jQuery 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="10-2-具体使用"><a href="#10-2-具体使用" class="headerlink" title="10.2 具体使用"></a>10.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="built_in">document</span>.getElementById(<span class="string">'eleTest'</span>); <span class="comment">// 原生js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = angular.element(<span class="built_in">document</span>).find(<span class="string">'#eleTest'</span>); <span class="comment">// angularJS 内置jQuery</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = $(<span class="string">'#eleTest'</span>); <span class="comment">// jQuery 的方式</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="11-angular-equals"><a href="#11-angular-equals" class="headerlink" title="11 angular.equals"></a>11 angular.equals</h2><ul><li><code>angular.equals(o1, o2);</code></li></ul><h4 id="11-1-概述"><a href="#11-1-概述" class="headerlink" title="11.1 概述"></a>11.1 概述</h4><ul><li>参数 o1 和 o2 可以是任意类型</li><li><p>返回值 boolean 类型</p></li><li><p>判断两个对象或者两个值是否相等，判断的对象或者类型包括：值对象，正则表达式，数组，对象</p></li><li>如果两个对象相等，那么必须至少满足下面任意一个条件<ol><li>都是对象或者值，并且 <code>o1===o2</code></li><li>如果是对象，那么对象中的所有属性一致，如果是值，那么值的类型必须一致并且相等（===）</li><li>都是 NaN</li><li>都是正则表达式，angular.equals(/abc/, /abc/) 返回值为 true</li></ol></li><li>在比较中，对象中的方法属性或者属性以<code>$</code>开头将被忽略</li></ul><h4 id="11-2-具体使用"><a href="#11-2-具体使用" class="headerlink" title="11.2 具体使用"></a>11.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// angular.equals</span></span><br><span class="line"><span class="keyword">var</span> h;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> h2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">var</span> abc = <span class="string">'abcd'</span>; &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h2, angular.equals(h, h2)); <span class="comment">// false</span></span><br><span class="line">h = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, &#123;<span class="string">'name'</span>:<span class="string">'joe'</span>&#125;)); <span class="comment">// false</span></span><br><span class="line">h = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="12-参考"><a href="#12-参考" class="headerlink" title="12 参考"></a>12 参考</h2><ul><li><a href="https://docs.angularjs.org/api/ng/function" target="_blank" rel="noopener">AngularJS 函数官方文档</a></li><li><a href="https://embed.plnkr.co/UoISeN/" target="_blank" rel="noopener">plnkr 代码</a></li></ul>]]></content>
    
    <summary type="html">
    
      AngularJS 中判断类型的函数共有 10 个，类似 9 个`angular.isXXX` 这种以及 `angular.equals`，这里将一一介绍这些函数的使用。
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
      <category term="函数" scheme="http://ckjava.com/tags/%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>对 JavaScript function 对象中 this 的理解</title>
    <link href="http://ckjava.com/2019/05/31/understand-JavaScript-function-this/"/>
    <id>http://ckjava.com/2019/05/31/understand-JavaScript-function-this/</id>
    <published>2019-05-30T16:00:00.000Z</published>
    <updated>2019-05-31T00:36:31.894Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>最近看到了 <a href="https://docs.angularjs.org/api/ng/function/angular.bind" target="_blank" rel="noopener">angular.bind</a> 函数，其中有个地方吸引了我的注意：函数修改了 function 对象中的 this 和参数。</p><h2 id="2-angular-bind-的使用"><a href="#2-angular-bind-的使用" class="headerlink" title="2 angular.bind 的使用"></a>2 angular.bind 的使用</h2><h4 id="2-1-函数说明"><a href="#2-1-函数说明" class="headerlink" title="2.1 函数说明"></a>2.1 函数说明</h4><p>angular.bind 函数具体使用如下</p><p><code>angular.bind(self, fn, args);</code>：将 self 对象绑定到 fn 中，通过 args 给 fn 传入参数</p><ul><li>self：Object 类型，在 fn 中通过 this 关键字引用；</li><li>fn: <code>function()</code> 类型，最后的返回值也是该 fn 对象</li><li>args: 任意类型，可选，通过 args 给 fn 传入参数</li></ul><p>angular.bind 函数从本质上改变了 function 对象中的 this 作用域和参数</p><h4 id="2-2-具体使用"><a href="#2-2-具体使用" class="headerlink" title="2.2 具体使用"></a>2.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> self = &#123;</span><br><span class="line">  name: <span class="string">'boyi'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例1--带参数</span></span><br><span class="line"><span class="keyword">var</span> f = angular.bind(self, <span class="comment">// 绑定对象，作为函数的上下文</span></span><br><span class="line">  <span class="comment">// 被绑定的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is '</span> + age + <span class="string">' !'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//绑定的参数，可省略</span></span><br><span class="line">  <span class="string">'15'</span></span><br><span class="line">);</span><br><span class="line">f(); <span class="comment">//调用绑定之后的function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//示例2--不带参数</span></span><br><span class="line"><span class="keyword">var</span> m = angular.bind(self, <span class="comment">//绑定对象，作为函数的上下文</span></span><br><span class="line">  <span class="comment">//被绑定的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is '</span> + age + <span class="string">' !'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//省略参数</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">m(<span class="number">3</span>); <span class="comment">//调用传参的函数</span></span><br></pre></td></tr></table></figure><h2 id="3-JavaScript-中的-this"><a href="#3-JavaScript-中的-this" class="headerlink" title="3 JavaScript 中的 this"></a>3 JavaScript 中的 this</h2><h4 id="3-1-表示全局对象"><a href="#3-1-表示全局对象" class="headerlink" title="3.1 表示全局对象"></a>3.1 表示全局对象</h4><p>默认情况下 this 是指 全局对象</p><ul><li><code>全局对象.fn();</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line">test();  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h4 id="3-2-表示对象本身"><a href="#3-2-表示对象本身" class="headerlink" title="3.2 表示对象本身"></a>3.2 表示对象本身</h4><p>对象中的 function 是对象本身，</p><ul><li><code>对象.fn();</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.x = <span class="number">1</span>;</span><br><span class="line">obj.m = test;</span><br><span class="line"></span><br><span class="line">obj.m(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h4 id="3-3-指定对象"><a href="#3-3-指定对象" class="headerlink" title="3.3 指定对象"></a>3.3 指定对象</h4><ul><li><code>apply()</code> 是函数的一个方法，作用是改变函数的调用对象，通过 <code>apply()</code> 可以修改 this 的引用</li><li>只有一个参数，可以为空，如果为空表示全局对象，如果传入参数 obj, 那么函数中的 this 的引用就指向 obj</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">　<span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.x = <span class="number">1</span>;</span><br><span class="line">obj.m = test;</span><br><span class="line">obj.m.apply() <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><p><code>apply()</code> 的参数为空时，表示全局对象调用函数。因此，这时的运行结果为 0，证明 this 指的是全局对象。</p><p>如果把最后一行代码修改为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.m.apply(obj); <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>运行结果就变成了1，证明了这时this代表的是对象obj。</p><h2 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2010/04/using_this_keyword_in_javascript.html" target="_blank" rel="noopener">JavaScript 的 this 用法</a></li></ul>]]></content>
    
    <summary type="html">
    
      由 angular.bind 函数联想到有关 JavaScript function 对象中 this 的作用域问题。
    
    </summary>
    
      <category term="JavaScript" scheme="http://ckjava.com/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://ckjava.com/tags/JavaScript/"/>
    
      <category term="this" scheme="http://ckjava.com/tags/this/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot Jpa 单元测试实践</title>
    <link href="http://ckjava.com/2019/05/27/SpringBoot-jpa-junit-test-practice/"/>
    <id>http://ckjava.com/2019/05/27/SpringBoot-jpa-junit-test-practice/</id>
    <published>2019-05-26T16:00:00.000Z</published>
    <updated>2019-05-27T00:18:19.421Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文将介绍如何在 SpringBoot 环境中编写独立于 Spring context 的 Jpa 单元测试，比如：单个 service, 单个 controller 的单元测试。</p><h2 id="2-依赖"><a href="#2-依赖" class="headerlink" title="2 依赖"></a>2 依赖</h2><p>依赖如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.196<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>spring-boot-starter-test</code> 是 SpringBoot 测试的主要依赖</li><li>h2 DB 是内存型数据库，与数据有关的操作仅在测试环境中有效</li></ul><h2 id="3-父类-BaseTest-定义"><a href="#3-父类-BaseTest-定义" class="headerlink" title="3 父类 BaseTest 定义"></a>3 父类 BaseTest 定义</h2><p>BaseTest 定义了测试需要的 Bean 以及测试需要用的配置文件，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.web.TaskController;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.ConfigFileApplicationContextInitializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.TestConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ActiveProfiles;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.TestPropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.setup.MockMvcBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(initializers = ConfigFileApplicationContextInitializer.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestConfiguration</span></span><br><span class="line">    <span class="meta">@TestPropertySource</span>(locations = <span class="string">"classpath:application.yml"</span>)</span><br><span class="line">    <span class="meta">@ActiveProfiles</span>(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestContextConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value</span>(<span class="string">"$&#123;datasource.sampleapp.maxPoolSize:10&#125;"</span>)</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 将 application.yml 的配置填充到 SpringBoot 中的 DataSourceProperties 对象里面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@Primary</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">dataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DataSourceProperties dataSourceProperties = <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">            dataSourceProperties.setDriverClassName(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.driverClassName"</span>));</span><br><span class="line">            dataSourceProperties.setUrl(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.url"</span>));</span><br><span class="line">            dataSourceProperties.setUsername(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.username"</span>));</span><br><span class="line">            dataSourceProperties.setPassword(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.password"</span>));</span><br><span class="line">            <span class="keyword">return</span> dataSourceProperties;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 配置 HikariCP 连接池数据源.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DataSourceProperties dataSourceProperties = dataSourceProperties();</span><br><span class="line">            HikariDataSource dataSource = (HikariDataSource) DataSourceBuilder</span><br><span class="line">                    .create(dataSourceProperties.getClassLoader())</span><br><span class="line">                    .driverClassName(dataSourceProperties.getDriverClassName())</span><br><span class="line">                    .url(dataSourceProperties.getUrl())</span><br><span class="line">                    .username(dataSourceProperties.getUsername())</span><br><span class="line">                    .password(dataSourceProperties.getPassword())</span><br><span class="line">                    .type(HikariDataSource.class)</span><br><span class="line">                    .build();</span><br><span class="line">            dataSource.setMaximumPoolSize(maxPoolSize);</span><br><span class="line">            <span class="keyword">return</span> dataSource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Entity Manager Factory 配置.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> <span class="keyword">throws</span> NamingException </span>&#123;</span><br><span class="line">            LocalContainerEntityManagerFactoryBean factoryBean = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</span><br><span class="line">            factoryBean.setDataSource(dataSource());</span><br><span class="line">            factoryBean.setPackagesToScan(<span class="keyword">new</span> String[]&#123;<span class="string">"com.ckjava.test.domain"</span>&#125;);</span><br><span class="line">            factoryBean.setJpaVendorAdapter(jpaVendorAdapter());</span><br><span class="line">            factoryBean.setJpaProperties(jpaProperties());</span><br><span class="line">            <span class="keyword">return</span> factoryBean;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 指定 hibernate 为 jpa 的持久化框架</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            HibernateJpaVendorAdapter hibernateJpaVendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();</span><br><span class="line">            <span class="keyword">return</span> hibernateJpaVendorAdapter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 从 application.yml 中读取 hibernate 相关配置</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Properties <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            properties.put(<span class="string">"hibernate.dialect"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.dialect"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.hbm2ddl.auto"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.hbm2ddl.auto"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.show_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.show_sql"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.format_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.format_sql"</span>));</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotEmpty(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>))) &#123;</span><br><span class="line">                properties.put(<span class="string">"hibernate.default_schema"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> properties;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">(EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">            JpaTransactionManager txManager = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">            txManager.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">            <span class="keyword">return</span> txManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TaskService <span class="title">taskService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TaskService();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TaskController <span class="title">taskController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TaskController();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> MockMvc <span class="title">mockMvc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Object[] contorllers = &#123; taskController() &#125;;</span><br><span class="line">            <span class="keyword">return</span> MockMvcBuilders.standaloneSetup(contorllers).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>@ContextConfiguration(initializers = ConfigFileApplicationContextInitializer.class)</code> 必须放在父类中，这个配置用于解析测试配置文件 application.yml</li><li><code>@TestConfiguration</code> 配置测试需要的 Bean, 包含了 jpa 数据源 DataSource Bean， entityManagerFactory Bean, transactionManager Bean 等</li><li><code>@TestPropertySource(locations = &quot;classpath:application.yml&quot;)</code> 表示测试使用的配置文件</li><li><code>@ActiveProfiles(&quot;local&quot;)</code> 表示测试使用 application.yml 配置文件中的 local profile</li></ul><h2 id="4-Service-单元测试"><a href="#4-Service-单元测试" class="headerlink" title="4 Service 单元测试"></a>4 Service 单元测试</h2><ul><li>TestTaskService 直接继承 BaseTest， 通过 <code>@Autowired</code> 注入待测 TaskService Bean</li><li>TaskService Bean 在 BaseTest 中的 TestContextConfiguration 类中定义</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTaskService</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// save</span></span><br><span class="line">        Task task = <span class="keyword">new</span> Task();</span><br><span class="line">        task.setName(<span class="string">"test1"</span>);</span><br><span class="line">        task.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        task.setContent(<span class="string">"test content"</span>);</span><br><span class="line">        taskService.save(task);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// findAll</span></span><br><span class="line">        List&lt;Task&gt; taskList = taskService.findAll();</span><br><span class="line">        Assert.assertTrue(taskList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        task = taskList.get(<span class="number">0</span>);</span><br><span class="line">        taskService.delete(task);</span><br><span class="line"></span><br><span class="line">        taskList = taskService.findAll();</span><br><span class="line">        task = taskList.get(<span class="number">0</span>);</span><br><span class="line">        Assert.assertTrue(task.getDelFlag().equals(<span class="string">"1"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Controller-单元测试"><a href="#5-Controller-单元测试" class="headerlink" title="5  Controller 单元测试"></a>5  Controller 单元测试</h2><ul><li>TestTaskController 直接继承 BaseTest， 通过 <code>@Autowired</code> 注入待测 MockMvc Bean</li><li>MockMvc Bean 在 BaseTest 中的 TestContextConfiguration 类中定义</li><li>其中 MockMvc Bean 创建过程中引入了 TaskController Bean</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mock.web.MockHttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MvcResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.ResultActions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTaskController</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Task task = <span class="keyword">new</span> Task();</span><br><span class="line">        task.setId(<span class="number">1L</span>);</span><br><span class="line">        task.setName(<span class="string">"test"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// post</span></span><br><span class="line">        ResultActions postResultActions = mockMvc.perform(</span><br><span class="line">                MockMvcRequestBuilders.post(<span class="string">"/api/task"</span>)</span><br><span class="line">                        .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                        .content(JSONObject.toJSONString(task))</span><br><span class="line">                        .contentType(MediaType.APPLICATION_JSON));</span><br><span class="line">        Assert.assertTrue(postResultActions.andReturn().getResponse().getStatus() == <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get</span></span><br><span class="line">        ResultActions resultActions = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">"/api/task/"</span>.concat(task.getId().toString()))</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        MvcResult mvcResult = resultActions.andReturn();</span><br><span class="line">        MockHttpServletResponse resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        JSONObject obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        JSONObject dataObj = obj.getJSONObject(<span class="string">"data"</span>);</span><br><span class="line">        task = dataObj.toJavaObject(Task.class);</span><br><span class="line">        Assert.assertTrue(task.getId() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// findAll</span></span><br><span class="line">        resultActions = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">"/api/task/all"</span>)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        mvcResult = resultActions.andReturn();</span><br><span class="line">        resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        JSONArray dataArr = obj.getJSONArray(<span class="string">"data"</span>);</span><br><span class="line">        List&lt;Task&gt; dataList = dataArr.toJavaList(Task.class);</span><br><span class="line">        Assert.assertTrue(dataList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        task = dataList.get(<span class="number">0</span>);</span><br><span class="line">        Assert.assertTrue(task.getId() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// delete</span></span><br><span class="line">        resultActions = mockMvc.perform(MockMvcRequestBuilders.delete(<span class="string">"/api/task/"</span>.concat(task.getId().toString()))</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        mvcResult = resultActions.andReturn();</span><br><span class="line">        resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        dataObj = obj.getJSONObject(<span class="string">"data"</span>);</span><br><span class="line">        Assert.assertNull(dataObj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-问题"><a href="#6-问题" class="headerlink" title="6 问题"></a>6 问题</h2><h4 id="6-1-javax-persistence-TransactionRequiredException-No-EntityManager-with-actual-transaction-available-for-current-thread-cannot-reliably-process-39-persist-39-call"><a href="#6-1-javax-persistence-TransactionRequiredException-No-EntityManager-with-actual-transaction-available-for-current-thread-cannot-reliably-process-39-persist-39-call" class="headerlink" title="6.1 javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process &#39;persist&#39; call"></a>6.1 <code>javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process &#39;persist&#39; call</code></h4><ul><li>解决方法如下</li></ul><p>在相关的测试方法上也要加上 <code>@Transactional</code>，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// save</span></span><br><span class="line">    Task task = <span class="keyword">new</span> Task();</span><br><span class="line">    task.setName(<span class="string">"test1"</span>);</span><br><span class="line">    task.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">    task.setContent(<span class="string">"test content"</span>);</span><br><span class="line">    taskService.save(task);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// findAll</span></span><br><span class="line">    List&lt;Task&gt; taskList = taskService.findAll();</span><br><span class="line">    Assert.assertTrue(taskList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    task = taskList.get(<span class="number">0</span>);</span><br><span class="line">    taskService.delete(task);</span><br><span class="line"></span><br><span class="line">    taskList = taskService.findAll();</span><br><span class="line">    task = taskList.get(<span class="number">0</span>);</span><br><span class="line">    Assert.assertTrue(task.getDelFlag().equals(<span class="string">"1"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-2-org-h2-jdbc-JdbcSQLException-Database-is-already-closed-to-disable-automatic-closing-at-VM-shutdown-add-quot-DB-CLOSE-ON-EXIT-FALSE-quot-to-the-db-URL"><a href="#6-2-org-h2-jdbc-JdbcSQLException-Database-is-already-closed-to-disable-automatic-closing-at-VM-shutdown-add-quot-DB-CLOSE-ON-EXIT-FALSE-quot-to-the-db-URL" class="headerlink" title="6.2 org.h2.jdbc.JdbcSQLException: Database is already closed (to disable automatic closing at VM shutdown, add &quot;;DB_CLOSE_ON_EXIT=FALSE&quot; to the db URL)"></a>6.2 <code>org.h2.jdbc.JdbcSQLException: Database is already closed (to disable automatic closing at VM shutdown, add &quot;;DB_CLOSE_ON_EXIT=FALSE&quot; to the db URL)</code></h4><ul><li>解决方法如下</li></ul><p>在数据库连接 url 后面追加上 <code>;DB_CLOSE_ON_EXIT=FALSE</code>, 具体如下</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">local,default</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:h2:~/test;DB_CLOSE_ON_EXIT=FALSE</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">SA</span></span><br><span class="line"><span class="attr">    password:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">create-drop</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.H2Dialect</span></span><br></pre></td></tr></table></figure><h2 id="7-参考"><a href="#7-参考" class="headerlink" title="7 参考"></a>7 参考</h2><ul><li><a href="http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/">SpringBoot 集成 Jpa 实现单表 CRUD 功能并提供 RESTful api 服务</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文将介绍如何在 SpringBoot 环境中编写独立于 Spring context 的 Jpa 单元测试，比如：单个 service, 单个 controller 的单元测试。
    
    </summary>
    
      <category term="技术" scheme="http://ckjava.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="jpa" scheme="http://ckjava.com/tags/jpa/"/>
    
      <category term="junit" scheme="http://ckjava.com/tags/junit/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 集成 Jpa 实现单表 CRUD 功能并提供 RESTful api 服务</title>
    <link href="http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/"/>
    <id>http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/</id>
    <published>2019-05-26T16:00:00.000Z</published>
    <updated>2019-05-27T00:16:51.127Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ol><li>这里介绍在 SpringBoot 集成 Jpa 并提供 RESTful api 服务，实现单表的 CRUD 功能</li><li>使用 Swagger 自动生成 RESTful api 文档</li><li>通过泛型封装 Service 和 Controller 抽象基类</li></ol><h2 id="2-应用配置"><a href="#2-应用配置" class="headerlink" title="2 应用配置"></a>2 应用配置</h2><ul><li>通过 application-dev.yml 和 application-prd.yml 区分不同的开发环境，测试开发使用 h2 db, 生产环境使用 mysql</li><li><p>在 IDE 开发中通过在 vm 参数中增加 <code>-Dspring.profiles.active=dev</code> 来使用  application-dev.yml 文件中的配置, 在生产环境的启动脚本中通过 <code>java -Dspring.profiles.active=prd -jar appProject.jar</code> 来使用 application-prd.yml 文件中的配置</p></li><li><p><code>src\main\resources\application-dev.yml</code> 配置如下</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:h2:~/test</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">SA</span></span><br><span class="line"><span class="attr">    password:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">create-drop</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.H2Dialect</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><code>src\main\resources\application-prd.yml</code> 配置如下      <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jpaTest;DB_CLOSE_ON_EXIT=FALSE</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">update</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.MySQLDialect</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="3-jpa-配置"><a href="#3-jpa-配置" class="headerlink" title="3 jpa 配置"></a>3 jpa 配置</h2><ul><li>通过 Environment 和 @Value 两种方式来获取 application.yml 中的配置</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.xutils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories</span>(basePackages = <span class="string">"com.ckjava.test"</span>,</span><br><span class="line">        entityManagerFactoryRef = <span class="string">"entityManagerFactory"</span>,</span><br><span class="line">        transactionManagerRef = <span class="string">"transactionManager"</span>)</span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;datasource.sampleapp.maxPoolSize:10&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 将配置填充到 SpringBoot 中的 DataSourceProperties 对象里面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"datasource.sampleapp"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">dataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 配置 HikariCP 连接池数据源.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceProperties dataSourceProperties = dataSourceProperties();</span><br><span class="line">        HikariDataSource dataSource = (HikariDataSource) DataSourceBuilder</span><br><span class="line">                .create(dataSourceProperties.getClassLoader())</span><br><span class="line">                .driverClassName(dataSourceProperties.getDriverClassName())</span><br><span class="line">                .url(dataSourceProperties.getUrl())</span><br><span class="line">                .username(dataSourceProperties.getUsername())</span><br><span class="line">                .password(dataSourceProperties.getPassword())</span><br><span class="line">                .type(HikariDataSource.class)</span><br><span class="line">                .build();</span><br><span class="line">        dataSource.setMaximumPoolSize(maxPoolSize);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Entity Manager Factory 配置.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> <span class="keyword">throws</span> NamingException </span>&#123;</span><br><span class="line">        LocalContainerEntityManagerFactoryBean factoryBean = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</span><br><span class="line">        factoryBean.setDataSource(dataSource());</span><br><span class="line">        factoryBean.setPackagesToScan(<span class="keyword">new</span> String[]&#123;<span class="string">"com.ckjava.test.domain"</span>&#125;);</span><br><span class="line">        factoryBean.setJpaVendorAdapter(jpaVendorAdapter());</span><br><span class="line">        factoryBean.setJpaProperties(jpaProperties());</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定 hibernate 为 jpa 的持久化框架</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HibernateJpaVendorAdapter hibernateJpaVendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();</span><br><span class="line">        <span class="keyword">return</span> hibernateJpaVendorAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 读取 hibernate 相关配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Properties <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(<span class="string">"hibernate.dialect"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.dialect"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.hbm2ddl.auto"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.hbm2ddl.auto"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.show_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.show_sql"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.format_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.format_sql"</span>));</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>))) &#123;</span><br><span class="line">            properties.put(<span class="string">"hibernate.default_schema"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">(EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">        JpaTransactionManager txManager = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">        txManager.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">        <span class="keyword">return</span> txManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-集成-Swagger"><a href="#4-集成-Swagger" class="headerlink" title="4 集成 Swagger"></a>4 集成 Swagger</h2><p>Swagger 用于将 RESTful api 提供一个可视化，可调试的页面，便于开发和测试</p><ul><li>maven 依赖如下</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Swagger 配置类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">api</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).select()</span><br><span class="line">.apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br><span class="line">.paths(PathSelectors.any()).build()</span><br><span class="line">.apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(<span class="string">"api 标题"</span>).description(<span class="string">"api 描述"</span>).version(<span class="string">"1.0.0"</span>)</span><br><span class="line">.termsOfServiceUrl(<span class="string">"http://ckjava.com"</span>).license(<span class="string">"MIT"</span>)</span><br><span class="line">.licenseUrl(<span class="string">"http://ckjava.com"</span>).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>WebAppConfig 用于配置 swagger-ui.html 页面的访问地址， swagger-ui.html 这页面是通过 Maven 依赖引入的，在系统中的实际路径是：<code>classpath:/META-INF/resources/swagger-ui.html</code>, 通过映射，可以通过 <code>http://host:ip/contextPath/swagger-ui.html</code> 访问到。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 自动将 `src\main\resources\webStatic` 目录的文件映射到 /**</span></span><br><span class="line"><span class="comment">         * /** 表示匹配任意层级的目录和文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//registry.addResourceHandler(new String[]&#123;"/**"&#125;).addResourceLocations("classpath:/webStatic/").setCacheControl(CacheControl.noCache());</span></span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">"swagger-ui.html"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/"</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/webjars/**"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-业务开发"><a href="#5-业务开发" class="headerlink" title="5 业务开发"></a>5 业务开发</h2><p>具体的业务开发分为业务实体定义，业务逻辑以及web 接口。</p><h4 id="5-1-业务实体定义-domain"><a href="#5-1-业务实体定义-domain" class="headerlink" title="5.1 业务实体定义 domain"></a>5.1 业务实体定义 domain</h4><ul><li>定义实体基类 BaseJpaEntity，包含了基本的字段</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MappedSuperclass</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEL_YES = <span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEL_NO = <span class="string">"0"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy= GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">protected</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"create_date"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"创建时间"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="keyword">protected</span> Date createDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"create_user"</span>, length = <span class="number">64</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"创建人"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"update_date"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"更新时间"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="keyword">protected</span> Date updateDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"update_user"</span>, length = <span class="number">64</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"更新人"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String updateUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"del_flag"</span>, length = <span class="number">1</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"删除标识"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"排序字段"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> String orderBy;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"排序方式 "</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Boolean desc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"起始行数"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Integer start;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"每页数据大小"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Integer pageSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"查询条件"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Map&lt;String, String&gt; conditionMap;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 忽略 get/set 构造函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义 Task 实体类，继承 BaseJpaEntity</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"task"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"name"</span>, length = <span class="number">255</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"任务名称"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"date"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"所属日期"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"content"</span>, length = <span class="number">2000</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"具体内容"</span>)</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略 get/set 构造函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义分页参数对象 PageParamer, 用于处理前端传过来的 分页参数，查询条件，排序等字段</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页参数对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModel</span>(<span class="string">"分页参数对象"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageParamer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"排序对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Sort sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"字段搜索对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Search search;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"分页导航条对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Pagination pagination;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sort <span class="title">getSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSort</span><span class="params">(Sort sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = sort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Search <span class="title">getSearch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> search;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSearch</span><span class="params">(Search search)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.search = search;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pagination <span class="title">getPagination</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pagination;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPagination</span><span class="params">(Pagination pagination)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pagination = pagination;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"排序对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sort</span> </span>&#123;</span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"排序字段"</span>)</span><br><span class="line">        <span class="keyword">private</span> String predicate;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"是否倒序"</span>)</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> reverse;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPredicate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPredicate</span><span class="params">(String predicate)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicate = predicate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> reverse;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReverse</span><span class="params">(<span class="keyword">boolean</span> reverse)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.reverse = reverse;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">(String predicate, <span class="keyword">boolean</span> reverse)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicate = predicate;</span><br><span class="line">            <span class="keyword">this</span>.reverse = reverse;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字段搜索对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"字段搜索对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Search</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"关键字段"</span>)</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, String&gt; predicateObject;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getPredicateObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPredicateObject</span><span class="params">(Map&lt;String, String&gt; predicateObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicateObject = predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Search</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Search</span><span class="params">(Map&lt;String, String&gt; predicateObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicateObject = predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页导航条对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"分页导航条对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pagination</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"起始行"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer start;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"总记录数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer totalItemCount;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"每页记录数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer number;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"总页数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer numberOfPages;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(Integer start)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> totalItemCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalItemCount</span><span class="params">(Integer totalItemCount)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.totalItemCount = totalItemCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> number;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(Integer number)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.number = number;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getNumberOfPages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumberOfPages</span><span class="params">(Integer numberOfPages)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.numberOfPages = numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pagination</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pagination</span><span class="params">(Integer start, Integer totalItemCount, Integer number, Integer numberOfPages)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.totalItemCount = totalItemCount;</span><br><span class="line">            <span class="keyword">this</span>.number = number;</span><br><span class="line">            <span class="keyword">this</span>.numberOfPages = numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageParamer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageParamer</span><span class="params">(Sort sort, Search search, Pagination pagination)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = sort;</span><br><span class="line">        <span class="keyword">this</span>.search = search;</span><br><span class="line">        <span class="keyword">this</span>.pagination = pagination;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-2-业务逻辑-service"><a href="#5-2-业务逻辑-service" class="headerlink" title="5.2 业务逻辑 service"></a>5.2 业务逻辑 service</h4><ol><li>BaseJpaCrudService 泛型基类<ul><li>通过封装 EntityManager 对象和泛型来定义 BaseJpaCrudService 对象，做到通用化</li><li>增加 <code>@Transactional(readOnly = true)</code>，子类所有的方法默认没有事务，<code>@Transactional</code> 是可继承的</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.TypedQuery;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaCrudService</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span>&gt; <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Class&lt;E&gt; <span class="title">getClassType</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 查询一个对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entityManager.find(getClassType(), id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;E&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;E&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dataList = entityManager.createQuery( <span class="string">"from "</span> + getClassType().getName(), getClassType()).getResultList();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;E&gt; <span class="title">getPage</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        StringBuilder qlString = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        qlString.append(<span class="string">"from "</span> + getClassType().getName());</span><br><span class="line">        qlString.append(<span class="string">" where 1=1 "</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; conditionMap = e.getConditionMap();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = conditionMap.entrySet().iterator(); it.hasNext();) &#123;</span><br><span class="line">            Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">            <span class="comment">// key name, value like,张三</span></span><br><span class="line">            <span class="comment">// key age, value =,10</span></span><br><span class="line"></span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            String value = entry.getValue();</span><br><span class="line">            String op = value.split(SPLITER.COMMA)[<span class="number">0</span>];</span><br><span class="line">            qlString.append(<span class="string">" and "</span> + key + <span class="string">" "</span> + op + <span class="string">" :"</span> + key); <span class="comment">// name LIKE :name 或者 age = :age</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        qlString.append(<span class="string">" order by :desc "</span>);</span><br><span class="line"></span><br><span class="line">        TypedQuery&lt;E&gt; typedQuery = entityManager.createQuery(qlString.toString(), getClassType())</span><br><span class="line">                .setParameter(<span class="string">"desc"</span>, e.getDesc())</span><br><span class="line">                .setFirstResult(e.getStart())</span><br><span class="line">                .setMaxResults(e.getPageSize());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = conditionMap.entrySet().iterator(); it.hasNext();) &#123;</span><br><span class="line">            Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            String value = entry.getValue();</span><br><span class="line">            String valued = value.split(SPLITER.COMMA)[<span class="number">1</span>];</span><br><span class="line">            typedQuery.setParameter(key, valued);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Page&lt;&gt;(e.getStart(), e.getPageSize(), typedQuery.getMaxResults(), typedQuery.getResultList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            save(e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            update(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setDelFlag(E.DEL_NO);</span><br><span class="line">        e.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        entityManager.persist(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">update</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setUpdateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> entityManager.merge(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setDelFlag(E.DEL_YES);</span><br><span class="line">        update(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        E e = get(id);</span><br><span class="line">        delete(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>TaskService 实现如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.base.BaseJpaCrudService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.transaction.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskService</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudService</span>&lt;<span class="title">Task</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;Task&gt; <span class="title">getClassType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Task.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-3-web-接口-RESTful-api"><a href="#5-3-web-接口-RESTful-api" class="headerlink" title="5.3 web 接口 RESTful api"></a>5.3 web 接口 RESTful api</h4><ol><li>CorsController 抽象类: 通过 <code>@CrossOrigin</code> 注解使 RESTful api 可以跨域访问</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CrossOrigin</span>(</span><br><span class="line">        origins = <span class="string">"*"</span>,</span><br><span class="line">        allowedHeaders = <span class="string">"*"</span>,</span><br><span class="line">        allowCredentials = <span class="string">"true"</span>,</span><br><span class="line">        methods = &#123;RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, RequestMethod.OPTIONS, RequestMethod.HEAD&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>BaseJpaCrudController 泛型抽象基类，继承 CorsController，并通过泛型做到通用化</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.base.BaseJpaCrudService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaCrudController</span>&lt;<span class="title">S</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudService</span>, <span class="title">E</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span>&gt; <span class="keyword">extends</span> <span class="title">CorsController</span> <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> S service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"根据 id 获取一个对象"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;Object&gt; <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(service.get(id), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"获取所有的对象"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/all"</span>)</span><br><span class="line">    <span class="keyword">public</span> HttpResponse&lt;List&lt;E&gt;&gt; findAll() &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(service.findAll(), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"保存或者修改一个对象"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;String&gt; <span class="title">saveOrUpdate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @RequestBody E e)</span> </span>&#123;</span><br><span class="line">        service.saveOrUpdate(e);</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(HttpResponse.SUCCESS, HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"根据 id 删除一个对象"</span>)</span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">delete</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        service.delete(id);</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>TaskController 实现类，这里只提供分页方法，其他 CRUD 接口自动继承</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.PageParamer;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.TaskService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.web.base.BaseJpaCrudController;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.Page;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/task"</span>, produces = <span class="string">"application/json;charset=utf-8"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudController</span>&lt;<span class="title">TaskService</span>, <span class="title">Task</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"分页获取数据"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"page"</span>)</span><br><span class="line">    <span class="keyword">public</span> HttpResponse&lt;Page&lt;Task&gt;&gt; page(</span><br><span class="line">            <span class="meta">@ApiParam</span>(<span class="string">"&#123;\n"</span> +</span><br><span class="line">                    <span class="string">"    \"sort\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"predicate\": \"id\",\n"</span> +</span><br><span class="line">                    <span class="string">"        \"reverse\": true\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                    <span class="string">"    \"search\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"predicateObject\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"            \"name\": \"like,test\"\n"</span> +</span><br><span class="line">                    <span class="string">"        &#125;\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                    <span class="string">"    \"pagination\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"start\": 1,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"totalItemCount\": 0,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"number\": 10,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"numberOfPages\": 2\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;"</span> +</span><br><span class="line">                    <span class="string">" &#125;\n"</span> +</span><br><span class="line">                    <span class="string">"对于 predicateObject 中的参数，如果 activity=false, 传参为： \"activity\": \"=,false\"，"</span> +</span><br><span class="line">                    <span class="string">"如果 activity like '%false%', 传参为 \"activity\": \"like,false\""</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>)</span><br><span class="line">            <span class="meta">@RequestParam</span> String params) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            PageParamer pageParamer = JSONObject.parseObject(params, PageParamer.class);</span><br><span class="line"></span><br><span class="line">            Task task = <span class="keyword">new</span> Task();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 排序</span></span><br><span class="line">            task.setOrderBy(pageParamer.getSort().getPredicate());</span><br><span class="line">            task.setDesc(pageParamer.getSort().isReverse());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查询字段</span></span><br><span class="line">            task.setConditionMap(pageParamer.getSearch().getPredicateObject());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 分页导航</span></span><br><span class="line">            task.setStart(pageParamer.getPagination().getStart());</span><br><span class="line">            task.setPageSize(pageParamer.getPagination().getNumber());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> HttpResponse.getReturn(service.getPage(task), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HttpResponse.EXCEPTION, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-完整的-pom"><a href="#6-完整的-pom" class="headerlink" title="6 完整的 pom"></a>6 完整的 pom</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ckjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-jpa-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-boot-jpa-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ckjava.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swagger2.version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">swagger2.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.15.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Test --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- jpa --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jpa --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Add Hikari Connection Pooling support --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Add Hikari Connection Pooling support --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- freemarker --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- freemarker --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- h2 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.199<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- h2 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ckjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      这里介绍在 SpringBoot 集成 Jpa 并提供 RESTful api 服务，实现单表的 CRUD 功能；使用 Swagger 自动生成 RESTful api 文档；通过泛型封装 Service 和 Controller 抽象基类。
    
    </summary>
    
      <category term="技术" scheme="http://ckjava.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="jpa" scheme="http://ckjava.com/tags/jpa/"/>
    
      <category term="RESTful" scheme="http://ckjava.com/tags/RESTful/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 Lambda 表达式介绍</title>
    <link href="http://ckjava.com/2019/05/17/understand-Java-8-Lambda/"/>
    <id>http://ckjava.com/2019/05/17/understand-Java-8-Lambda/</id>
    <published>2019-05-16T16:00:00.000Z</published>
    <updated>2019-06-22T10:12:39.379Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概要"><a href="#1-概要" class="headerlink" title="1 概要"></a>1 概要</h2><ul><li>Lambda 表达式，也可称为闭包或者内部类，返回的是一个接口的实例，是 Java 8 的最重要新特性。</li><li>使用 Lambda 表达式可以使代码变的更加简洁紧凑。</li></ul><h2 id="2-语法"><a href="#2-语法" class="headerlink" title="2 语法"></a>2 语法</h2><p>lambda 表达式的语法格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression</span><br></pre></td></tr></table></figure><p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; &#123; statements; &#125;</span><br></pre></td></tr></table></figure></p><p>以下是 lambda 表达式的重要特征:</p><ol><li>可选类型声明：不需要声明参数类型，编译器可以统一识别参数值。</li><li>可选的参数圆括号：一个参数无需定义圆括号，但多个参数需要定义圆括号。</li><li>可选的大括号：如果主体包含了一个语句，就不需要使用大括号。</li><li>可选的返回关键字：如果主体只有一个表达式返回值则编译器会自动返回值，大括号需要指定明表达式返回了一个数值。</li></ol><h4 id="2-1-可选类型声明"><a href="#2-1-可选类型声明" class="headerlink" title="2.1 可选类型声明"></a>2.1 可选类型声明</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Append</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">doAppend</span><span class="params">(T t1, T t2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">append</span><span class="params">(T t1, T t2, Append&lt;T&gt; append)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> append.doAppend(t1, t2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    String str = AppendUtils.append(<span class="number">1</span>, <span class="number">2</span>, (Integer t1, Integer t2) -&gt; &#123;<span class="keyword">return</span> t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = AppendUtils.append(<span class="number">1</span>, <span class="number">2</span>, (t1, t2) -&gt; &#123;<span class="keyword">return</span> t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(Integer t1, Integer t2) -&gt; {return t1.toString() + t2.toString();}</code></li><li><code>(t1, t2) -&gt; {return t1.toString() + t2.toString();}</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的。</p><h4 id="2-2-可选的参数圆括号"><a href="#2-2-可选的参数圆括号" class="headerlink" title="2.2 可选的参数圆括号"></a>2.2 可选的参数圆括号</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StringParse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">parseString</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringParseUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">parse</span><span class="params">(T t, StringParse&lt;T&gt; stringParse)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringParse.parseString(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String str = StringParseUtils.parse(<span class="number">1</span>, (t) -&gt; t.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = StringParseUtils.parse(<span class="number">1</span>, t -&gt; t.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(t) -&gt; t.toString()</code></li><li><code>t -&gt; t.toString()</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的。</p><h4 id="2-3-可选的大括号"><a href="#2-3-可选的大括号" class="headerlink" title="2.3 可选的大括号"></a>2.3 可选的大括号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2 () &#123;</span><br><span class="line">    String str = AppendUtils.append(1, 2, (Integer t1, Integer t2) -&gt; &#123;return t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = AppendUtils.append(1, 2, (t1, t2) -&gt; t1.toString() + t2.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(Integer t1, Integer t2) -&gt; {return t1.toString() + t2.toString();}</code></li><li><code>(t1, t2) -&gt; t1.toString() + t2.toString()</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的, 并且忽略了 return 关键字</p><h4 id="2-4-可选的返回关键字"><a href="#2-4-可选的返回关键字" class="headerlink" title="2.4 可选的返回关键字"></a>2.4 可选的返回关键字</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test5() throws Exception &#123;</span><br><span class="line">    ExecutorService executorService = Executors.newFixedThreadPool(1);</span><br><span class="line">    /*Future&lt;String&gt; future = executorService.submit(new Callable&lt;String&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public String call() throws Exception &#123;</span><br><span class="line">            return &quot;success&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);*/</span><br><span class="line"></span><br><span class="line">    Future&lt;String&gt; future = executorService.submit(() -&gt; &quot;success&quot;);</span><br><span class="line">    executorService.shutdown();</span><br><span class="line">    System.out.println(future.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>() -&gt; &quot;success&quot;</code> 是 <code>Callable</code> 的实例</li><li>如果没有参数必须要使用 <code>()</code></li><li>忽略了 return 关键字</li></ul><h2 id="3-需要注意的问题"><a href="#3-需要注意的问题" class="headerlink" title="3 需要注意的问题"></a>3 需要注意的问题</h2><ol><li>Lambda 表达式主要用来定义行内执行的方法类型接口，例如，一个简单方法接口。</li><li>Lambda 表达式免去了使用匿名方法的麻烦，并且给予 Java 简单但是强大的函数化的编程能力。</li></ol><h2 id="4-变量作用域"><a href="#4-变量作用域" class="headerlink" title="4 变量作用域"></a>4 变量作用域</h2><ol><li>Lambda 表达式本质上类似于内部类，跟 JavaScript 闭包一样，在 Java 中只能引用标记了 final 的外层局部变量，这就是说不能在 lambda 内部修改定义在域外的局部变量，否则会编译错误。</li></ol><p>定义接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Converter&lt;T&gt; &#123;</span><br><span class="line">    String convert(T t1, T t2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的 c 变量在 Lambda 表达式中不能被修改。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test6() &#123;</span><br><span class="line">    int a = 10;</span><br><span class="line">    int b = 10;</span><br><span class="line">    int c = 10;</span><br><span class="line"></span><br><span class="line">    Converter&lt;Integer&gt; converter = (t1, t2) -&gt; &#123;</span><br><span class="line">        // c += 10; 编译的时候报错</span><br><span class="line">        return String.valueOf(t1+t2+c);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    System.out.println(converter.convert(a, b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5 参考"></a>5 参考</h2><ul><li><a href="https://www.runoob.com/java/java8-lambda-expressions.html" target="_blank" rel="noopener">Java 8 Lambda 表达式</a></li><li><a href="http://blog.oneapm.com/apm-tech/226.html" target="_blank" rel="noopener">深入浅出 Java 8 Lambda 表达式</a></li><li><a href="https://www.cnblogs.com/figure9/p/java-8-lambdas-insideout-language-features.html" target="_blank" rel="noopener">深入理解Java 8 Lambda（语言篇——lambda，方法引用，目标类型和默认方法）</a></li></ul>]]></content>
    
    <summary type="html">
    
      Java 8 Lambda 表达式介绍
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
      <category term="Lambda" scheme="http://ckjava.com/tags/Lambda/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 中双冒号(method reference)的用法</title>
    <link href="http://ckjava.com/2019/05/14/understand-Java-8-method-reference/"/>
    <id>http://ckjava.com/2019/05/14/understand-Java-8-method-reference/</id>
    <published>2019-05-13T16:00:00.000Z</published>
    <updated>2019-06-22T10:12:37.160Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>双冒号（::）是 Java 8 引入 Lambda 表达式后的一种用法，表示方法引用（method reference），可以更加简洁的实例化接口</li><li>双冒号表达式返回的是一个 函数式接口对象（用 @FunctionalInterface 注解的 interface 类型）的实例，如下：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    Consumer&lt;Integer&gt; consumer = System.out::println;</span><br><span class="line">    list.forEach(consumer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// java.util.function.Consumer</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="方法引用-Method-Reference-具体使用"><a href="#方法引用-Method-Reference-具体使用" class="headerlink" title="方法引用 Method Reference 具体使用"></a>方法引用 Method Reference 具体使用</h2><ul><li>双冒号（::）运算符在 Java 8 中被用作方法引用（method reference），方法引用是与 lambda 表达式相关的一个重要特性。</li><li>它提供了一种不执行方法的方法：双冒号的方式只是指明方法引用，具体执行还是传统的方式。</li><li>方法引用需要兼容 函数式接口 组成的目标类型上下文：也就是说被引用的方法的参数和 函数式接口 的参数类型必须一致。</li><li>具体使用方式有以下几种<ol><li>静态方法引用(Reference to a static method)<ul><li>语法：ContainingClass::staticMethodName </li><li>例如：Person::getAge</li></ul></li><li>对象的实例方法引用(Reference to an instance method of a particular object)<ul><li>语法：containingObject::instanceMethodName</li><li>例如：System.out::println</li></ul></li><li>特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)<ul><li>语法：(ContainingType::methodName)</li><li>例如：String::compareToIgnoreCase</li></ul></li><li>类构造器引用语法(Reference to a constructor)：<ul><li>语法：ClassName::new </li><li>例如：ArrayList::new</li></ul></li></ol></li></ul><h4 id="1-静态方法引用-Reference-to-a-static-method"><a href="#1-静态方法引用-Reference-to-a-static-method" class="headerlink" title="1 静态方法引用(Reference to a static method)"></a>1 静态方法引用(Reference to a static method)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toUpperCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(str.toUpperCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toInt</span><span class="params">(Long data)</span> </span>&#123;</span><br><span class="line">        System.out.println(data.intValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"aaaa"</span>, <span class="string">"bbbb"</span>, <span class="string">"cccc"</span>);</span><br><span class="line">    <span class="comment">// 参数是 String, 正确</span></span><br><span class="line">    list.forEach(StringUtils::toUpperCase);</span><br><span class="line">    <span class="comment">// 参数是 Long, 报错</span></span><br><span class="line">    <span class="comment">//list.forEach(StringUtils::toInt);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-对象的实例方法引用-Reference-to-an-instance-method-of-a-particular-object"><a href="#2-对象的实例方法引用-Reference-to-an-instance-method-of-a-particular-object" class="headerlink" title="2 对象的实例方法引用(Reference to an instance method of a particular object)"></a>2 对象的实例方法引用(Reference to an instance method of a particular object)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLowerCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(str.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"AAAA"</span>, <span class="string">"BBBB"</span>, <span class="string">"CCCC"</span>);</span><br><span class="line">    <span class="comment">// 参数是 String, 正确</span></span><br><span class="line">    list.forEach(<span class="keyword">new</span> StringUtils()::toLowerCase);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-特定类型的任意对象实例的方法-Reference-to-an-instance-method-of-an-arbitrary-object-of-a-particular-type"><a href="#3-特定类型的任意对象实例的方法-Reference-to-an-instance-method-of-an-arbitrary-object-of-a-particular-type" class="headerlink" title="3 特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)"></a>3 特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)</h4><ul><li>先看下官方的例子</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] stringArray = &#123; <span class="string">"Barbara"</span>, <span class="string">"James"</span>, <span class="string">"Mary"</span>, <span class="string">"John"</span>, <span class="string">"Patricia"</span>, <span class="string">"Robert"</span>, <span class="string">"Michael"</span>, <span class="string">"Linda"</span> &#125;;</span><br><span class="line">    Arrays.sort(stringArray, String::compareToIgnoreCase);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringArray.length; i++) &#123;</span><br><span class="line">        System.out.println(stringArray[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>String::compareToIgnoreCase</code>：看起来 compareToIgnoreCase 方法应该是 String 类的 static 方法，实际上不是，这怎么理解呢？下面来一一分解：</li></ul><ol><li>这里的 <code>particular type</code> 是指 String 类型</li><li><code>arbitrary object</code> 是指 String 对象</li><li><code>instance method</code> 是指 String 对象的 compareToIgnoreCase</li><li><code>Arrays.sort(stringArray, String::compareToIgnoreCase);</code> 用 lambda 可以写成 <code>Arrays.sort(stringArray, (o1, o2) -&gt; o1.compareToIgnoreCase(o2));</code></li><li>可见 <code>Arrays.sort(T[] a, Comparator&lt;? super T&gt; c)</code> 中的 Comparator 实例第一个参数 o1 为 String 对象本身，o2 为 compareToIgnoreCase 方法的第一个参数，如果还有 o3 那就是第二参数</li></ol><ul><li>基于上面的分析写个例子：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Append</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">append</span><span class="params">(StringAppend a, StringAppend b, StringAppend c)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringAppend</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringAppend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringAppend</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">append</span><span class="params">(StringAppend a, StringAppend b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getData() + a.getData() + b.getData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doAppend</span><span class="params">(String[] arr, Append append)</span> </span>&#123;</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i+<span class="number">2</span> &lt;= arr.length-<span class="number">1</span>) &#123;</span><br><span class="line">                result += append.append(<span class="keyword">new</span> StringAppend(arr[i]), <span class="keyword">new</span> StringAppend(arr[i+<span class="number">1</span>]), <span class="keyword">new</span> StringAppend(arr[i+<span class="number">2</span>]));</span><br><span class="line">                i += <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += append.append(<span class="keyword">new</span> StringAppend(arr[i]), <span class="keyword">new</span> StringAppend(<span class="string">""</span>), <span class="keyword">new</span> StringAppend(<span class="string">""</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] stringArray = &#123; <span class="string">"Barbara"</span>, <span class="string">"James"</span>, <span class="string">"Mary"</span>, <span class="string">"John"</span>, <span class="string">"Mike"</span> &#125;;</span><br><span class="line">    String str1 = StringAppend.doAppend(stringArray, (t1,t2,t3) -&gt; t1.getData()+t2.getData()+t3.getData());</span><br><span class="line">    String str2 = StringAppend.doAppend(stringArray, StringAppend::append);</span><br><span class="line">    Assert.assertTrue(str1.equals(str2));</span><br><span class="line">    System.out.println(str1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终输出为: BarbaraJamesMaryJohnMike</p><h4 id="4-类构造函数用法-Reference-to-a-constructor"><a href="#4-类构造函数用法-Reference-to-a-constructor" class="headerlink" title="4 类构造函数用法(Reference to a constructor)"></a>4 类构造函数用法(Reference to a constructor)</h4><p>下面的 ITool 和 JSONTool 用于将字符串转成 JSON 字符串</p><ul><li>接口定义是传入一个字符串 name, 返回一个 JSONTool 对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITool</span> </span>&#123;</span><br><span class="line">    <span class="function">JSONTool <span class="title">create</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>JSONTool 类的构造函数：<code>public JSONTool(String name)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONTool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JSONTool</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JSONObject <span class="title">parseJSON</span><span class="params">(JSONTool jsonTool)</span> </span>&#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(jsonTool.getName(), jsonTool.getName());</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJSONString</span><span class="params">(String name, ITool iTool)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parseJSON(iTool.create(name)).toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, JSONTool::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"a"</span>:<span class="string">"a"</span>&#125;</span><br></pre></td></tr></table></figure><p>上面的例子分析如下：</p><ol><li>从字面上看 JSONTool::new 返回的是 ITool 接口对象的实例</li><li>因此通过在 getJSONString 方法中调用 ITool 接口对象的实例的 create 方法返回一个 JSONTool 对象</li><li><p>通过 lambda 也可以返回一个 ITool 接口对象实例：<code>t -&gt; new JSONTool(t)</code>，因此测试代码写成下面的方式也可以</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", JSONTool::new));</span></span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, t -&gt; <span class="keyword">new</span> JSONTool(t)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过 Java 1.8 以前的匿名类方法如下</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", JSONTool::new));</span></span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", t -&gt; new JSONTool(t)));</span></span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, <span class="keyword">new</span> ITool() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> JSONTool <span class="title">create</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JSONTool(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li>双冒号相比 Lambda 表达式更加简洁</li><li>将方法作为接口的实例来使用</li></ol><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/lsmsrc/article/details/41747159" target="_blank" rel="noopener">Java8中的[方法引用]“双冒号”——走进Java Lambda(四)</a></li><li><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html" target="_blank" rel="noopener">Java8 method references</a></li><li><a href="https://stackoverflow.com/questions/32855138/how-does-a-method-reference-to-an-instance-method-of-an-arbitrary-object-of-a-p?rq=1" target="_blank" rel="noopener">How does a method “reference to an instance method of an arbitrary object of a particular type” resolve the arbitrary object? </a></li></ul>]]></content>
    
    <summary type="html">
    
      Java 8 中双冒号(method reference)的用法
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
  </entry>
  
  <entry>
    <title>Java List 去重,差集,交集,并集的处理</title>
    <link href="http://ckjava.com/2019/04/25/Java-list-retainAll-addAll-removeAll/"/>
    <id>http://ckjava.com/2019/04/25/Java-list-retainAll-addAll-removeAll/</id>
    <published>2019-04-24T16:00:00.000Z</published>
    <updated>2019-06-22T10:45:19.515Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-List-去重"><a href="#1-List-去重" class="headerlink" title="1 List 去重"></a>1 List 去重</h2><p>list1 中的元素不会有重复</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list1.add(<span class="string">"1111"</span>);</span><br><span class="line">    list1.add(<span class="string">"2222"</span>);</span><br><span class="line">    list1.add(<span class="string">"2222"</span>);</span><br><span class="line">    list1.add(<span class="string">"3333"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list2.add(<span class="string">"3333"</span>);</span><br><span class="line">    list2.add(<span class="string">"4444"</span>);</span><br><span class="line">    list2.add(<span class="string">"5555"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单个List去重复</span></span><br><span class="line">    list1.addAll(list2);</span><br><span class="line">    list1 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">new</span> HashSet&lt;&gt;(list1));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list1:"</span>);</span><br><span class="line">    printList(list1);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list2:"</span>);</span><br><span class="line">    printList(list2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list1:</span><br><span class="line">1111  2222  3333  4444  5555</span><br><span class="line">list2:</span><br><span class="line">3333  4444  5555</span><br></pre></td></tr></table></figure><h2 id="2-List-差集"><a href="#2-List-差集" class="headerlink" title="2 List 差集"></a>2 List 差集</h2><ul><li>removeAll</li></ul><p>从 list1 中去掉 list1 和 list2 相同的元素</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list1.add(<span class="string">"1111"</span>);</span><br><span class="line">    list1.add(<span class="string">"2222"</span>);</span><br><span class="line">    list1.add(<span class="string">"3333"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list2.add(<span class="string">"3333"</span>);</span><br><span class="line">    list2.add(<span class="string">"4444"</span>);</span><br><span class="line">    list2.add(<span class="string">"5555"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 差集, 从list1中去掉 list1 和 list2 相同的元素</span></span><br><span class="line">    list1.removeAll(list2);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list1:"</span>);</span><br><span class="line">    printList(list1);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list2:"</span>);</span><br><span class="line">    printList(list2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list1:</span><br><span class="line">1111  2222</span><br><span class="line">list2:</span><br><span class="line">3333  4444  5555</span><br></pre></td></tr></table></figure><h2 id="3-List-交集"><a href="#3-List-交集" class="headerlink" title="3 List 交集"></a>3 List 交集</h2><ul><li>retainAll</li></ul><p>list1 中只剩下 list1 和 list2 中相同的元素</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list1.add(<span class="string">"1111"</span>);</span><br><span class="line">    list1.add(<span class="string">"2222"</span>);</span><br><span class="line">    list1.add(<span class="string">"3333"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list2.add(<span class="string">"3333"</span>);</span><br><span class="line">    list2.add(<span class="string">"4444"</span>);</span><br><span class="line">    list2.add(<span class="string">"5555"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 交集, 两个list中相同的元素</span></span><br><span class="line">    list1.retainAll(list2);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list1:"</span>);</span><br><span class="line">    printList(list1);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list2:"</span>);</span><br><span class="line">    printList(list2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list1:</span><br><span class="line">3333</span><br><span class="line">list2:</span><br><span class="line">3333  4444  5555</span><br></pre></td></tr></table></figure><h2 id="4-List-并集"><a href="#4-List-并集" class="headerlink" title="4 List 并集"></a>4 List 并集</h2><ul><li>addAll</li></ul><p>list1 中包含原来 list1 和 list2 中的所有元素</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list1.add(<span class="string">"1111"</span>);</span><br><span class="line">    list1.add(<span class="string">"2222"</span>);</span><br><span class="line">    list1.add(<span class="string">"3333"</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list2.add(<span class="string">"3333"</span>);</span><br><span class="line">    list2.add(<span class="string">"4444"</span>);</span><br><span class="line">    list2.add(<span class="string">"5555"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 并集, 可能会有重复</span></span><br><span class="line">    list1.addAll(list2);</span><br><span class="line">    System.out.println(<span class="string">"list1:"</span>);</span><br><span class="line">    printList(list1);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"list2:"</span>);</span><br><span class="line">    printList(list2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list1:</span><br><span class="line">1111  2222  3333  3333  4444  5555</span><br><span class="line">list2:</span><br><span class="line">3333  4444  5555</span><br></pre></td></tr></table></figure><h2 id="5-打印方法"><a href="#5-打印方法" class="headerlink" title="5 打印方法"></a>5 打印方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printList</span><span class="params">(List&lt;String&gt; dataList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String str : dataList) &#123;</span><br><span class="line">        System.out.print(str.concat(<span class="string">"  "</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Java List 去重,差集,交集,并集的处理
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
      <category term="集合" scheme="http://ckjava.com/categories/Java/%E9%9B%86%E5%90%88/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="集合" scheme="http://ckjava.com/tags/%E9%9B%86%E5%90%88/"/>
    
      <category term="List" scheme="http://ckjava.com/tags/List/"/>
    
  </entry>
  
  <entry>
    <title>Java Servlet 中两种重定向 forward 和 sendRedirect 的区分</title>
    <link href="http://ckjava.com/2019/04/25/Java-Servlet-sendRedirect-forward/"/>
    <id>http://ckjava.com/2019/04/25/Java-Servlet-sendRedirect-forward/</id>
    <published>2019-04-24T16:00:00.000Z</published>
    <updated>2019-06-22T10:45:41.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-示例代码"><a href="#1-示例代码" class="headerlink" title="1 示例代码"></a>1 示例代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/"</span>, method = RequestMethod.GET, produces = <span class="string">"text/plain;charset=UTF-8"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//request.getRequestDispatcher("/swagger-ui.html").forward(request, response);</span></span><br><span class="line">    response.sendRedirect(<span class="string">"/swagger-ui.html"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-forward"><a href="#2-forward" class="headerlink" title="2 forward"></a>2 forward</h2><p>简单来说：浏览器想请求 /a 的资源，但是服务器不告知浏览器真正的资源在 /b，直接将 /b 的内容返回给浏览器。</p><ul><li>服务器将 url 的资源直接解析后返回给浏览器</li><li>属于服务器内部跳转，浏览器地址栏的 url 不会发生变化</li><li>浏览器一共进行了一次请求</li></ul><h2 id="3-sendRedirect"><a href="#3-sendRedirect" class="headerlink" title="3 sendRedirect"></a>3 sendRedirect</h2><p>简单来说：浏览器想请求 /a 的资源，但是服务器告知真实的资源在 /b 那里，随后浏览器又去请求 /b 的资源。</p><p>关键点如下：</p><ul><li>服务器将 url 告知浏览器，浏览器随后再次请求 url，</li><li>浏览器地址栏的 url 会发生变化</li><li>服务器响应码为 302，Response Headers 的具体内容如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302</span><br><span class="line">Location: http://localhost:8011/swagger-ui.html</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Sun, 16 Dec 2018 03:57:12 GMT</span><br></pre></td></tr></table></figure><ul><li>浏览器一共进行了两次请求</li></ul>]]></content>
    
    <summary type="html">
    
      Java Servlet 中两种重定向 forward 和 sendRedirect 的区分
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Servlet" scheme="http://ckjava.com/tags/Servlet/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS 中的 filter 组件使用总结</title>
    <link href="http://ckjava.com/2019/03/26/AngularJS-filter-practice/"/>
    <id>http://ckjava.com/2019/03/26/AngularJS-filter-practice/</id>
    <published>2019-03-25T16:00:00.000Z</published>
    <updated>2019-03-26T12:51:11.117Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h4 id="1-两种使用方法"><a href="#1-两种使用方法" class="headerlink" title="1. 两种使用方法"></a>1. 两种使用方法</h4><ol><li>html 中使用：<code>{{ currency_expression | currency : symbol : fractionSize}}</code><ul><li><code>|</code> 左边的 <code>currency_expression</code> 为 源，右边使用 <code>:</code> 分隔，第一个参数表示 filter 名称，后面 <code>symbol</code> 和 <code>fractionSize</code> 是参数</li></ul></li><li>JavaScript 中使用：<code>$filter(&#39;currency&#39;)(amount, symbol, fractionSize)</code><ul><li>首先方法中引入 <code>$filter</code> 依赖</li><li><code>currency</code> 表示 filter 名称， <code>amount</code> 表示 源，<code>symbol</code>, <code>fractionSize</code> 表示其他参数</li></ul></li></ol><h4 id="2-系统自带-Filter-组件介绍"><a href="#2-系统自带-Filter-组件介绍" class="headerlink" title="2. 系统自带 Filter 组件介绍"></a>2. 系统自带 Filter 组件介绍</h4><ol><li><p>filter 从数组对象中获取新的数组：<code>{{ filter_expression | filter : expression : comparator : anyPropertyKey}}</code>，使用如下</p><ul><li>friends 为静态的数组， searchText 为用户的输入，根据用户的输入过滤将返回数组中所有 like <code>%searchText%</code> 的内容，并返回新的数组<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-init</span>=<span class="string">"friends = [&#123;name:'John', phone:'555-1276'&#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">                     &#123;name:'Mary', phone:'800-BIG-MARY'&#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">                     &#123;name:'Mike', phone:'555-4321'&#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">                     &#123;name:'Adam', phone:'555-5678'&#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">                     &#123;name:'Julie', phone:'555-8765'&#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">                     &#123;name:'Juliette', phone:'555-5678'&#125;]"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Search: <span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"searchText"</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"searchTextResults"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Phone<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"friend in friends | filter:searchText"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;friend.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;friend.phone&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>currency 格式化金额：  <code>{{ currency_expression | currency : symbol : fractionSize}}</code>，使用如下</p><ul><li>amount 为 1234.56</li><li><code>{{amount | currency:"USD$ ":2}}</code>，返回 <code>USD$ 1,234.56</code></li><li><code>{{amount | currency:"￥":2}}</code>，返回 <code>￥1,234.56</code></li><li><code>{{amount | currency:"￥":0}}</code>，返回 <code>￥1,234</code></li></ul></li><li><p>date 格式化日期 <code>{{ date_expression | date : format : timezone}}</code></p><ul><li>val 为 1288323623006 </li><li><code>{{val | date:'medium'}}</code>，返回 Oct 29, 2010 11:40:23 AM</li><li><code>{{val | date:'yyyy-MM-dd HH:mm:ss Z'}}</code>，返回 2010-10-29 11:40:23 +0800</li><li><code>{{val | date:'MM/dd/yyyy @ h:mma'}}</code>，返回 10/29/2010 @ 11:40AM</li><li><code>{{val | date:"MM/dd/yyyy 'at' h:mma"}}</code>，返回 10/29/2010 at 11:40AM</li></ul></li><li><p>number 格式化小数 <code>{{ number_expression | number : fractionSize}}</code></p><ul><li>val 为 1234.56789</li><li><code>{{val | number}}</code>，返回 1,234.568</li><li><code>{{val | number:0}}</code>，返回 1,235</li><li><code>{{val | number:0}}</code>，返回 -1,234.5679</li></ul></li><li><p>json 格式化 JSON 对象 <code>{{ json_expression | json : spacing}}</code>, spacing 表示次行的缩进的空格数，默认2个</p><ul><li>val 为 <code>{&#39;name&#39;:&#39;value&#39;}</code></li><li><p><code>{{val | json}}</code>，返回如下</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>{{val | json:4}}</code>，返回如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;value&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol><ol start="6"><li><p>lowercase 转成小写格式 <code>{{ lowercase_expression | lowercase}}</code></p><ul><li>val 为 abc</li><li><code>{{val | lowercase}}</code>，返回 abc</li></ul></li><li><p>uppercase 转成大写格式 <code>{{ uppercase_expression | uppercase}}</code></p><ul><li>val 为 abc</li><li><code>{{val | uppercase}}</code>，返回 ABC</li></ul></li><li><p>limitTo 截取字符串或者元素 <code>{{ limitTo_expression | limitTo : limit : begin}}</code></p><ul><li>str 为 abcdefghi </li><li><code>{{str | limitTo:3}}</code>，返回 abc</li><li>numbers 为 [1,2,3,4,5,6,7,8,9]</li><li><code>{{numbers | number:3}}</code>，返回 [1,2,3]</li></ul></li><li><p>orderBy 数组排序 <code>{{ orderBy_expression | orderBy : expression : reverse : comparator}}</code></p><ul><li>expression 数组中的键, comparator 函数对象</li><li><p>js 如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$scope.friends = [</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'John'</span>,   <span class="attr">favoriteLetter</span>: <span class="string">'Ä'</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'Mary'</span>,   <span class="attr">favoriteLetter</span>: <span class="string">'Ü'</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'Mike'</span>,   <span class="attr">favoriteLetter</span>: <span class="string">'Ö'</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'Adam'</span>,   <span class="attr">favoriteLetter</span>: <span class="string">'H'</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">'Julie'</span>,  <span class="attr">favoriteLetter</span>: <span class="string">'Z'</span>&#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">$scope.localeSensitiveComparator = <span class="function"><span class="keyword">function</span>(<span class="params">v1, v2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// If we don't get strings, just compare by index</span></span><br><span class="line">    <span class="keyword">if</span> (v1.type !== <span class="string">'string'</span> || v2.type !== <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (v1.index &lt; v2.index) ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Compare strings alphabetically, taking locale into account</span></span><br><span class="line">    <span class="keyword">return</span> v1.value.localeCompare(v2.value);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></li><li><p>html 如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"friends"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th</span>&gt;</span>Favorite Letter<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"friend in friends | orderBy:'favoriteLetter':false:localeSensitiveComparator"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;friend.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;friend.favoriteLetter&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="自定义使用"><a href="#自定义使用" class="headerlink" title="自定义使用"></a>自定义使用</h2><ul><li><p>根据系统自带的 filter 函数在 JavaScript 中的使用方式：<code>$filter(&#39;currency&#39;)(amount, symbol, fractionSize)</code>, 可以得出如下结论</p><ol><li><code>$filter(&#39;currency&#39;)</code>: $filter 本身是一个函数，传入一个字符串 <code>currency</code>, 然后再返回一个函数，名称叫 <code>currency</code></li><li><code>currency</code> 函数的参数就是 <code>amount</code>, <code>symbol</code>, <code>fractionSize</code></li><li>最后执行</li></ol></li><li><p>自定义 filter 函数 methodLink 如下</p><ul><li>功能：字符串之间通过 <code>\n</code> 分隔，通过 methodLink 函数返回字符串数组</li><li><code>input</code> 参数为待分隔的字符串</li><li><p>js 如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular.module(<span class="string">'ngApp'</span>, [])</span><br><span class="line">        .filter(<span class="string">'methodLink'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> methodLinkArr = [];</span><br><span class="line">                <span class="keyword">var</span> methodArr = input.split(<span class="string">"\n"</span>);</span><br><span class="line">                angular.forEach(methodArr, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (data != <span class="string">''</span>) &#123;</span><br><span class="line">                        methodLinkArr.push(data);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> methodLinkArr;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li><li><p>html 中使用如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-repeat</span>=<span class="string">"method in rowData.localMethod | methodLink"</span>&gt;</span></span><br><span class="line">    &#123;&#123;method&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><h4 id="1-截取字符串长度"><a href="#1-截取字符串长度" class="headerlink" title="1. 截取字符串长度"></a>1. 截取字符串长度</h4><ul><li><p>在模块中定义 cut filter</p><ul><li><code>cut</code> 参数表示自定义 filter 名称</li><li><code>wordwise (boolean)</code> 参数表示是否截取，true 表示截取</li><li><code>max (integer)</code> 参数表示保留字符串的长度</li><li><code>tail (string, default: &#39; …&#39;)</code> 参数表示字符串截取后用 <code>&#39; …&#39;</code> 替换</li><li><p>js 定义如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'ngApp'</span>)</span><br><span class="line">    .filter(<span class="string">'cut'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">value, wordwise, max, tail</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">            max = <span class="built_in">parseInt</span>(max, <span class="number">10</span>);</span><br><span class="line">            <span class="keyword">if</span> (!max) <span class="keyword">return</span> value;</span><br><span class="line">            <span class="keyword">if</span> (value.length &lt;= max) <span class="keyword">return</span> value;</span><br><span class="line"></span><br><span class="line">            value = value.substr(<span class="number">0</span>, max);</span><br><span class="line">            <span class="keyword">if</span> (wordwise) &#123;</span><br><span class="line">                <span class="keyword">var</span> lastspace = value.lastIndexOf(<span class="string">' '</span>);</span><br><span class="line">                <span class="keyword">if</span> (lastspace !== <span class="number">-1</span>) &#123;</span><br><span class="line">                  <span class="comment">//Also remove . and , so its gives a cleaner result.</span></span><br><span class="line">                  <span class="keyword">if</span> (value.charAt(lastspace<span class="number">-1</span>) === <span class="string">'.'</span> || value.charAt(lastspace<span class="number">-1</span>) === <span class="string">','</span>) &#123;</span><br><span class="line">                    lastspace = lastspace - <span class="number">1</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  value = value.substr(<span class="number">0</span>, lastspace);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> value + (tail || <span class="string">' …'</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li><li><p>html 中使用如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;some_text | cut:true:100:' ...'&#125;&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="2-将字符串分隔成数组"><a href="#2-将字符串分隔成数组" class="headerlink" title="2. 将字符串分隔成数组"></a>2. 将字符串分隔成数组</h4><ul><li><p>字符串为 <code>com.ckjava.service.AnalysisStockService.doAnalysis</code>, 通过 javascript 的 <code>substring</code> 和 <code>lastIndexOf</code> 函数将服务名和方法分隔到一个数组中</p></li><li><p>filter 名为 <code>serviceOrMethod</code></p><ul><li><code>input</code> 参数为待分隔的字符串</li><li><code>index</code> 参数为数组中的索引</li><li><p>js 定义如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'ngApp'</span>)</span><br><span class="line">    .filter(<span class="string">'serviceOrMethod'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input,index</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> serviceMethodArr = [];</span><br><span class="line">                <span class="keyword">if</span> (!input) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                serviceMethodArr.push(input.substring(<span class="number">0</span>, input.lastIndexOf(<span class="string">"."</span>)));</span><br><span class="line">                serviceMethodArr.push(input.substring(input.lastIndexOf(<span class="string">"."</span>)+<span class="number">1</span>));</span><br><span class="line">                <span class="keyword">return</span> serviceMethodArr[index];</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>这里在 <code>ui-select-choices</code> 中使用，具体如下</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">refresh</span>=<span class="string">"searchMethod($select)"</span> <span class="attr">refresh-delay</span>=<span class="string">"300"</span> <span class="attr">repeat</span>=<span class="string">"mtd in searchMethodBuffer track by $index"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span>&gt;</span></span><br><span class="line">        Method: <span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:1 | highlight: $select.search"</span> /&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        Service: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:0 | highlight: $select.search"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-将字符串分隔成数组并直接使用"><a href="#3-将字符串分隔成数组并直接使用" class="headerlink" title="3. 将字符串分隔成数组并直接使用"></a>3. 将字符串分隔成数组并直接使用</h4><ul><li><p>将通过 <code>\n</code> 换行符的字符串，具体如下</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.ckjava.service.AnalysisStockService.doAnalysis</span><br><span class="line">com.ckjava.service.AnalysisStockService.findLastNUp</span><br><span class="line">com.ckjava.service.AnalysisStockService.getIsAnalysis</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>filter 定义如下</p><ul><li><code>input</code> 参数为函数输入值</li><li><p>js 定义如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'ngApp'</span>)</span><br><span class="line">    .filter(<span class="string">'methodLink'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> methodLinkArr = [];</span><br><span class="line">            <span class="keyword">var</span> methodArr = input.split(<span class="string">"\n"</span>);</span><br><span class="line">            angular.forEach(methodArr, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (data != <span class="string">''</span>) &#123;</span><br><span class="line">                    methodLinkArr.push(data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> methodLinkArr;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li>具体使用如下  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-repeat</span>=<span class="string">"method in rowData.localMethod | methodLink"</span>&gt;</span></span><br><span class="line">    &#123;&#123;method&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="4-根据值的不同返回不同的颜色"><a href="#4-根据值的不同返回不同的颜色" class="headerlink" title="4. 根据值的不同返回不同的颜色"></a>4. 根据值的不同返回不同的颜色</h4><ul><li><p>filter 定义如下</p><ul><li><code>input</code> 参数为函数输入值</li><li><p>js 定义如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'ngApp'</span>)</span><br><span class="line">    .filter(<span class="string">'colorType'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">input</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (input === <span class="string">'ERROR'</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'#C9302C'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (input === <span class="string">'EXECUTING'</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'#FFFF01'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (input === <span class="string">'COMPLETED'</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'#63BBB2'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li>具体使用如下  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span> <span class="attr">style</span>=<span class="string">"background-color: &#123;&#123; item.status | colorType &#125;&#125;"</span>&gt;</span>&#123;&#123;item.status&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.angularjs.org/api/ng/filter" target="_blank" rel="noopener">Filter components in ng</a>;</li></ul>]]></content>
    
    <summary type="html">
    
      AngularJS 中的 filter 组件使用总结：包含系统自带 Filter 使用和自定义 Filter 的使用，以及一些使用场景的举例。
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
      <category term="filter" scheme="http://ckjava.com/tags/filter/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 配置跨域访问控制的两种方法</title>
    <link href="http://ckjava.com/2019/03/05/SpringBoot-CORS-practice/"/>
    <id>http://ckjava.com/2019/03/05/SpringBoot-CORS-practice/</id>
    <published>2019-03-04T16:00:00.000Z</published>
    <updated>2019-07-23T13:25:17.297Z</updated>
    
    <content type="html"><![CDATA[<h2 id="跨域访问概念"><a href="#跨域访问概念" class="headerlink" title="跨域访问概念"></a>跨域访问概念</h2><p>CORS（Cross Origin Resource Sharing）跨域资源共享：表示 JavaScript 代码所在的机器和后端 api 所在的机器不是同一台的情况下实现资源访问。</p><p>在前后端分离的项目中，前端一般是 SPA （Single Page Application）类型的应用，所有的 JavaScript 代码都会“下载”到用户机器的浏览器中，后端 api 在服务器端以单个机器或者集群的形式存在。</p><h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><blockquote><p>同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。</p></blockquote><p>由于浏览器的同源策略限制，在前后端分离的项目中必须要考虑这个问题，否则会出现以下错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at &apos;http://localhost:8081/api&apos; from origin &apos;http://localhost:3000&apos; has been blocked by CORS policy: Response to preflight request doesn&apos;t pass access control check: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource.</span><br></pre></td></tr></table></figure><h2 id="HTTP-OPTIONS-请求"><a href="#HTTP-OPTIONS-请求" class="headerlink" title="HTTP OPTIONS 请求"></a>HTTP OPTIONS 请求</h2><p>跨域请求时候首先通过 <code>OPTIONS</code> 方法和请求头中的 <code>Access-Control-Request-Method</code> 属性向服务器端查看是否有请求权限，如果有权限才能继续请求到数据，否则出现上面的错误。有权限时服务器 <code>OPTIONS</code> 请求的响应头基本内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: *</span><br><span class="line">Access-Control-Allow-Headers: *</span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS, HEAD</span><br><span class="line">Access-Control-Allow-Origin: *</span><br></pre></td></tr></table></figure><h2 id="在-SpringBoot-中实现跨域访问的方法"><a href="#在-SpringBoot-中实现跨域访问的方法" class="headerlink" title="在 SpringBoot 中实现跨域访问的方法"></a>在 SpringBoot 中实现跨域访问的方法</h2><h4 id="方法1：通过-Filter-设置通用的响应头"><a href="#方法1：通过-Filter-设置通用的响应头" class="headerlink" title="方法1：通过 Filter 设置通用的响应头"></a>方法1：通过 Filter 设置通用的响应头</h4><ul><li>新建 Filter</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line">httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>,<span class="string">"User-Agent,Origin,Cache-Control,Content-type,Date,Server,withCredentials,AccessToken,username,offlineticket,Authorization"</span>);</span><br><span class="line">httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="string">"true"</span>);</span><br><span class="line">httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"GET, POST, PUT, DELETE, OPTIONS, HEAD"</span>);</span><br><span class="line"></span><br><span class="line">chain.doFilter(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>配置 Filter</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ctrip.payment.filter.CorsFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">registry.addResourceHandler(<span class="string">"swagger-ui.html"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/"</span>);</span><br><span class="line">registry.addResourceHandler(<span class="string">"/webjars/**"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册 cors filter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">someFilterRegistration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean registration = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    registration.setFilter(<span class="keyword">new</span> CorsFilter());</span><br><span class="line">    registration.addUrlPatterns(<span class="string">"/api/*"</span>);</span><br><span class="line">    registration.setName(<span class="string">"corsFilter"</span>);</span><br><span class="line">    registration.setOrder(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法2：通过-CrossOrigin-注解"><a href="#方法2：通过-CrossOrigin-注解" class="headerlink" title="方法2：通过 @CrossOrigin 注解"></a>方法2：通过 <code>@CrossOrigin</code> 注解</h4><p>在 Controller 类上使用如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Api</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/api&quot;)</span><br><span class="line">@CrossOrigin(</span><br><span class="line">        origins = &quot;*&quot;,</span><br><span class="line">        allowedHeaders = &quot;*&quot;,</span><br><span class="line">        allowCredentials = &quot;true&quot;,</span><br><span class="line">        methods = &#123;RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, RequestMethod.OPTIONS, RequestMethod.HEAD&#125;</span><br><span class="line">)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>spring 4.2 以上的版本才有</li><li>不仅作用于类上，也可以用在方法上，支持让类中的某个方法可以跨域请求，<strong>并且方法的配置会重置类上的配置</strong></li><li>参数说明<ul><li>maxAge: 配置响应头的 <code>Access-Control-Max-Age</code></li><li>origins： 配置响应头的 <code>Access-Control-Allow-Origin</code>，<code>*</code> 表示允许所有的请求源</li><li>allowedHeaders： 配置响应头的 <code>Access-Control-Allow-Headers</code>, <code>*</code> 表示允许所有的请求头</li><li>exposedHeaders: 配置响应头的 <code>Access-Control-Expose-Headers</code>，表示允许对应的 user-agent 设置</li><li>methods：表示支持的请求方法，配置：<code>{RequestMethod.GET, RequestMethod.POST}</code></li><li>allowCredentials: 配置响应头的 <code>Access-Control-Allow-Credentials</code>， 表示浏览器请求的时候是否需要带上相关的 cookie<ul><li>如果设置为 “”, 表示 undefined，需要包含相关的 cookie</li><li>如果设置为 false, 表示不需要包含相关的 cookie</li><li>如果设置为 true, 表示需要包含相关的 cookie</li></ul></li></ul></li></ul><h4 id="CorsFilter-和-CrossOrigin-对比"><a href="#CorsFilter-和-CrossOrigin-对比" class="headerlink" title="CorsFilter 和 @CrossOrigin 对比"></a>CorsFilter 和 <code>@CrossOrigin</code> 对比</h4><ul><li><code>@CrossOrigin</code> 注解在 spring 4.2 以上的版本才有</li><li>如果有多个 Controller 类，可以新建一个类，加上 <code>@CrossOrigin</code> 注解，其他 Controller 继承该类即可，具体如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line">@CrossOrigin(</span><br><span class="line">        origins = &quot;*&quot;,</span><br><span class="line">        allowedHeaders = &quot;*&quot;,</span><br><span class="line">        allowCredentials = &quot;true&quot;,</span><br><span class="line">        methods = &#123;RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, RequestMethod.OPTIONS, RequestMethod.HEAD&#125;</span><br><span class="line">)</span><br><span class="line">public class CorsBase &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后 UserController 继承 CorsBase</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Api</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/api&quot;)</span><br><span class="line">public class UserController extends CorsBase &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><ul><li><a href="https://gitee.com/toulezucom/spring-boot-learning/tree/master/spring-boot-cors" target="_blank" rel="noopener">spring-boot-cors</a></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文核心的内容如下</p><ul><li>跨域访问基本概念</li><li>浏览器同源策略以及 HTTP OPTIONS 请求</li><li>在 SpringBoot 中实现跨域访问的方法：Filter 和 <code>@CrossOrigin</code> 注解</li><li>在 SpringBoot 中如何配置 Filter</li><li><code>@CrossOrigin</code> 注解的使用</li></ul>]]></content>
    
    <summary type="html">
    
      SpringBoot 配置跨域访问控制的两种方法
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>深入理解 Java 中的 CLASSPATH 类路径概念</title>
    <link href="http://ckjava.com/2019/03/02/understand-java-classpath/"/>
    <id>http://ckjava.com/2019/03/02/understand-java-classpath/</id>
    <published>2019-03-01T16:00:00.000Z</published>
    <updated>2019-06-22T10:46:06.168Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>在通过命令行方式执行 Java 程序的时候通过 <code>-classpath</code> 选项来指定程序依赖的类库，也可以通过 <code>CLASSPATH</code> 环境变量来指定。</li><li>区别是 <code>-classpath</code> 选项只针对当前程序，而 <code>CLASSPATH</code> 环境变量可以设置到操作系统的环境变量中从而可以针对所有程序。</li><li><p><code>-classpath</code> 选项使用如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar classpath1:classpath2...</span><br></pre></td></tr></table></figure></li><li><p><code>CLASSPATH</code> 环境变量使用如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set CLASSPATH=classpath1;classpath2...</span><br></pre></td></tr></table></figure></li><li><p><code>-cp</code> 是 <code>-classpath</code> 的简写，使用这个参数的 Java 命令还有 jar, javac, javadoc 和 apt, 更详细的说明：<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/index.html" target="_blank" rel="noopener">JDK Tools and Utilities</a></p></li><li>这些 Java 命令位于 <code>${JAVA_HOME}\bin</code> 目录下，通常情况下需要将这个目录设置到操作系统的 <code>path</code> 环境变量中，这样在 cmd 或者 shell 中就可以直接使用这些命令</li><li><code>-classpath</code> 参数值的几种使用情况<ul><li>如果是含有 class 文件的 jar 或者 zip 文件，直接用这些文件名，比如：<code>java -cp utils.jar</code></li><li>如果是一个含有 class 文件的目录， 并且类中没有 package 定义，直接使用目录名，比如：<code>java -jar c:/utils</code></li><li>如果是一个含有 class 文件的目录：c:/utils，而且该目录的类使用了包名: com.ckjava.test，应该这样使用：<code>java -cp c:/utils com.ckjava.test.TestCP</code></li></ul></li><li>windows中多个类路径需要使用 <code>;</code> 分隔，Linux 中使用 <code>:</code></li><li>默认的类路径是当前目录，用 <code>.</code> 表示，可以通过 <code>CLASSPATH</code> 环境变量或者 <code>classpath</code> 参数来覆盖默认的类路径</li><li>如果类中有 package 定义，那么 <code>.</code> 无法表示当前类路径，必须通过 <code>classpath</code> 参数来指定</li></ul><h2 id="PATH-操作系统环境变量和-CLASSPATH-环境变量"><a href="#PATH-操作系统环境变量和-CLASSPATH-环境变量" class="headerlink" title="PATH 操作系统环境变量和 CLASSPATH 环境变量"></a>PATH 操作系统环境变量和 CLASSPATH 环境变量</h2><ul><li>PATH 是操作系统环境变量，CLASSPATH 是 Java 系统的环境变量，PATH 和 CLASSPATH 大小写都可以</li><li><p>下面举个综合的例子，使用了 javac 和 java 命令</p><ul><li><p>TestCP.java, 所在目录: <code>F:\testjava\com\ckjava\test</code> , 内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">package com.ckjava.test;</span><br><span class="line"></span><br><span class="line">public class TestCP &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        TestObj testObj = new TestObj();</span><br><span class="line">        testObj.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>TestObj.java, 所在目录: <code>F:\testjava\com\ckjava\test</code> 内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.ckjava.test;</span><br><span class="line"></span><br><span class="line">public class TestObj &#123;</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        System.out.println(&quot;this is TestObj&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用 javac 编译 TestCP.java 如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f:\&gt;javac -cp F:/testjava F:/testjava/com/ckjava/test/TestCP.java</span><br></pre></td></tr></table></figure><p>其中 <code>-cp</code> 指定了类路径，<strong>注意没有包含包名并且是在 f 盘根目录执行 javac 命令的</strong>，由于 TestCP.java 依赖了 TestObj.java, 执行编译后同时生成了 TestCP.class 和 TestObj.class</p></li><li><p>使用 java 执行 TestCP.class 命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f:\&gt;java -cp F:/testjava com.ckjava.test.TestCP</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this is TestObj</span><br></pre></td></tr></table></figure></li><li><p>上面的 javac 和 java 命令都是配置在操作系统的 PATH 变量中的，如何使用其他版本的 javac 和 java 命令呢？下面的方法可以重置 PATH 操作系统环境变量和 CLASSPATH 环境变量，编写 <code>run.cmd</code> 脚本如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set path=D:\java\jdk1.6.0_25\bin</span><br><span class="line">set classpath=F:/testjava</span><br><span class="line"></span><br><span class="line">javac F:/testjava/com/ckjava/test/TestCP.java</span><br><span class="line">java com.ckjava.test.TestCP</span><br></pre></td></tr></table></figure><p>执行：<code>F:\&gt;testjava\com\ckjava\test\run.cmd</code> 输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this is TestObj</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="类路径通配符"><a href="#类路径通配符" class="headerlink" title="类路径通配符"></a>类路径通配符</h2><ul><li>可以通过<code>*</code>来匹配一个目录的所有 jar 文件，比如：<code>/lib/*</code>，不能通过 <code>/**/*.jar</code> 方式，这个有点弱鸡了。</li><li>而且 <code>/lib/*</code> 这种方式只能匹配 lib 目录下所有 jar 文件，不能匹配 class 文件</li><li><p>下面举个综合的例子</p><ul><li><p>TestUtils.java 内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package com.ckjava.test;</span><br><span class="line">import com.ckjava.utils.StringUtils;</span><br><span class="line"></span><br><span class="line">public class TestUtils &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        if (StringUtils.isNotBlank(args[0])) &#123;</span><br><span class="line">            System.out.println(args[0]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 StringUtils 是在 <code>F:\testjava\lib\commons-lang3-3.5.jar</code> 中</p></li><li><p>run-2.cmd 脚本的内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set path=C:\Program Files\Java\jdk1.8.0_131\bin</span><br><span class="line">set classpath=F:\testjava\lib\*;F:\testjava\</span><br><span class="line"></span><br><span class="line">javac F:/testjava/com/ckjava/test/TestUtils.java</span><br><span class="line">java com.ckjava.test.TestUtils date</span><br></pre></td></tr></table></figure><p>其中通过 <code>F:\testjava\lib\*</code> 指定所有依赖 jar 的位置，<code>F:\testjava\</code> 指定class 文件<br>执行 <code>F:\&gt;testjava\com\ckjava\test\run-2.cmd</code> 输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="遇到的问题：找不到或无法加载主类-Error-Could-not-find-or-load-main-class-…”"><a href="#遇到的问题：找不到或无法加载主类-Error-Could-not-find-or-load-main-class-…”" class="headerlink" title="遇到的问题：找不到或无法加载主类(Error: Could not find or load main class …”)"></a>遇到的问题：找不到或无法加载主类(Error: Could not find or load main class …”)</h2><ul><li><p>错误重现： 到 <code>f:\testjava\com\ckjava\test</code> 目录，执行 <code>javac TestCP.java</code> 命令，可以正常编译 TestObj.class 和  TestCP.class， 但是执行 <code>java TestCP</code> 会出现第一个错误，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f:\testjava\com\ckjava\test&gt;java TestCP</span><br><span class="line">错误: 找不到或无法加载主类 TestCP</span><br></pre></td></tr></table></figure></li><li><p>原因：javac 编译的时候在类源文件的目录下，所以无需通过 <code>-cp</code> 指定类路径，但是通过 java 运行 class 的时候，由于 class 中有包名，所以还需要指定包名才能运行，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">f:\testjava\com\ckjava\test 的目录</span><br><span class="line"></span><br><span class="line">2019/03/03  19:16    &lt;DIR&gt;          .</span><br><span class="line">2019/03/03  19:16    &lt;DIR&gt;          ..</span><br><span class="line">2019/03/03  13:58               193 run-2.cmd</span><br><span class="line">2019/03/03  13:13               148 run.cmd</span><br><span class="line">2019/03/03  19:16               344 TestCP.class</span><br><span class="line">2019/03/03  13:29               174 TestCP.java</span><br><span class="line">2019/03/03  19:16               414 TestObj.class</span><br><span class="line">2019/03/03  11:23               136 TestObj.java</span><br><span class="line">2019/03/03  13:42               249 TestUtils.java</span><br><span class="line">               7 个文件          1,658 字节</span><br><span class="line">               2 个目录 55,266,729,984 可用字节</span><br><span class="line"></span><br><span class="line">f:\testjava\com\ckjava\test&gt;java com.ckjava.test.TestCP</span><br><span class="line">this is TestObj</span><br></pre></td></tr></table></figure></li><li><p>如果在其他目录，那么正确的编译和执行的方式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f:\testjava\com&gt;javac -cp f:\testjava F:/testjava/com/ckjava/test/TestCP.java</span><br><span class="line"></span><br><span class="line">f:\testjava\com&gt;java -cp f:\testjava com.ckjava.test.TestCP</span><br><span class="line">this is TestObj</span><br></pre></td></tr></table></figure></li><li><p>总结：</p><ul><li>javac 命令编译的时候要指定类路径和完整的 Java 源文件路径</li><li>java 命令执行的时候指定类路径和完整的包名，如果没有包名，就无需指定了</li><li><p>如果类文件在 jar 中呢？，具体的指定方式如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">F:\testjava&gt;jar -cvf testLib.jar com/ckjava/test/TestCP.class com/ckjava/test/TestObj.class</span><br><span class="line">已添加清单</span><br><span class="line">正在添加: com/ckjava/test/TestCP.class(输入 = 344) (输出 = 250)(压缩了 27%)</span><br><span class="line">正在添加: com/ckjava/test/TestObj.class(输入 = 414) (输出 = 286)(压缩了 30%)</span><br><span class="line"></span><br><span class="line">F:\testjava&gt;java -cp F:\testjava\testLib.jar com.ckjava.test.TestCP</span><br><span class="line">this is TestObj</span><br></pre></td></tr></table></figure></li><li><p>上面的例子需要注意的地方：<strong>当类中指定了 <code>package com.ckjava.test;</code> 那么在通过 jar 打包的时候类文件也必须带上相应的路径，而且这个路径必须是相对路径。</strong></p></li></ul></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文深入介绍了如下技术点</p><ul><li>JDK 命令行工具 <code>-classpath</code> 参数</li><li>PATH 操作系统环境变量和 CLASSPATH 环境变量，以及 Java 程序执行脚本的编写</li><li>类路径通配符概念以及使用</li><li>JDK 中 javac, java, jar 命令行工具的基本使用</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/classpath.html#A1100592" target="_blank" rel="noopener">Setting the Class Path</a></li></ul>]]></content>
    
    <summary type="html">
    
      深入理解 Java 中的 CLASSPATH 类路径概念
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>将 Java 系统日志由 JUL，Log4j, Log4j2, JCL 转向 SLF4J + Logback</title>
    <link href="http://ckjava.com/2019/02/24/Java-SLF4J-Logback/"/>
    <id>http://ckjava.com/2019/02/24/Java-SLF4J-Logback/</id>
    <published>2019-02-23T16:00:00.000Z</published>
    <updated>2019-06-22T10:45:08.092Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Logback 性能比较好，在编译的时候绑定 slf4j 接口的实现。这里探讨将系统的日志实现由 JUL，Log4j, Log4j2, JCL 转向 slf4j + Logback 的方法。</p><h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><ul><li>JCL 和 slf4j 是接口，日志门面，不负责具体的日志打印，输出等操作</li><li>JUL，Log4j，Log4j2，Logback 是具体日志的实现</li></ul><h2 id="JUL-转向-slf4j"><a href="#JUL-转向-slf4j" class="headerlink" title="JUL 转向 slf4j"></a>JUL 转向 slf4j</h2><p>JUL 就是 jdk 自带的日志系统，位于 <code>java.util.logging</code> 包下，使用如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKLog</span> </span>&#123;</span><br><span class="line">    Logger logger = Logger.getLogger(<span class="string">"JDKLog"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"jul log"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过 jul-to-slf4j 将其转向 slf4j</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 从 jdk-logging到slf4j的桥梁 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jul-to-slf4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="Log4j-转向-slf4j"><a href="#Log4j-转向-slf4j" class="headerlink" title="Log4j 转向 slf4j"></a>Log4j 转向 slf4j</h2><h4 id="Log4j-的使用"><a href="#Log4j-的使用" class="headerlink" title="Log4j 的使用"></a>Log4j 的使用</h4><p>Log4j 使用的时候引入 log4j 依赖，并在项目的 src\main\resources 目录下增加 log4j.xml 配置文件即可</p><ul><li>log4j 依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>log4j.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">'http://jakarta.apache.org/log4j/'</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"myConsole"</span> <span class="attr">class</span>=<span class="string">"org.apache.log4j.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"org.apache.log4j.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"ConversionPattern"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">value</span>=<span class="string">"[%d&#123;dd HH:mm:ss,SSS&#125; %-5p] [%t] %c&#123;2&#125; - %m%n"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--过滤器设置输出的级别--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"org.apache.log4j.varia.LevelRangeFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"levelMin"</span> <span class="attr">value</span>=<span class="string">"debug"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"levelMax"</span> <span class="attr">value</span>=<span class="string">"error"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"AcceptOnMatch"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根logger的设置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">priority</span> <span class="attr">value</span> =<span class="string">"debug"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"myConsole"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4j</span> </span>&#123;</span><br><span class="line">    Logger logger= Logger.getLogger(Log4j.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"log4j1 log"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Log4j log4j = <span class="keyword">new</span> Log4j();</span><br><span class="line">        log4j.log();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[15 16:01:40,977 INFO ] [main] ckjava.Log4j - log4j1 log</span><br></pre></td></tr></table></figure><h4 id="转向-slf4j"><a href="#转向-slf4j" class="headerlink" title="转向 slf4j"></a>转向 slf4j</h4><ul><li>去掉 log4j 依赖并删除 log4j.xml 配置文件</li><li>引入 log4j-over-slf4j 依赖</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- log4j1到slf4j的桥梁 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="Log4j2-转向-slf4j"><a href="#Log4j2-转向-slf4j" class="headerlink" title="Log4j2 转向 slf4j"></a>Log4j2 转向 slf4j</h2><h4 id="Log4j2-的使用"><a href="#Log4j2-的使用" class="headerlink" title="Log4j2 的使用"></a>Log4j2 的使用</h4><ul><li>依赖 log4j-api 和 log4j-core </li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Log4J 2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在 src\main\resources 目录增加 log4j2.xml 配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>具体使用如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class Log4j2 &#123;</span><br><span class="line">    private static final Logger logger = LogManager.getLogger(Log4j2.class);</span><br><span class="line"></span><br><span class="line">    public void log() &#123;</span><br><span class="line">        logger.info(&quot;log4j2 log&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Log4j2 log4j2 = new Log4j2();</span><br><span class="line">        log4j2.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">16:21:03.623 [main] INFO  com.ckjava.Log4j2 - log4j2 log</span><br></pre></td></tr></table></figure><h4 id="转向-slf4j-1"><a href="#转向-slf4j-1" class="headerlink" title="转向 slf4j"></a>转向 slf4j</h4><ul><li>去掉 log4j-api 和 log4j-core 依赖，删除 log4j2.xml 配置文件</li><li>增加 log4j-to-slf4j 依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将 log4j2的日志桥接到 slf4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JCL-详解"><a href="#JCL-详解" class="headerlink" title="JCL 详解"></a>JCL 详解</h2><h4 id="具体的使用"><a href="#具体的使用" class="headerlink" title="具体的使用"></a>具体的使用</h4><ul><li>JCL 是 jakarta.commons.logging，日志接口，需要绑定具体的日志框架才能使用</li><li>如果项目仅引入 commons-logging， 那么默认的日志框架就是 JUL。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如果项目引入了 commons-logging + log4j， 那么 JCL 由 log4j 日志框架来实现，不需要桥接到 log4j</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如果项目引入了 commons-logging + log4j-api + log4j-core, 那么 JCL 由 log4j2 日志框架来实现, 还需要再加入 log4j-jcl，将 jcl 桥接到 log4j 输出。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Log4J 2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Apache Commons Logging Bridge --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jcl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如果项目引入了 commons-logging + logback-classic + logback-core，那么 JCL 由 logback 日志框架来实现, 还需要再加入 jcl-over-slf4j，将 jcl 桥接到 logback 输出。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- commons-logging到slf4j的桥梁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- logback --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line"></span><br><span class="line">public class CommonsLog &#123;</span><br><span class="line">    private static Log log = LogFactory.getLog(CommonsLog.class);</span><br><span class="line"></span><br><span class="line">    public void log() &#123;</span><br><span class="line">        log.info(&quot;Commons Log &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        CommonsLog commonsLog = new CommonsLog();</span><br><span class="line">        commonsLog.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">17:10:51.340 [main] INFO  com.ckjava.CommonsLog - Commons Log</span><br></pre></td></tr></table></figure><h4 id="转向-slf4j-2"><a href="#转向-slf4j-2" class="headerlink" title="转向 slf4j"></a>转向 slf4j</h4><ul><li>通过 jcl-over-slf4j 将 commons-logging 转向 slf4j</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- commons-logging到slf4j的桥梁 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="slf4j-Logback-日志输出"><a href="#slf4j-Logback-日志输出" class="headerlink" title="slf4j + Logback 日志输出"></a>slf4j + Logback 日志输出</h2><p>slf4j 也是一个日志接口，默认由 Logback 日志框架来实现，并且它们是同一个作者开发的。</p><ul><li>slf4j + Logback 依赖如下</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SLF4J+LogBack--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>在 src\main\resources 目录增加 logback 配置文件 logback.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"STDOUT"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.ckjava"</span> <span class="attr">level</span>=<span class="string">"TRACE"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"trace"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"STDOUT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">public class LogBack &#123;</span><br><span class="line">    static final Logger logger = LoggerFactory.getLogger(LogBack.class);</span><br><span class="line"></span><br><span class="line">    public void log() &#123;</span><br><span class="line">        logger.info(&quot;LogBack log&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        LogBack logBack = new LogBack();</span><br><span class="line">        logBack.log();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">17:31:28.006 [main] INFO  com.ckjava.LogBack - LogBack log</span><br></pre></td></tr></table></figure><h2 id="混合使用"><a href="#混合使用" class="headerlink" title="混合使用"></a>混合使用</h2><p>对于一些比较老的项目，经过了N多人的手，并且由于引入了很多三方依赖，目前项目中已经有了 JUL，Log4j, Log4j2, JCL和 SLF4J，既想输出三方依赖框架中的日志，又要保证项目中的日志正常输出，这个时候该怎么办？</p><p>具体如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 从 jdk-logging到slf4j的桥梁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jul-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- log4j1到slf4j的桥梁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">&lt;!-- 将 log4j2的日志桥接到 slf4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- commons-logging --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- commons-logging到slf4j的桥梁 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--SLF4J+LogBack--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置文件就是 logback.xml</li><li>测试如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">JDKLog jdkLog = new JDKLog();</span><br><span class="line">jdkLog.log();</span><br><span class="line"></span><br><span class="line">Log4J log4j = new Log4J();</span><br><span class="line">log4j.log();</span><br><span class="line"></span><br><span class="line">Log4J2 log4j2 = new Log4J2();</span><br><span class="line">log4j2.log();</span><br><span class="line"></span><br><span class="line">CommonsLog commonsLog = new CommonsLog();</span><br><span class="line">commonsLog.log();</span><br><span class="line"></span><br><span class="line">LogBack logBack = new LogBack();</span><br><span class="line">logBack.log();</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一月 15, 2019 5:42:45 下午 com.ckjava.JDKLog log</span><br><span class="line">信息: jul log</span><br><span class="line">17:42:45.390 [main] INFO  com.ckjava.Log4J - log4j1 log</span><br><span class="line">17:42:45.423 [main] INFO  com.ckjava.Log4J2 - log4j2 log</span><br><span class="line">17:42:45.447 [main] INFO  com.ckjava.CommonsLog - Commons Log </span><br><span class="line">17:42:45.448 [main] INFO  com.ckjava.LogBack - LogBack log</span><br></pre></td></tr></table></figure><ul><li>注意：<strong>同时需要排除 log4j，log4j-api 和 log4j-core 依赖</strong>，否则会出现类似如下错误</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log4j:WARN No appenders could be found for logger (org.apache.ibatis.thread.Runnable).</span><br><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br></pre></td></tr></table></figure><h2 id="Java-日志最佳实践"><a href="#Java-日志最佳实践" class="headerlink" title="Java 日志最佳实践"></a>Java 日志最佳实践</h2><p>在大型项目开发中系统往往会分成很多模块, 比如在使用 Maven 开发 Java Web 项目中通常会以 Dao, Service, Web 分成多个项目, 每个项目都会使用日志记录功能, 而项目之间又会产生依赖 Web-&gt;Service-&gt;Dao. 这个时候只需要在 Dao 和 Service 中增加日志门面依赖即可, 也就是引入 slf4j-api. 在 Web 中引入具体的日志框架.</p><p>而在分布式服务架构中 Service 会以单独的项目启动, 此时也要引入具体的日志框架.</p>]]></content>
    
    <summary type="html">
    
      Logback 性能比较好，在编译的时候绑定 slf4j 接口的实现。这里探讨将系统的日志实现由 JUL，Log4j, Log4j2, JCL 转向 slf4j + Logback 的方法。
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
      <category term="日志" scheme="http://ckjava.com/categories/Java/%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="日志" scheme="http://ckjava.com/tags/%E6%97%A5%E5%BF%97/"/>
    
      <category term="SLF4J" scheme="http://ckjava.com/tags/SLF4J/"/>
    
      <category term="Logback" scheme="http://ckjava.com/tags/Logback/"/>
    
  </entry>
  
  <entry>
    <title>WebJars 的介绍以及在 SpringBoot 中的使用</title>
    <link href="http://ckjava.com/2019/02/22/SpringBoot-webjars-usage/"/>
    <id>http://ckjava.com/2019/02/22/SpringBoot-webjars-usage/</id>
    <published>2019-02-21T16:00:00.000Z</published>
    <updated>2019-07-23T13:25:11.607Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>简单来说，WebJars 就是将 web 依赖（js，css）放到 jar 文件中，然后通过 Maven 的形式依赖到项目中，避免手工下载这些依赖。从纯前端角度来说，依赖管理有 npm, Bower, 后端有 Maven, Gradle，WebJars 就是让 web 依赖能够运行在后端 Jvm 上的技术。</p><p>像 Bootstrap, jQuery, Angular JS, Chart.js 等都在 <a href="https://www.webjars.org/" target="_blank" rel="noopener">webjars 官网</a> 上可以找到。</p><h2 id="为什么使用-WebJars？"><a href="#为什么使用-WebJars？" class="headerlink" title="为什么使用 WebJars？"></a>为什么使用 WebJars？</h2><p>显而易见，因为简单。但不仅是依赖这么简单：</p><ul><li>清晰的管理 web 依赖</li><li>通过 Maven, Gradle 等项目管理工具就可以下载 web 依赖</li><li>解决 web 组件中传递依赖的问题以及版本问题</li><li>页面依赖的版本自动检测功能</li></ul><h2 id="Maven-依赖"><a href="#Maven-依赖" class="headerlink" title="Maven 依赖"></a>Maven 依赖</h2><p>在 Maven 中通过下面的依赖就可以将 bootstrap 和 jquery 引入到项目中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.7-1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jquery&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.1.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>依赖导入了，这些 js 和 css 文件都在 classPath 路径下的 <code>META-INF/resources/webjars</code> 目录下。</p><ul><li>在 SpringMVC 中通过实现 WebMvcConfigurer 接口来定义这些静态文件的访问入口，具体如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebConfig implements WebMvcConfigurer &#123;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) &#123;</span><br><span class="line">        registry</span><br><span class="line">            .addResourceHandler(&quot;/webjars/**&quot;)</span><br><span class="line">            .addResourceLocations(&quot;classpath:/META-INF/resources/webjars/&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>xml 方式类似的配置如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:resources mapping=&quot;/webjars/**&quot; location=&quot;classpath:/META-INF/resources/webjars/&quot; /&gt;</span><br></pre></td></tr></table></figure><ul><li>如果使用 SpringBoot，上面的配置也可以忽略，系统自动将 <code>/META-INF/resources/webjars</code> 映射到 <code>/webjars</code> 请求路径上。</li></ul><h2 id="自动检测依赖的版本"><a href="#自动检测依赖的版本" class="headerlink" title="自动检测依赖的版本"></a>自动检测依赖的版本</h2><p>如果使用 Spring 4.2 以上的版本，并且加入 webjars-locator 组件，就不需要在 html 添加依赖的时候填写版本。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.webjars&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;webjars-locator&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.30&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>之前是 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>引入 webjars-locator 后是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;/webjars/bootstrap/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><strong>注意：只能去掉版本号</strong></p><h2 id="前端页面使用"><a href="#前端页面使用" class="headerlink" title="前端页面使用"></a>前端页面使用</h2><p>编写 index.html 如下，将其放到 <code>src\main\resources\public\index.html</code> 目录下，启动项目，访问 <code>http://localhost:8080/</code> 即可看到效果。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;webjars 测试&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--&lt;script src=&quot;/webjars/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/webjars/bootstrap/3.3.7-1/css/bootstrap.min.css&quot; /&gt;--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;/webjars/jquery/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/webjars/bootstrap/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/webjars/bootstrap/css/bootstrap.min.css&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;&lt;br/&gt;</span><br><span class="line">        &lt;div class=&quot;alert alert-success&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;#&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;close&quot;&gt;×&lt;/a&gt;</span><br><span class="line">            &lt;strong&gt;Success!&lt;/strong&gt; It is working as we expected.</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>由于 SpringBoot 自动将 classpath 下的 <code>/static</code>, <code>/public</code>, <code>/resources</code>, <code>/META-INF/resources</code> 这些目录自动映射到 <code>/**</code> 请求路径上，因此访问 <code>http://localhost:8080/</code> 就可以找到 <code>public\index.html</code>。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><ul><li><a href="https://gitee.com/toulezucom/spring-boot-learning/tree/master/spring-boot-webjars" target="_blank" rel="noopener">spring-boot-webjars</a></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了 WebJars 的相关功能以及和 SpringBoot 集成的一个例子。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.baeldung.com/maven-webjars" target="_blank" rel="noopener">Introduction to WebJars</a></li><li><a href="https://www.webjars.org/documentation" target="_blank" rel="noopener">webjar doc</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文介绍了 WebJars 的相关功能以及和 SpringBoot 集成的一个例子。
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="webjars" scheme="http://ckjava.com/tags/webjars/"/>
    
  </entry>
  
  <entry>
    <title>在 Spring 中集成 velocity</title>
    <link href="http://ckjava.com/2018/09/19/Spring-SpringMVC-integration-velocity-practice/"/>
    <id>http://ckjava.com/2018/09/19/Spring-SpringMVC-integration-velocity-practice/</id>
    <published>2018-09-18T16:00:00.000Z</published>
    <updated>2018-09-19T15:28:46.228Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在-SpringMVC-项目中集成-velocity"><a href="#在-SpringMVC-项目中集成-velocity" class="headerlink" title="在 SpringMVC 项目中集成 velocity"></a>在 SpringMVC 项目中集成 velocity</h2><p>这种方式的话 velocity 的所有配置都在 xml 文件中。</p><h3 id="1-在-pom-xml-中引入-velocity-的-jar-包"><a href="#1-在-pom-xml-中引入-velocity-的-jar-包" class="headerlink" title="1. 在 pom.xml 中引入 velocity 的 jar 包"></a>1. 在 pom.xml 中引入 velocity 的 jar 包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- velocity核心包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-tools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- velocity核心包 --&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-视图配置"><a href="#2-视图配置" class="headerlink" title="2. 视图配置"></a>2. 视图配置</h3><p>在 <code>springMVC-servlet.xml</code> 文件中配置, 这里使用 VelocityLayoutViewResolver 对象, 需要默认的布局文件.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 视图模式配置,velocity配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"velocityConfig"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.velocity.VelocityConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"resourceLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/velocity/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:velocity.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置后缀</span></span><br><span class="line"><span class="comment">默认 VelocityViewResolver 就可以了,如果需要使用 layout 功能, 需要使用 VelocityLayoutViewResolver</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"velocityViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.velocity.VelocityLayoutViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".vm"</span> /&gt;</span><span class="comment">&lt;!-- 视图文件的后缀名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"toolboxConfigLocation"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/velocity/tools.xml"</span> /&gt;</span><span class="comment">&lt;!--toolbox配置文件路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dateToolAttribute"</span> <span class="attr">value</span>=<span class="string">"date"</span> /&gt;</span><span class="comment">&lt;!--日期函数名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"numberToolAttribute"</span> <span class="attr">value</span>=<span class="string">"number"</span> /&gt;</span><span class="comment">&lt;!--数字函数名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"contentType"</span> <span class="attr">value</span>=<span class="string">"text/html;charset=UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exposeSpringMacroHelpers"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span><span class="comment">&lt;!--是否使用spring对宏定义的支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exposeRequestAttributes"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span><span class="comment">&lt;!--是否开放request属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"requestContextAttribute"</span> <span class="attr">value</span>=<span class="string">"rc"</span>/&gt;</span><span class="comment">&lt;!--request属性引用名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exposeSessionAttributes"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"layoutUrl"</span> <span class="attr">value</span>=<span class="string">"layout/default.vm"</span>/&gt;</span><span class="comment">&lt;!--指定layout文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"order"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-配置-velocity-properties"><a href="#3-配置-velocity-properties" class="headerlink" title="3. 配置 velocity.properties"></a>3. 配置 velocity.properties</h3><p><code>velocity.properties</code> 和 <code>springMVC-servlet.xml</code> 文件都在 <code>src/main/resources</code> 目录下,</p><p>velocity.properties 内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#encoding</span><br><span class="line">input.encoding=UTF-8</span><br><span class="line">output.encoding=UTF-8</span><br><span class="line">#autoreload when vm changed</span><br><span class="line">file.resource.loader.cache=false</span><br><span class="line">file.resource.loader.modificationCheckInterval=2</span><br><span class="line">velocimacro.library.autoreload=false</span><br></pre></td></tr></table></figure><h3 id="4-页面布局-layout-的使用"><a href="#4-页面布局-layout-的使用" class="headerlink" title="4. 页面布局 layout 的使用"></a>4. 页面布局 layout 的使用</h3><p>系统默认布局文件 <code>default.vm</code> 具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Spring MVC and Velocity&lt;/title&gt;</span><br><span class="line">    #*&lt;link rel=&quot;stylesheet&quot; href=&quot;&quot; media=&quot;all&quot; type=&quot;text/css&quot;&gt;*#</span><br><span class="line">    &lt;script src=&quot;#springUrl(&apos;/plugins/jQuery/jquery-2.2.3.min.js&apos;)&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div align=&quot;center&quot;&gt;</span><br><span class="line">    &lt;table class=&quot;tabellaLayout&quot;&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;div align=&quot;center&quot;&gt;#parse(&quot;layout/header.vm&quot;)&lt;/div&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;div align=&quot;center&quot;&gt;$screen_content&lt;/div&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;div align=&quot;center&quot;&gt;#parse(&quot;layout/footer.vm&quot;)&lt;/div&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="5-配置-tools-xml"><a href="#5-配置-tools-xml" class="headerlink" title="5. 配置 tools.xml"></a>5. 配置 tools.xml</h3><p>tools.xml 是 velocity 中 VelocityToolboxView 对象的配置文件，如果没有这个文件系统也不会初始化这个对象。文件默认位于项目的 <code>/WEB-INF/</code> 目录下。</p><p>具体内容如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">toolbox</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tool</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>mathTool<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>application<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>org.apache.velocity.tools.generic.MathTool<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tool</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tool</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>numberTool<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>application<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>org.apache.velocity.tools.generic.NumberTool<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"#0.00"</span>/&gt;</span> <span class="comment">&lt;!--2--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">name</span>=<span class="string">"locale"</span> <span class="attr">value</span>=<span class="string">"zh_CN"</span>/&gt;</span> <span class="comment">&lt;!--3--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tool</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tool</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>dateTool<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>application<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>org.apache.velocity.tools.generic.DateTool<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">name</span>=<span class="string">"format"</span> <span class="attr">value</span>=<span class="string">"yyyy/MM/dd HH:mm:ss"</span>/&gt;</span> <span class="comment">&lt;!--2--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">name</span>=<span class="string">"locale"</span> <span class="attr">value</span>=<span class="string">"zh_CN"</span>/&gt;</span> <span class="comment">&lt;!--3--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">name</span>=<span class="string">"timezone"</span> <span class="attr">value</span>=<span class="string">"Asia/Shanghai"</span>/&gt;</span> <span class="comment">&lt;!--4--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tool</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tool</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>listTool<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>application<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>org.apache.velocity.tools.generic.ListTool<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tool</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tool</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>escTool<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>application<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">class</span>&gt;</span>org.apache.velocity.tools.generic.EscapeTool<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tool</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">toolbox</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在 vm 文件中的使用方法如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$dateTool.format($!&#123;now&#125;)</span><br></pre></td></tr></table></figure><p>其中 dateTool 是 <code>tools.xml</code> 文件中的 key 的元素名称, format, locale, timezone 表示 DateTool 对象的三个配置参数.</p><h3 id="6-编写-Controller-和-页面"><a href="#6-编写-Controller-和-页面" class="headerlink" title="6. 编写 Controller 和 页面"></a>6. 编写 Controller 和 页面</h3><ul><li>VelocityController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test/velocity"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VelocityController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(&#123;<span class="string">"/myVelocity.do"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">test</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">"myVelocity"</span>);</span><br><span class="line">        mv.addObject(<span class="string">"key"</span>, <span class="string">"我来了，velocity！"</span>);</span><br><span class="line">        mv.addObject(<span class="string">"now"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>myVelocity.vm</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;show all users&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        alert(&quot;sss&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        $!&#123;key&#125;</span><br><span class="line">        $dateTool.format($!&#123;now&#125;)</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>项目启动后, 访问 <code>http://localhost:8012/test/velocity/myVelocity.do</code>, 返回内容如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header...</span><br><span class="line">我来了，velocity！</span><br><span class="line">footer...</span><br></pre></td></tr></table></figure><h2 id="在-Spring-中使用-velocity"><a href="#在-Spring-中使用-velocity" class="headerlink" title="在 Spring 中使用 velocity"></a>在 Spring 中使用 velocity</h2><p>也就是不通过 xml 配置的方式来使用，将 VelocityEngine 配置成一个 Spring Bean 对象，可以用于邮件模板，或者代码模板。Maven 依赖和上面的一样。</p><p>VelocityEngine 配置如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.velocity.app.VelocityEngine;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.RuntimeConstants;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VelocityConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> VelocityEngine <span class="title">velocityEngine</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">VelocityEngine velocityEngine = <span class="keyword">new</span> VelocityEngine();</span><br><span class="line"></span><br><span class="line">velocityEngine.setProperty(RuntimeConstants.RESOURCE_LOADER, <span class="string">"classpath"</span>);</span><br><span class="line">velocityEngine.setProperty(<span class="string">"classpath.resource.loader.class"</span>, ClasspathResourceLoader.class.getName());</span><br><span class="line">velocityEngine.setProperty(RuntimeConstants.INPUT_ENCODING, <span class="string">"UTF-8"</span>);</span><br><span class="line">velocityEngine.setProperty(RuntimeConstants.OUTPUT_ENCODING, <span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">velocityEngine.init();</span><br><span class="line"><span class="keyword">return</span> velocityEngine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.velocity.Template;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.VelocityContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.app.VelocityEngine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessVelocityTemplate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> VelocityEngine velocityEngine;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getVelocityResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Template template = velocityEngine.getTemplate(<span class="string">"vtls/hellovelocity.vm"</span>);</span><br><span class="line">VelocityContext ctx = <span class="keyword">new</span> VelocityContext();</span><br><span class="line"></span><br><span class="line">ctx.put(<span class="string">"name"</span>, <span class="string">"模板velocity"</span>);</span><br><span class="line">ctx.put(<span class="string">"date"</span>, (<span class="keyword">new</span> Date()).toString());</span><br><span class="line"></span><br><span class="line">List temp = <span class="keyword">new</span> ArrayList();</span><br><span class="line">temp.add(<span class="string">"1"</span>);</span><br><span class="line">temp.add(<span class="string">"2"</span>);</span><br><span class="line">ctx.put(<span class="string">"list"</span>, temp);</span><br><span class="line"></span><br><span class="line">StringWriter sw = <span class="keyword">new</span> StringWriter();</span><br><span class="line"></span><br><span class="line">template.merge(ctx, sw);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sw.toString();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中需要注意的是 <code>hellovelocity.vm</code> 位于 Maven 项目中的 <code>src/main/resources/vtls</code> 目录下。</p>]]></content>
    
    <summary type="html">
    
      在 Spring 或者 SpringMVC 中集成 velocity 的方法
    
    </summary>
    
      <category term="模板技术" scheme="http://ckjava.com/categories/%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="velocity" scheme="http://ckjava.com/categories/%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF/velocity/"/>
    
    
      <category term="模板技术" scheme="http://ckjava.com/tags/%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF/"/>
    
      <category term="velocity" scheme="http://ckjava.com/tags/velocity/"/>
    
  </entry>
  
</feed>
