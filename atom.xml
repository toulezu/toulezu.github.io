<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ckJava</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://ckjava.com/"/>
  <updated>2019-08-23T13:13:48.975Z</updated>
  <id>http://ckjava.com/</id>
  
  <author>
    <name>ck</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>解决 Mysql 在 Delete 语句中使用子查询时遇到的问题</title>
    <link href="http://ckjava.com/2019/08/23/Mysql-Delete-error-you-cant-specify-target-table-x-for-update-in-from/"/>
    <id>http://ckjava.com/2019/08/23/Mysql-Delete-error-you-cant-specify-target-table-x-for-update-in-from/</id>
    <published>2019-08-22T16:00:00.000Z</published>
    <updated>2019-08-23T13:13:48.975Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>错误提示如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You can&apos;t specify target table &apos;x&apos; for update in FROM clause</span><br></pre></td></tr></table></figure><p>出现问题的语句如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM publish_plan_log WHERE id IN (</span><br><span class="line">SELECT l.id FROM publish_plan_log l WHERE NOT EXISTS (SELECT 1 FROM publish_plan pp WHERE pp.id = l.plan_id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2 原因"></a>2 原因</h2><p>原因是 Mysql 不允许在更新一个表的同时又查询了该表。</p><p>解决的方法也很简单：在查询的时候包裹一层。具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM publish_plan_log WHERE id IN (</span><br><span class="line">SELECT l.id FROM (SELECT * FROM publish_plan_log) l WHERE NOT EXISTS (SELECT 1 FROM publish_plan pp WHERE pp.id = l.plan_id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="3-参考"><a href="#3-参考" class="headerlink" title="3 参考"></a>3 参考</h2><ul><li><a href="https://stackoverflow.com/questions/37251621/how-to-resolve-mysql-error-you-cant-specify-target-table-x-for-update-in-from" target="_blank" rel="noopener">How to resolve MySQL error “You can’t specify target table X for update in FROM clause”? [duplicate]</a></li></ul>]]></content>
    
    <summary type="html">
    
      解决 Mysql 在 Delete 语句中使用子查询时遇到的问题
    
    </summary>
    
      <category term="MySql" scheme="http://ckjava.com/categories/MySql/"/>
    
    
      <category term="MySql" scheme="http://ckjava.com/tags/MySql/"/>
    
  </entry>
  
  <entry>
    <title>详细介绍 Java 8 中的 default 关键字与 @FunctionalInterface 注解</title>
    <link href="http://ckjava.com/2019/08/23/understand-Java-8-default-FunctionalInterface/"/>
    <id>http://ckjava.com/2019/08/23/understand-Java-8-default-FunctionalInterface/</id>
    <published>2019-08-22T16:00:00.000Z</published>
    <updated>2019-08-23T12:50:37.639Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文介绍如下内容</p><ol><li>Java 8 default 关键字介绍以及使用</li><li>对 <code>@FunctionalInterface</code> 注解的理解以及使用</li></ol><h2 id="2-default-关键字介绍"><a href="#2-default-关键字介绍" class="headerlink" title="2 default 关键字介绍"></a>2 default 关键字介绍</h2><ul><li>default 是在 java8 中引入的关键字，也可称为 Virtual extension methods ——虚拟扩展方法。</li><li>虚拟扩展方法是指：在接口内部包含了一些默认的方法实现（也就是接口中可以包含方法体，这打破了Java之前版本对接口的语法限制），从而使得接口在进行扩展的时候，不会破坏与接口相关的实现类代码。</li><li>也就是说：在不修改现有接口实现类的情况下，通过在接口层面增加方法就可以扩展实现类的功能，神奇吧？</li></ul><h4 id="2-1-为什么要增加-default-关键字"><a href="#2-1-为什么要增加-default-关键字" class="headerlink" title="2.1 为什么要增加 default 关键字"></a>2.1 为什么要增加 default 关键字</h4><p>java 8 之前接口中全是抽象方法，好处是面向抽象而不是面向具体编程。</p><p>缺陷是，当需要修改接口时候，需要修改全部实现该接口的类，比如 java8 之前的集合框架没有 foreach 方法，通常能想到的解决办法是在 JDK 里给相关的接口添加新的方法及实现。然而，对于已经发布的版本，是没法在给接口添加新方法的同时不影响已有的实现。</p><p>所以引入 default 关键字。他们的目的是为了解决接口的修改与现有的实现不兼容的问题。</p><h4 id="2-2-default-关键字的使用"><a href="#2-2-default-关键字的使用" class="headerlink" title="2.2 default 关键字的使用"></a>2.2 default 关键字的使用</h4><ul><li>定义 Calculate 接口如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Calculate</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">BigDecimal</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">add</span><span class="params">(T t1, T t2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> BigDecimal <span class="title">average</span><span class="params">(T t1, T t2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> add(t1, t2).divide(<span class="keyword">new</span> BigDecimal(<span class="number">2</span>), <span class="number">0</span>, BigDecimal.ROUND_HALF_UP);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>CalculateSub 实现了 Calculate 接口，具体如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculateSub</span> <span class="keyword">implements</span> <span class="title">Calculate</span>&lt;<span class="title">BigDecimal</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">add</span><span class="params">(BigDecimal t1, BigDecimal t2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t1.add(t2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CalculateSub calculateSub = <span class="keyword">new</span> CalculateSub();</span><br><span class="line">        BigDecimal result = calculateSub.add(BigDecimal.valueOf(<span class="number">2</span>), BigDecimal.valueOf(<span class="number">2</span>));</span><br><span class="line">        System.out.println(String.format(<span class="string">"result:%s"</span>, result)); <span class="comment">// result:4</span></span><br><span class="line">        System.out.println(String.format(<span class="string">"average:%s"</span>, calculateSub.average(BigDecimal.valueOf(<span class="number">4</span>), BigDecimal.valueOf(<span class="number">2</span>)))); <span class="comment">// average:3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>从上面的例子输出可以看出:</li></ul><ol><li>实现类 CalculateSub 也可以使用 Calculate 接口中定义的由 default 关键字修饰的 average 方法</li><li>实现类 CalculateSub 中仅重写了 add 方法，这意味着 Calculate 接口中 average 方法（由 default 修饰）可以不用重写了，未来在 Calculate 接口中增加或者减少 default 修饰的方法都不用修改 CalculateSub 类。</li></ol><h2 id="3-FunctionalInterface-注解"><a href="#3-FunctionalInterface-注解" class="headerlink" title="3 @FunctionalInterface 注解"></a>3 <code>@FunctionalInterface</code> 注解</h2><h4 id="3-1-FunctionalInterface-注解的特点"><a href="#3-1-FunctionalInterface-注解的特点" class="headerlink" title="3.1 @FunctionalInterface 注解的特点"></a>3.1 <code>@FunctionalInterface</code> 注解的特点</h4><ol><li>该注解作用于接口类型上</li><li>在编译的时候提醒只能有一个抽象方法</li></ol><p><code>@FunctionalInterface</code> 注解在编译的时候如果发现接口中没有或者超过一个抽象方法就会报错：<code>Multiple non-overriding abstract methods found in interface ...</code>，具体如下</p><p><img src="data:image/png;base64,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" alt="image"></p><p>也即是说带有 <code>@FunctionalInterface</code> 注解的接口只能有一个抽象方法，表示是函数式编程接口。</p><p>通常用在将一个接口对象作为参数的情况，好处是在调用的时候只需要实现一个方法就可以了。</p><h4 id="3-2-FunctionalInterface-注解的使用"><a href="#3-2-FunctionalInterface-注解的使用" class="headerlink" title="3.2 @FunctionalInterface 注解的使用"></a>3.2 <code>@FunctionalInterface</code> 注解的使用</h4><p>这里以 java.util.Collection 接口中的 removeIf 方法为例。removeIf 方法源码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">removeIf</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> E&gt; filter)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(filter);</span><br><span class="line">    <span class="keyword">boolean</span> removed = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">final</span> Iterator&lt;E&gt; each = iterator();</span><br><span class="line">    <span class="keyword">while</span> (each.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (filter.test(each.next())) &#123;</span><br><span class="line">            each.remove();</span><br><span class="line">            removed = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> removed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中的 Predicate 对象就是用 <code>@FunctionalInterface</code> 注解修饰的接口，核心源码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在有一个需求：集合 c 中有一些字符串，给定一个字符串 a，如果 a 在集合 c 中存在，就将集合中的 a 删除，传统的实现如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    dataList.add(<span class="string">"a"</span>);</span><br><span class="line">    dataList.add(<span class="string">"b"</span>);</span><br><span class="line">    dataList.add(<span class="string">"c"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历集合，如果发现集合中存在就删除</span></span><br><span class="line">    String str = <span class="string">"a"</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dataList.size(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dataList.get(i).equals(str)) &#123;</span><br><span class="line">            dataList.remove(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dataList.size(); i++) &#123;</span><br><span class="line">        System.out.println(dataList.get(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果在 Java 8 中，通过 removeIf 方法实现如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历集合，如果发现集合中存在就删除</span></span><br><span class="line">    String str = <span class="string">"a"</span>;</span><br><span class="line">    dataList.removeIf(data -&gt; data.equals(str));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印</span></span><br><span class="line">    dataList.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面对比可以发现，代码大大简化。</p><h4 id="3-3-FunctionalInterface-函数式编程的好处"><a href="#3-3-FunctionalInterface-函数式编程的好处" class="headerlink" title="3.3 @FunctionalInterface 函数式编程的好处"></a>3.3 <code>@FunctionalInterface</code> 函数式编程的好处</h4><p>函数式编程的好处个人感觉在于将 业务部分 和 固定的编程套路隔离。</p><p>业务部分通常的情况如下：</p><ol><li>传入 n 个参数返回个结果</li><li>接收 n 个参数，没有返回</li><li>接收 n 个参数，返回 boolean 类型</li><li>没有参数，返回结果</li></ol><p>固定的编程套路如下</p><ol><li>在遍历集合中进行数据处理，打印，删除，判断，具体的处理可以改成 <code>@FunctionalInterface</code> 接口的</li><li>if while 中判断，条件可以改成 <code>@FunctionalInterface</code> 接口</li></ol><p>这里通过一个场景来实验函数式编程的好处以及带来的编程风格转变。</p><p>场景：从文件中读取 json 字符串，然后打印出来</p><p>传统的方式如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_read_file</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"D:\\git-workspace\\play\\test-java8-stream\\src\\test\\resources\\test.text"</span>));</span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String temp = <span class="keyword">null</span>;</span><br><span class="line">        StringBuilder data = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">while</span> ((temp = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            data.append(temp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        JSONObject jsonObject = JSONObject.parseObject(data.toString());</span><br><span class="line">        System.out.println(JSONObject.toJSONString(jsonObject, <span class="keyword">true</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>上面这个场景中业务部分是：将文件中的内容存到 StringBuilder 对象中，然后转成 JSONObject 对象，最后打印出来</li><li>固定的编程套路就是在 while 中通过 bufferedReader 读取文件中的内容</li></ul><p>如果使用函数式编程思想，那么应该将 固定的编程套路 封装成一个方法，这里定义成如下的方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadFile</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">processFile</span><span class="params">(File file, Consumer&lt;String&gt; consumer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">            String temp;</span><br><span class="line">            <span class="keyword">while</span> ((temp = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                consumer.accept(temp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>其中第二个参数是 Consumer 接口对象，通过其中的 accept 方法将 固定的编程套路 和 业务逻辑分离。</li></ul><p>其中业务逻辑部分如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_functional</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">"D:\\git-workspace\\play\\test-java8-stream\\src\\test\\resources\\test.text"</span>);</span><br><span class="line">    StringBuilder fileData = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    ReadFile.processFile(file, data -&gt; fileData.append(data));</span><br><span class="line">    JSONObject jsonObject = JSONObject.parseObject(fileData.toString());</span><br><span class="line">    System.out.println(JSONObject.toJSONString(jsonObject, <span class="keyword">true</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>未来如果想在读取文件的同时进行数据匹配或者筛选就不需要修改 processFile 方法，只需要在 Consumer 接口的实现中增加功能。</p>]]></content>
    
    <summary type="html">
    
      本文介绍如下内容：Java 8 default 关键字介绍以及使用；对 `@FunctionalInterface` 注解的理解以及使用
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
  </entry>
  
  <entry>
    <title>深入理解 Spring 中的 ThreadPoolTaskExecutor 与 ListenableFuture 对象</title>
    <link href="http://ckjava.com/2019/08/22/understand-Spring-ThreadPoolTaskExecutor-ListenableFuture/"/>
    <id>http://ckjava.com/2019/08/22/understand-Spring-ThreadPoolTaskExecutor-ListenableFuture/</id>
    <published>2019-08-21T16:00:00.000Z</published>
    <updated>2019-08-22T13:27:39.014Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ol><li>本文详细分析 Spring 中的 ThreadPoolTaskExecutor 与 ListenableFutureTask 对象；并且比较 ThreadPoolTaskExecutor 和 ThreadPoolExecutor 之间的区别。</li><li>介绍 ThreadPoolTaskExecutor 的基本使用</li><li>比较 ListenableFuture 与 Future</li><li>深入解析 ListenableFuture 对象</li></ol><h2 id="2-ThreadPoolTaskExecutor-对比-ThreadPoolExecutor"><a href="#2-ThreadPoolTaskExecutor-对比-ThreadPoolExecutor" class="headerlink" title="2 ThreadPoolTaskExecutor 对比 ThreadPoolExecutor"></a>2 ThreadPoolTaskExecutor 对比 ThreadPoolExecutor</h2><ol><li>ThreadPoolExecutor 是 JDK 自带，ThreadPoolTaskExecutor 是 Spring 在 ThreadPoolExecutor 的基础上进行了一层封装。</li></ol><ul><li>java.util.concurrent.ThreadPoolExecutor</li><li>org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor</li></ul><ol start="2"><li>相比 ThreadPoolExecutor，ThreadPoolTaskExecutor 增加了 submitListenable 方法，该方法返回 ListenableFuture 接口对象，该接口完全抄袭了 google 的 guava。</li><li>ListenableFuture 接口对象，增加了线程执行完毕后成功和失败的回调方法。从而避免了 Future 需要以阻塞的方式调用 get，然后再执行成功和失败的方法。</li></ol><ul><li>ThreadPoolTaskExecutor 中具体的初始化线程池方法如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> ExecutorService <span class="title">initializeExecutor</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">ThreadFactory threadFactory, RejectedExecutionHandler rejectedExecutionHandler)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">BlockingQueue&lt;Runnable&gt; queue = createQueue(<span class="keyword">this</span>.queueCapacity);</span><br><span class="line"></span><br><span class="line">ThreadPoolExecutor executor;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.taskDecorator != <span class="keyword">null</span>) &#123;</span><br><span class="line">executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line"><span class="keyword">this</span>.corePoolSize, <span class="keyword">this</span>.maxPoolSize, <span class="keyword">this</span>.keepAliveSeconds, TimeUnit.SECONDS,</span><br><span class="line">queue, threadFactory, rejectedExecutionHandler) &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.execute(taskDecorator.decorate(command));</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line"><span class="keyword">this</span>.corePoolSize, <span class="keyword">this</span>.maxPoolSize, <span class="keyword">this</span>.keepAliveSeconds, TimeUnit.SECONDS,</span><br><span class="line">queue, threadFactory, rejectedExecutionHandler);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.allowCoreThreadTimeOut) &#123;</span><br><span class="line">executor.allowCoreThreadTimeOut(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.threadPoolExecutor = executor;</span><br><span class="line"><span class="keyword">return</span> executor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-如何使用-ThreadPoolTaskExecutor"><a href="#3-如何使用-ThreadPoolTaskExecutor" class="headerlink" title="3 如何使用 ThreadPoolTaskExecutor"></a>3 如何使用 ThreadPoolTaskExecutor</h2><p>具体使用如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ThreadPoolTaskExecutor executorService = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">    executorService.setCorePoolSize(<span class="number">2</span>);</span><br><span class="line">    executorService.setMaxPoolSize(<span class="number">2</span>);</span><br><span class="line">    executorService.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">    executorService.setQueueCapacity(Integer.MAX_VALUE);</span><br><span class="line">    executorService.initialize();</span><br><span class="line"></span><br><span class="line">    executorService.submitListenable(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 休息 5 秒，模拟工作的情况</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 通过抛出 RuntimeException 异常来模拟异常</span></span><br><span class="line">        <span class="comment">//throw new RuntimeException("出现异常");</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;).addCallback(data -&gt; logger.info(<span class="string">"success,result = &#123;&#125;"</span>, data), ex -&gt; logger.info(<span class="string">"**异常信息**：&#123;&#125;"</span>, ExceptionUtils.getExceptionMsg(ex)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>通过 new 获取 ThreadPoolTaskExecutor 对象</li><li>通过 setCorePoolSize 等方法可以配置线程池相关参数</li><li>最重要的是通过 <strong>initialize</strong> 方法完成线程池初始化，否则抛出：<code>java.lang.IllegalStateException: ThreadPoolTaskExecutor not initialized</code> 异常</li><li>调用 submitListenable 方法返回 ListenableFuture 对象</li><li>调用 ListenableFuture 对象的 addCallback 方法增加 成功和失败的回调处理</li><li>其中成功的回调对象实现了 SuccessCallback 接口，其中的方法为：<code>void onSuccess(T result)</code></li><li>其中失败的回调对象实现了 FailureCallback 接口，其中的方法为：<code>void onFailure(Throwable ex)</code></li></ol><h2 id="4-比较-ListenableFuture-与-Future"><a href="#4-比较-ListenableFuture-与-Future" class="headerlink" title="4 比较 ListenableFuture 与 Future"></a>4 比较 ListenableFuture 与 Future</h2><ul><li>org.springframework.util.concurrent.ListenableFuture</li><li>java.util.concurrent.Future</li></ul><p>ListenableFuture 接口继承 Future 接口，并增加了如下两个方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addCallback</span><span class="params">(ListenableFutureCallback&lt;? <span class="keyword">super</span> T&gt; callback)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addCallback</span><span class="params">(SuccessCallback&lt;? <span class="keyword">super</span> T&gt; successCallback, FailureCallback failureCallback)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="5-深入解析-ListenableFuture-对象"><a href="#5-深入解析-ListenableFuture-对象" class="headerlink" title="5 深入解析 ListenableFuture 对象"></a>5 深入解析 ListenableFuture 对象</h2><p>首先看看下面这张图</p><p><img src="data:image/png;base64,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" alt="ListenableFutureTask 类图"></p><ol><li>ThreadPoolTaskExecutor 的 submitListenable 方法，传入一个 Runnable 或者 Callable 对象，实际上 Runnable 或者 Callable 对象被包装到 ListenableFutureTask 对象中，然后提交到 ExecutorService 对象，最后返回的是 ListenableFutureTask 对象，具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">ListenableFuture&lt;T&gt; <span class="title">submitListenable</span><span class="params">(Callable&lt;T&gt; task)</span> </span>&#123;</span><br><span class="line">ExecutorService executor = getThreadPoolExecutor();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ListenableFutureTask&lt;T&gt; future = <span class="keyword">new</span> ListenableFutureTask&lt;T&gt;(task);</span><br><span class="line">executor.execute(future);</span><br><span class="line"><span class="keyword">return</span> future;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (RejectedExecutionException ex) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> TaskRejectedException(<span class="string">"Executor ["</span> + executor + <span class="string">"] did not accept task: "</span> + task, ex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 ListenableFutureTask 中可以发现其继承了 FutureTask 对象并实现了 ListenableFuture 对象， 其中 FutureTask 对象中的 run 是最终线程执行的方法，具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (state != NEW ||</span><br><span class="line">        !UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, runnerOffset,</span><br><span class="line">                                     <span class="keyword">null</span>, Thread.currentThread()))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Callable&lt;V&gt; c = callable;</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class="line">            V result;</span><br><span class="line">            <span class="keyword">boolean</span> ran;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                result = c.call();</span><br><span class="line">                ran = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                result = <span class="keyword">null</span>;</span><br><span class="line">                ran = <span class="keyword">false</span>;</span><br><span class="line">                setException(ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ran)</span><br><span class="line">                set(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// runner must be non-null until state is settled to</span></span><br><span class="line">        <span class="comment">// prevent concurrent calls to run()</span></span><br><span class="line">        runner = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// state must be re-read after nulling runner to prevent</span></span><br><span class="line">        <span class="comment">// leaked interrupts</span></span><br><span class="line">        <span class="keyword">int</span> s = state;</span><br><span class="line">        <span class="keyword">if</span> (s &gt;= INTERRUPTING)</span><br><span class="line">            handlePossibleCancellationInterrupt(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>上面 run 方法中的 set 方法将线程的执行结果通知出去，在 set 方法中可以发现其调用了 finishCompletion 方法，finishCompletion 方法会一直循环判断线程池中的队列的任务是否执行完毕，一旦执行完毕就会调用 done 方法</li><li>ListenableFutureTask 重写了 done 方法, 在正常执行完毕的情况下通过 <code>this.callbacks.success(result)</code> 调用成功回调函数，在出现 InterruptedException 异常的情况下既不会调用 成功的回调，也不会调用失败的回调，其他类型的异常出现的时候才会通过 <code>this.callbacks.failure(cause)</code> 调用失败回调函数，ListenableFutureTask 中的 done 方法具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Throwable cause;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">T result = get();</span><br><span class="line"><span class="keyword">this</span>.callbacks.success(result);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">Thread.currentThread().interrupt();</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ExecutionException ex) &#123;</span><br><span class="line">cause = ex.getCause();</span><br><span class="line"><span class="keyword">if</span> (cause == <span class="keyword">null</span>) &#123;</span><br><span class="line">cause = ex;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">cause = ex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>.callbacks.failure(cause);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>从上面的流程分析中，可以发现：因为 FutureTask 中重写了 run 方法，所以才实现了线程执行完毕后可以执行回调方法，其中使用了模板方法设计模式。</li><li>模板方法设计模式的主要特点在于：在接口中定义方法，在抽象类中实现方法，并定义抽象方法，实现的方法中又调用抽象方法，最终的子类中重写抽象方法。</li><li>Runnable 和 ListenableFuture 是接口， FutureTask 是抽象类，ListenableFutureTask 是最终的子类</li></ul><h2 id="6-ListenableFuture-的好处以及-Future-带来的阻塞问题"><a href="#6-ListenableFuture-的好处以及-Future-带来的阻塞问题" class="headerlink" title="6 ListenableFuture 的好处以及 Future 带来的阻塞问题"></a>6 ListenableFuture 的好处以及 Future 带来的阻塞问题</h2><ol><li>ListenableFuture 相比 Future 是不需要知道 执行结果的情况下就可以将 成功或者失败的业务代码 通过回调的方式 预埋，带来的好处就是异步，不需要阻塞当前线程，从而可以提高系统的吞吐量</li><li>Future 需要通过 get() 方法阻塞当前线程，在获取线程的执行结果后再根据执行结果编写相关的业务代码</li></ol>]]></content>
    
    <summary type="html">
    
      本文详细分析 Spring 中的 ThreadPoolTaskExecutor 与 ListenableFutureTask 对象；并且比较 ThreadPoolTaskExecutor 和 ThreadPoolExecutor 之间的区别；介绍 ThreadPoolTaskExecutor 的基本使用；比较 ListenableFuture 与 Future；深入解析 ListenableFuture 对象
    
    </summary>
    
      <category term="Spring" scheme="http://ckjava.com/categories/Spring/"/>
    
    
      <category term="Spring" scheme="http://ckjava.com/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 属性配置类 @ConfigurationProperties 在单元测试中不生效的问题</title>
    <link href="http://ckjava.com/2019/08/07/SpringBoot-ConfigurationProperties-not-working/"/>
    <id>http://ckjava.com/2019/08/07/SpringBoot-ConfigurationProperties-not-working/</id>
    <published>2019-08-06T16:00:00.000Z</published>
    <updated>2019-08-22T13:30:12.477Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>在 SpringBoot 中通过 <code>@ConfigurationProperties</code> 注解将 application.properties 中的配置生成配置类，程序启动的时候可以读取到配置，但是在单元测试中无法读取配置。</p><ul><li>application.properties 配置如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/test?createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure><ul><li>DbProperties 配置类如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ToStringBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"jdbc"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略 get set</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ToStringBuilder(<span class="keyword">this</span>)</span><br><span class="line">                .append(<span class="string">"driverClassName"</span>, driverClassName)</span><br><span class="line">                .append(<span class="string">"url"</span>, url)</span><br><span class="line">                .append(<span class="string">"username"</span>, username)</span><br><span class="line">                .append(<span class="string">"password"</span>, password)</span><br><span class="line">                .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>单元测试配置如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.properties.DbProperties;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.TestPropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.AbstractJUnit4SpringContextTests;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@TestPropertySource</span>(value = &#123;<span class="string">"classpath:application.properties"</span>&#125;)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(value = &#123;DbProperties.class&#125;)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = &#123;</span><br><span class="line">        DataSourceConfig.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span> <span class="keyword">extends</span> <span class="title">AbstractJUnit4SpringContextTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.BaseTest;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.properties.DbProperties;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ContextConfiguration</span>(classes = &#123;</span><br><span class="line">        DbProperties.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDbProperties</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DbProperties dbProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_read_dbProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(dbProperties.toString());</span><br><span class="line">        Assert.assertTrue(StringUtils.isNotBlank(dbProperties.getDriverClassName()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2 原因"></a>2 原因</h2><p>当前的测试没有将整个 SpringBoot 应用启动起来，因此无法通过 <code>@ConfigurationProperties</code> 注解来加载配置。</p><h2 id="3-解决"><a href="#3-解决" class="headerlink" title="3 解决"></a>3 解决</h2><p>在 BaseTest 上增加 <code>@EnableConfigurationProperties(value = {DbProperties.class})</code> 即可解决这个问题，具体参考上面的代码。</p><h2 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h2><ul><li><a href="https://stackoverflow.com/questions/44933047/spring-boot-configuration-properties-not-working" target="_blank" rel="noopener">spring boot configuration properties not working</a></li></ul>]]></content>
    
    <summary type="html">
    
      在 SpringBoot 中通过 `@ConfigurationProperties` 注解将 application.properties 中的配置生成配置类，程序启动的时候可以读取到配置，但是在单元测试中无法读取配置。
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 中异步执行任务的 2 种方式</title>
    <link href="http://ckjava.com/2019/08/07/Spring-Boot-EnableAsync-Async-ExecutorService-usage-practice/"/>
    <id>http://ckjava.com/2019/08/07/Spring-Boot-EnableAsync-Async-ExecutorService-usage-practice/</id>
    <published>2019-08-06T16:00:00.000Z</published>
    <updated>2019-08-07T13:59:29.147Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文探讨在 SpringBoot 中通过线程池来异步执行任务的两种方法：</p><ol><li>通过 Spring 自带的 <code>@EnableAsync</code> 和 <code>@Async</code> 两个注解实现异步执行任务功能</li><li>通过自定义的方式</li></ol><p>在通过 <code>@EnableAsync</code> 和 <code>@Async</code> 两个注解实现异步执行任务中会进一步分析 <code>@Async</code> 的局限性，自定义 <code>@Async</code> 注解的线程池，以及异常的处理。</p><h2 id="2-使用-spring-boot-异步注解-EnableAsync-和-Async"><a href="#2-使用-spring-boot-异步注解-EnableAsync-和-Async" class="headerlink" title="2 使用 spring boot 异步注解 @EnableAsync 和 @Async"></a>2 使用 spring boot 异步注解 <code>@EnableAsync</code> 和 <code>@Async</code></h2><h4 id="2-1-Async-的局限性"><a href="#2-1-Async-的局限性" class="headerlink" title="2.1 @Async 的局限性"></a>2.1 <code>@Async</code> 的局限性</h4><ol><li>只能作用于 <em>public</em> 方法上</li><li>方法不能自己调自己，也就是说不能迭代调用</li></ol><h4 id="2-2-基本使用"><a href="#2-2-基本使用" class="headerlink" title="2.2 基本使用"></a>2.2 基本使用</h4><ol><li>增加如下的配置类 AsyncConfig</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在 AsyncService 中增加两个方法：一个有返回值，返回值为 <code>Future</code> 对象；一个没有，都通过 api 调用，具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.properties.DbProperties;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DbProperties dbProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDbProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dbProperties.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">"Execute method asynchronously, thread name = &#123;&#125;"</span>, Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">asyncGetData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"Execute method asynchronously, thread name = &#123;&#125;"</span>, Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult(<span class="string">"执行结果"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>其中 <code>org.springframework.scheduling.annotation.AsyncResult</code> 实现了 <code>java.util.concurrent.Future</code> 接口，并增加了一些额外有用的功能。</li></ul><ol start="3"><li>AsyncController 如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.service.AsyncService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/async"</span>, produces = <span class="string">"application/json;charset=utf-8"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncController</span> <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncService dbService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求，立即返回，但是不是具体的执行结果，具体的任务在线程池中慢慢的执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/asyncData"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;String&gt; <span class="title">asyncData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dbService.asyncData();</span><br><span class="line">    <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HTTPCODE.code_200, STATUS.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求，执行完毕后再返回具体的结果，具体的任务在线程池中执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/asyncGetData"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;String&gt; <span class="title">asyncGetData</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(dbService.asyncGetData().get(), HTTPCODE.code_200, STATUS.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>对于 <code>/api/async/asyncData</code> 请求，立即返回，但是不是具体的执行结果，具体的任务在线程池中慢慢的执行，具体如下</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-08-06 20:32:09.476  INFO 461964 --- [cTaskExecutor-3] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = SimpleAsyncTaskExecutor-3</span><br></pre></td></tr></table></figure><ol start="5"><li>对于 <code>/api/async/asyncGetData</code> 请求，执行完毕后再返回具体的结果，具体的任务在线程池中执行，具体如下</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-08-06 20:32:59.958  INFO 461964 --- [cTaskExecutor-5] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = SimpleAsyncTaskExecutor-5</span><br></pre></td></tr></table></figure><p>这两种情况可以根据业务情况来决定。</p><ol start="6"><li>从执行结果来看，AsyncService 中的 asyncData 方法和 asyncGetData 方法都执行在 SimpleAsyncTaskExecutor 线程池中</li></ol><h4 id="2-3-自定义-Async-注解的线程池"><a href="#2-3-自定义-Async-注解的线程池" class="headerlink" title="2.3 自定义 @Async 注解的线程池"></a>2.3 自定义 <code>@Async</code> 注解的线程池</h4><p>从上面的例子中可见默认的线程池为 SimpleAsyncTaskExecutor，如何自定义自己的线程池呢？</p><p>下面介绍两种自定义异步执行线程池的方法：</p><ol><li>在方法级别上自定义执行线程池</li><li>在应用级别上自定义执行线程池</li></ol><h4 id="2-4-在方法级别上自定义执行线程池"><a href="#2-4-在方法级别上自定义执行线程池" class="headerlink" title="2.4 在方法级别上自定义执行线程池"></a>2.4 在方法级别上自定义执行线程池</h4><p>自定义线程池如下</p><ul><li>SelfAsyncConfig</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfAsyncConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"selfConfigThreadPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorService <span class="title">threadPoolTaskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * corePoolSize: 线程池中至少有多少个线程，即使没有任何任务需要执行的情况下仍然需要保留</span></span><br><span class="line"><span class="comment">         * maximumPoolSize：线程池中最多有多少个线程</span></span><br><span class="line"><span class="comment">         * keepAliveTime：除了 corePoolSize 数量的线程，其他线程最大的空闲时间，超过空闲时间后会被回收</span></span><br><span class="line"><span class="comment">         * unit：keepAliveTime 的时间单位，毫秒，秒等</span></span><br><span class="line"><span class="comment">         * workQueue：等待执行任务的队列，里面的对象需要实现 Runnable 或者 Callable 接口</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">60L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>具体的使用，指定 bean name，具体如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Async(&quot;selfConfigThreadPool&quot;)</span><br><span class="line">public void asyncSelfData() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        Thread.sleep(5000);</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(&quot;Execute method asynchronously, thread name = &#123;&#125;&quot;, Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行的输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-08-07 10:25:59.113  INFO 648696 --- [pool-1-thread-1] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = pool-1-thread-1</span><br></pre></td></tr></table></figure><p>根据输出可见，线程名为：pool-1-thread-1，和默认的线程 SimpleAsyncTaskExecutor-5 不在同一个线程池中。</p><h4 id="2-5-在应用级别上自定义执行线程池"><a href="#2-5-在应用级别上自定义执行线程池" class="headerlink" title="2.5 在应用级别上自定义执行线程池"></a>2.5 在应用级别上自定义执行线程池</h4><p>通过在 <code>@EnableAsync</code> 配置类中实现 AsyncConfigurer 接口，并重写 getAsyncExecutor 方法。</p><ul><li>GlobalAsyncConfig</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalAsyncConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">5</span>,</span><br><span class="line">                <span class="number">60L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AsyncUncaughtExceptionHandler <span class="title">getAsyncUncaughtExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomAsyncExceptionHandler();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对于没有返回值的 带有 `<span class="doctag">@Async</span>` 注解的方法的异常处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAsyncExceptionHandler</span> <span class="keyword">implements</span> <span class="title">AsyncUncaughtExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUncaughtException</span> <span class="params">(Throwable throwable, Method method, Object... obj)</span> </span>&#123;</span><br><span class="line">            logger.info(<span class="string">"Exception message - &#123;&#125;"</span>, throwable.getMessage());</span><br><span class="line">            logger.info(<span class="string">"Method name - &#123;&#125;"</span>, method.getName());</span><br><span class="line">            <span class="keyword">for</span> (Object param : obj) &#123;</span><br><span class="line">                logger.info(<span class="string">"Parameter value - &#123;&#125;"</span>, param);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次请求上面的 <code>/api/async/asyncData</code> 和 <code>/api/async/asyncGetData</code> api，后台输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2019-08-07 14:36:23.992  INFO 13296 --- [pool-1-thread-1] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = pool-1-thread-1</span><br><span class="line">2019-08-07 14:36:28.524  INFO 13296 --- [pool-1-thread-2] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = pool-1-thread-2</span><br><span class="line">2019-08-07 14:36:29.346  INFO 13296 --- [pool-1-thread-5] com.ckjava.test.service.AsyncService     : Execute method asynchronously, thread name = pool-1-thread-5</span><br></pre></td></tr></table></figure><p>从输出可见，任务执行的线程都在同一个线程池中。</p><h4 id="2-6-异常处理"><a href="#2-6-异常处理" class="headerlink" title="2.6 异常处理"></a>2.6 异常处理</h4><ul><li>当带有 <code>@Async</code> 注解的方法返回类型是 <em>Future</em> 对象，异常的处理非常简单，调用 <em>Future.get()</em> 将会抛出异常，在外面进行 <code>try...catch</code> 即可。</li><li>如果带有 <code>@Async</code> 注解的方法返回类型是 <em>void</em>, 那么如何处理异常呢？</li><li>解决起来也很简单：在实现 AsyncConfigurer 接口时，同时重写 getAsyncExecutor 和 getAsyncUncaughtExceptionHandler 两个方法，比如上面的 CustomAsyncExceptionHandler 处理类</li></ul><p>出现异常如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"Execute method asynchronously, thread name = &#123;&#125;"</span>, Thread.currentThread().getName());</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"异常"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2019-08-07 15:50:51.326  INFO 13420 --- [pool-1-thread-1] lAsyncConfig$CustomAsyncExceptionHandler : Exception message - 异常</span><br><span class="line">2019-08-07 15:50:51.326  INFO 13420 --- [pool-1-thread-1] lAsyncConfig$CustomAsyncExceptionHandler : Method name - asyncData</span><br><span class="line">2019-08-07 15:50:51.326  INFO 13420 --- [pool-1-thread-1] lAsyncConfig$CustomAsyncExceptionHandler : Parameter value - test</span><br></pre></td></tr></table></figure><h2 id="3-自定义"><a href="#3-自定义" class="headerlink" title="3 自定义"></a>3 自定义</h2><ol><li>新增配置类 ThreadConfig，通过 <code>@Bean</code> 来配置单个或者多个线程池。</li></ol><ul><li>ThreadConfig 配置类，定义了两个线程池，一个用来发送邮件，一个用来处理心跳服务</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮件服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"sendMailExecutorService"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorService <span class="title">sendMailExecutorService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">2</span>,</span><br><span class="line">                <span class="number">60L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 心跳服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"heartbeatExecutorService"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorService <span class="title">heartbeatExecutorService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">60L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>通过 <code>@Qualifier(&quot;sendMailExecutorService&quot;)</code> 和 <code>@Autowired</code> 注入</li></ol><ul><li>ThreadService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"sendMailExecutorService"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExecutorService sendMailExecutorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"heartbeatExecutorService"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExecutorService heartbeatExecutorService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heartbeatService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        heartbeatExecutorService.submit(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// TODO 负责心跳有关的工作</span></span><br><span class="line">            logger.info(<span class="string">"Execute heartbeatService asynchronously, thread name = &#123;&#125;"</span>, Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;Boolean&gt; <span class="title">sendMailService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sendMailExecutorService.submit(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            logger.info(<span class="string">"Execute sendMailService asynchronously, thread name = &#123;&#125;"</span>, Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 休息1秒，模拟邮件发送过程</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>注意 ThreadConfig 中配置了多个线程池，由于 ExecutorService 类型相同，因此需要加上 Bean 的名称以及在注入的时候需要加上 <code>@Qualifier</code></li><li>通过 ThreadController 调用服务，具体如下</li></ol><ul><li>ThreadController 中 <code>/api/asyncThread/heartbeat</code> api 执行不需要返回，<code>/api/asyncThread/sendMail</code> api 需要返回结果</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.service.ThreadService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/asyncThread"</span>, produces = <span class="string">"application/json;charset=utf-8"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadController</span> <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadService threadService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求，立即返回，但是不是具体的执行结果，具体的任务在线程池中慢慢的执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/heartbeat"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;String&gt; <span class="title">asyncData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        threadService.heartbeatService();</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HTTPCODE.code_200, STATUS.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求，执行完毕后再返回具体的结果，具体的任务在线程池中执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/sendMail"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;Boolean&gt; <span class="title">asyncGetData</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(threadService.sendMailService().get(), HTTPCODE.code_200, STATUS.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>具体的输出输出如下</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2019-08-07 14:58:16.417  INFO 9500 --- [pool-3-thread-1] com.ckjava.test.service.ThreadService    : Execute heartbeatService asynchronously, thread name = pool-3-thread-1</span><br><span class="line">2019-08-07 14:58:16.599  INFO 9500 --- [pool-3-thread-1] com.ckjava.test.service.ThreadService    : Execute heartbeatService asynchronously, thread name = pool-3-thread-1</span><br><span class="line">2019-08-07 14:58:22.059  INFO 9500 --- [pool-2-thread-1] com.ckjava.test.service.ThreadService    : Execute sendMailService asynchronously, thread name = pool-2-thread-1</span><br></pre></td></tr></table></figure><p>从输出可以看出，heartbeatService 的线程执行在 <code>pool-3</code> 线程池中，sendMailService 的线程执行在 <code>pool-2</code> 线程池中</p><h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><ul><li>通过上面两种方式比较，可以发现 Spring 自带的 <code>@EnableAsync</code> 和 <code>@Async</code> 两个注解本质上也是基于 Java 自身的 Executor 线程池的，这种方式比较简单</li><li>自定义的方式可以带来更大的灵活性，以及可控性</li></ul><h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5 参考"></a>5 参考</h2><ul><li><a href="https://www.baeldung.com/spring-async" target="_blank" rel="noopener">How To Do @Async in Spring</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文探讨在 SpringBoot 中通过线程池来异步执行任务的两种方法：1. 通过 Spring 自带的 `@EnableAsync` 和 `@Async` 两个注解实现异步执行任务功能；2. 通过自定义的方式
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>在 SpringBoot 中获取配置参数的最佳姿势</title>
    <link href="http://ckjava.com/2019/07/25/SpringBoot-yml-properties-config-usage-practice/"/>
    <id>http://ckjava.com/2019/07/25/SpringBoot-yml-properties-config-usage-practice/</id>
    <published>2019-07-24T16:00:00.000Z</published>
    <updated>2019-07-25T01:05:25.473Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>在 SpringBoot 中的配置文件通常为 yml 或者 properties 文件，本文将介绍几种从这些文件中读取配置的方法，并推荐最佳的使用方案。</p><p>具体如下</p><ol><li>通过 <code>@PropertySource</code> 和 <code>@Value</code> 注解</li><li>通过 Environment 对象</li><li>通过 <code>@ConfigurationProperties</code> 注解</li></ol><h2 id="2-方法1：通过-PropertySource-和-Value-注解"><a href="#2-方法1：通过-PropertySource-和-Value-注解" class="headerlink" title="2 方法1：通过 @PropertySource 和 @Value 注解"></a>2 方法1：通过 <code>@PropertySource</code> 和 <code>@Value</code> 注解</h2><ol><li>在类上通过 <code>@PropertySource(value = { &quot;classpath:META-INF/application.properties&quot; })</code> 引入 properties 文件，同时要配置该类在包扫描范围内</li><li>application.properties 文件中如果有变量 <code>server.name=userApi</code></li><li>在类中使用如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource</span>(value = &#123; <span class="string">"classpath:META-INF/application.properties"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;server.name&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String serverName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-方法2：通过-Environment-对象"><a href="#3-方法2：通过-Environment-对象" class="headerlink" title="3 方法2：通过 Environment 对象"></a>3 方法2：通过 Environment 对象</h2><ul><li>org.springframework.core.env.Environment</li></ul><ol><li>通过 <code>@Autowired</code> 注入 Spring 的 Environment 对象</li><li>通过该对象的 <code>getRequiredProperty(&quot;key&quot;)</code> 方法可以获取到配置文件中对应 key 的 value</li><li>Environment 的使用具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 从 application.yml 中读取 hibernate 相关配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Properties <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(<span class="string">"hibernate.dialect"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.dialect"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.hbm2ddl.auto"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.hbm2ddl.auto"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.show_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.show_sql"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.format_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.format_sql"</span>));</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>))) &#123;</span><br><span class="line">            properties.put(<span class="string">"hibernate.default_schema"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><code>src\main\resources\application.yml</code> 内容如下</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">datasource:</span><br><span class="line">  sampleapp:</span><br><span class="line">    url: jdbc:mysql://localhost:3306/jpaTest</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    driverClassName: com.mysql.jdbc.Driver</span><br><span class="line">    defaultSchema:</span><br><span class="line">    maxPoolSize: 20</span><br><span class="line">    hibernate:</span><br><span class="line">      hbm2ddl.auto: update</span><br><span class="line">      show_sql: true</span><br><span class="line">      format_sql: true</span><br><span class="line">      dialect: org.hibernate.dialect.MySQLDialect</span><br></pre></td></tr></table></figure><h2 id="4-方法3：通过-ConfigurationProperties-注解"><a href="#4-方法3：通过-ConfigurationProperties-注解" class="headerlink" title="4 方法3：通过 @ConfigurationProperties 注解"></a>4 方法3：通过 <code>@ConfigurationProperties</code> 注解</h2><ul><li>org.springframework.boot.context.properties.ConfigurationProperties</li></ul><p>该注解可将配置转换成 Spring 的 Bean 对象，其他 Bean 中通过 <code>@Autowired</code> 注解注入。具体如下</p><ol><li>新建 com.ckjava.test.properties 包, 所有的 properties 配置类都放在该包下</li><li>application-dev.yml 文件内容如下</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">datasource:</span><br><span class="line">  url: jdbc:mysql://localhost:3306/jpatest?DB_CLOSE_ON_EXIT=FALSE&amp;createDatabaseIfNotExist=TRUE&amp;useUnicode=TRUE&amp;characterEncoding=utf8&amp;autoReconnect=TRUE</span><br><span class="line">  username: root</span><br><span class="line">  password: root</span><br><span class="line">  driverClassName: com.mysql.jdbc.Driver</span><br><span class="line">  defaultSchema:</span><br><span class="line">  maxPoolSize: 20</span><br><span class="line">  hibernate:</span><br><span class="line">    hbm2ddl_auto: update</span><br><span class="line">    show_sql: true</span><br><span class="line">    format_sql: true</span><br><span class="line">    dialect: org.hibernate.dialect.MySQLDialect</span><br></pre></td></tr></table></figure><ol start="3"><li>新建 com.ckjava.test.properties.DataSourceProperties 配置类，具体内容如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"datasource"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String defaultSchema;</span><br><span class="line">    <span class="keyword">private</span> Integer maxPoolSize;</span><br><span class="line">    <span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line">    <span class="comment">// 忽略 get set</span></span><br></pre></td></tr></table></figure><ul><li>其中 prefix 定义了 url, username, password 等属性的前缀</li></ul><ol start="4"><li>新建 com.ckjava.test.properties.HibernateProperties 配置类，具体内容如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"datasource.hibernate"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String hbm2ddl_auto;</span><br><span class="line">    <span class="keyword">private</span> String show_sql;</span><br><span class="line">    <span class="keyword">private</span> String format_sql;</span><br><span class="line">    <span class="keyword">private</span> String dialect;</span><br><span class="line">    <span class="comment">// 忽略 get set</span></span><br></pre></td></tr></table></figure><ol start="5"><li>系统启动的时候可以通过指定 VM options: <code>-Dspring.profiles.active=dev</code> 启用 application-dev.yml 配置文件</li><li>其他 Bean 中通过 @Autowired 注入配置类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSourceProperties dataSourceProperties;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HibernateProperties hibernateProperties;</span><br></pre></td></tr></table></figure><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><ol><li>对于简单的参数获取，<code>@Value</code> 注解还是不错的</li><li>如果是复杂类型的参数，比如数据库或者其他一些对象类型的参数配置，<code>@ConfigurationProperties</code> 注解无疑是最佳的选择</li></ol><h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6 参考"></a>6 参考</h2><ul><li><a href="https://www.jianshu.com/p/df57fefe0ab7" target="_blank" rel="noopener">在Spring Boot中使用 @ConfigurationProperties 注解</a></li></ul>]]></content>
    
    <summary type="html">
    
      在 SpringBoot 中的配置文件通常为 yml 或者 properties 文件，本文将介绍几种从这些文件中读取配置的方法，并推荐最佳的使用方案。
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 中执行定时任务配置和使用的 2 种方式</title>
    <link href="http://ckjava.com/2019/07/25/SpringBoot-cron-usage-practice/"/>
    <id>http://ckjava.com/2019/07/25/SpringBoot-cron-usage-practice/</id>
    <published>2019-07-24T16:00:00.000Z</published>
    <updated>2019-07-25T01:03:02.626Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>如何在 Spring 中优雅的执行定时任务，这里将探讨两种方法，具体如下</p><ol><li>通过 <code>@EnableScheduling</code> 和 <code>@Scheduled</code> 注解实现</li><li>通过 ScheduledExecutorService 对象</li></ol><h2 id="2-方法1：通过-EnableScheduling-和-Scheduled-注解实现"><a href="#2-方法1：通过-EnableScheduling-和-Scheduled-注解实现" class="headerlink" title="2 方法1：通过 @EnableScheduling 和 @Scheduled 注解实现"></a>2 方法1：通过 <code>@EnableScheduling</code> 和 <code>@Scheduled</code> 注解实现</h2><ul><li>org.springframework.scheduling.annotation.EnableScheduling</li><li>org.springframework.scheduling.annotation.Scheduled</li></ul><ol><li>在 <code>@Configuration</code> 配置类中再增加 <code>@EnableScheduling</code>，并实现 SchedulingConfigurer 接口，具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.toulezu.test.task.MyTask;</span><br><span class="line"><span class="keyword">import</span> com.toulezu.test.trigger.CustomTrigger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.SchedulingConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.config.ScheduledTaskRegistrar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">// 标注启动定时任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringScheduleWithSchedulingConfigurer</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String cron = <span class="string">"*/1 * * * * ?"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 自定义定时任务的执行线程池</span></span><br><span class="line">taskRegistrar.setScheduler(taskScheduler());</span><br><span class="line"><span class="comment">// 具体的任务</span></span><br><span class="line">taskRegistrar.addTriggerTask(() -&gt; myTask().work(), <span class="keyword">new</span> CustomTrigger(cron));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span>(destroyMethod = <span class="string">"shutdown"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Executor <span class="title">taskScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MyTask <span class="title">myTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> MyTask();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>MyTask</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.DateUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(String.format(<span class="string">"do work at:%s"</span>, DateUtils.formatTime(<span class="keyword">new</span> Date().getTime(), Constants.TIMEFORMAT.DATETIME)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>CustomTrigger</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.support.CronTrigger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 trigger</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTrigger</span> <span class="keyword">extends</span> <span class="title">CronTrigger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomTrigger</span><span class="params">(String expression)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(expression);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>也可以直接通过 <code>@EnableScheduling</code> 和 <code>@Scheduled</code> 注解，使用系统自带的线程池，这样就不用实现 SchedulingConfigurer 接口了</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">// 标注启动定时任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringSchedule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled</span>(fixedRate = <span class="number">1000</span> * <span class="number">30</span>) <span class="comment">// 30秒执行一次</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reportCurrentTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Scheduling Tasks Examples reportCurrentTime: The time is now "</span> + DateUtils.formatTime(<span class="keyword">new</span> Date().getTime(), Constants.TIMEFORMAT.DATETIME));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Scheduled</span>(cron=<span class="string">"*/10 * * * * ?"</span>) <span class="comment">// 每10秒执行一次</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reportCurrentTimeByCron</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Scheduling Tasks Examples reportCurrentTimeByCron: The time is now "</span> + DateUtils.formatTime(<span class="keyword">new</span> Date().getTime(), Constants.TIMEFORMAT.DATETIME));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果在 xml 中，可以通过下面的方式配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">scheduler</span>=<span class="string">"taskScheduler"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">"taskScheduler"</span> <span class="attr">pool-size</span>=<span class="string">"42"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">task:scheduled-tasks</span> <span class="attr">scheduler</span>=<span class="string">"taskScheduler"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">task:scheduled</span> <span class="attr">ref</span>=<span class="string">"myTask"</span> <span class="attr">method</span>=<span class="string">"work"</span> <span class="attr">fixed-rate</span>=<span class="string">"1000"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">task:scheduled-tasks</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myTask"</span> <span class="attr">class</span>=<span class="string">"com.foo.MyTask"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-方法2：通过-ScheduledExecutorService-对象"><a href="#3-方法2：通过-ScheduledExecutorService-对象" class="headerlink" title="3 方法2：通过 ScheduledExecutorService 对象"></a>3 方法2：通过 ScheduledExecutorService 对象</h2><ol><li>在某个 Bean 中增加下面 static 代码块</li><li>或者将 static 代码块中的代码放到含有 <code>@PostConstruct</code> 注解的方法中，具体如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.toulezu.test.properties.JdbcProperties;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSchedule</span> <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(CustomSchedule.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcProperties jdbcProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 系统启动的时候自动启动</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*static &#123;</span></span><br><span class="line"><span class="comment">        scheduledExecutorService.scheduleAtFixedRate(() -&gt; &#123;</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                // 业务逻辑</span></span><br><span class="line"><span class="comment">                System.out.println(String.format("CustomSchedule work at:%s", DateUtils.formatTime(new Date().getTime(), Constants.TIMEFORMAT.DATETIME)));</span></span><br><span class="line"><span class="comment">            &#125; catch (Throwable e) &#123;</span></span><br><span class="line"><span class="comment">                logger.error("scheduleAtFixedRate has error", e);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &#125;, 10, 10, TimeUnit.SECONDS);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="keyword">this</span>.getClass() + <span class="string">"begin init"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            scheduledExecutorService.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 业务逻辑</span></span><br><span class="line">                    System.out.println(jdbcProperties.toString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                    logger.error(<span class="string">"scheduleAtFixedRate has error"</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;, <span class="number">10</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="keyword">this</span>.getClass().getName().concat(<span class="string">".init has error"</span>), e);</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="keyword">this</span>.getClass() + <span class="string">"end init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-代码"><a href="#4-代码" class="headerlink" title="4 代码"></a>4 代码</h2><ul><li><a href="https://gitee.com/toulezucom/spring-boot-learning/tree/master/spring-boot-cron" target="_blank" rel="noopener">spring-boot-cron</a></li></ul>]]></content>
    
    <summary type="html">
    
      如何在 Spring 中优雅的执行定时任务，这里将探讨两种方法
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="cron" scheme="http://ckjava.com/tags/cron/"/>
    
  </entry>
  
  <entry>
    <title>Java 中 JVM 参数和系统属性的读取与设置</title>
    <link href="http://ckjava.com/2019/07/23/Java-jvm-system-properties-read-write-practice/"/>
    <id>http://ckjava.com/2019/07/23/Java-jvm-system-properties-read-write-practice/</id>
    <published>2019-07-22T16:00:00.000Z</published>
    <updated>2019-07-23T14:23:33.135Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>打开 Java VisualVM，在每个 JVM 中都可以发现 JVM 参数和系统属性两个 tab 视图，信息非常丰富，这里介绍一下如何在程序中获取这些内容，以及如何设置新的内容。</p><h2 id="2-JVM-参数"><a href="#2-JVM-参数" class="headerlink" title="2 JVM 参数"></a>2 JVM 参数</h2><h4 id="2-1-获取"><a href="#2-1-获取" class="headerlink" title="2.1 获取"></a>2.1 获取</h4><p>这里通过 <code>java.lang.management.ManagementFactory</code> 对象来获取，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; inputArguments = ManagementFactory.getRuntimeMXBean().getInputArguments();</span><br><span class="line">inputArguments.forEach(str -&gt; System.out.println(str));</span><br></pre></td></tr></table></figure><p>部分内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-agentlib:jdwp=transport=dt_socket,address=127.0.0.1:65016,suspend=y,server=n</span><br><span class="line">-Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure><h4 id="2-2-设置"><a href="#2-2-设置" class="headerlink" title="2.2 设置"></a>2.2 设置</h4><ol><li>在 IDE 的 VM options 中输入如下内容</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xmx1024m</span><br><span class="line">-Xms1024m</span><br><span class="line">-Dspring.profiles.active=dev</span><br></pre></td></tr></table></figure><ol start="2"><li>或者在用 java 命令启动可执行 jar 的时候指定</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx1024m -Xms1024m -Dspring.profiles.active=pro -jar userProject.jar</span><br></pre></td></tr></table></figure><p>都可以修改 JVM 参数。</p><h2 id="3-系统属性"><a href="#3-系统属性" class="headerlink" title="3 系统属性"></a>3 系统属性</h2><h4 id="3-1-获取"><a href="#3-1-获取" class="headerlink" title="3.1 获取"></a>3.1 获取</h4><p>通过 <code>java.lang.System</code> 对象来获取，具体如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.getProperties().forEach((key, value) -&gt; System.out.println(String.format(&quot;%s=%s&quot;, key, value)));</span><br></pre></td></tr></table></figure><p>部分内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">os.name=Windows 10</span><br><span class="line">user.variant=</span><br><span class="line">java.vm.specification.vendor=Oracle Corporation</span><br><span class="line">line.separator=</span><br><span class="line"></span><br><span class="line">java.endorsed.dirs=C:\Program Files\Java\jdk1.8.0_121\jre\lib\endorsed</span><br><span class="line">user.country=CN</span><br><span class="line">user.script=</span><br><span class="line">sun.java.launcher=SUN_STANDARD</span><br><span class="line">sun.os.patch.level=</span><br><span class="line">java.vm.name=Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">file.encoding.pkg=sun.io</span><br><span class="line">path.separator=;</span><br><span class="line">java.vm.vendor=Oracle Corporation</span><br><span class="line">java.vendor.url=http://java.oracle.com/</span><br><span class="line">sun.boot.library.path=C:\Program Files\Java\jdk1.8.0_121\jre\bin</span><br><span class="line">java.vm.version=25.121-b13</span><br><span class="line">java.runtime.name=Java(TM) SE Runtime Environment</span><br></pre></td></tr></table></figure><h4 id="3-2-设置"><a href="#3-2-设置" class="headerlink" title="3.2 设置"></a>3.2 设置</h4><p>设置系统属性如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Properties properties = System.getProperties();</span><br><span class="line">properties.put(<span class="string">"user.env"</span>, <span class="string">"FAT"</span>);</span><br><span class="line">properties.forEach((key, value) -&gt; System.out.println(String.format(<span class="string">"%s=%s"</span>, key, value)));</span><br></pre></td></tr></table></figure><p>打印后的内容中会多出 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.env=FAT</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Java 中 JVM 参数和系统属性的读取与设置
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>深入分析 AngularJS 中 href 属性值由 javascript_void(0) 自动转成 unsafe_javascript_void(0) 的问题</title>
    <link href="http://ckjava.com/2019/07/22/AngularJS-href-unsafe-javascript-void/"/>
    <id>http://ckjava.com/2019/07/22/AngularJS-href-unsafe-javascript-void/</id>
    <published>2019-07-21T16:00:00.000Z</published>
    <updated>2019-07-22T14:05:28.144Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>原始的 html 如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0)"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>AngularJS 编译后如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"unsafe:javascript:void(0)"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(p)"</span> <span class="attr">class</span>=<span class="string">"ng-binding"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在 Firefox Quantum 68.0.1 (64 位) 中提示 <code>unsafe:javascript:void(0)</code>，点击后浏览器地址栏为：<code>unsafe:javascript:void(0)</code>，页面内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">无法理解该网址</span><br><span class="line"></span><br><span class="line">Firefox 不知道如何打开这个地址，因为协议 (unsafe) 未与任何程序关联，或此环境下不可打开该协议的地址。</span><br><span class="line"></span><br><span class="line">    您可能需要安装其他软件才能打开此网址。</span><br></pre></td></tr></table></figure><h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2 原因"></a>2 原因</h2><p>这里先思考一个问题：为什么 href 和 ng-click 中的表达式都会执行，有先后顺序吗？</p><ul><li>a 链接元素点击后通过 href 和 target 属性可以跳转到指定的页面，如果不需要跳转通过设置: <code>href=&quot;javascript:void(0)&quot;</code> 即可</li><li><code>href=&quot;javascript:void(0)&quot;</code> 表示不进行页面跳转而是执行 <code>void(0)</code> 的 javascript 方法，该方法只是用来计算一个空值，事情都不做</li><li>ng-click 属性可以让点击 a 链接元素后触发一个点击事件，执行一个函数，其属性值为一个函数名称</li><li>a 链接元素中 onclick、href、target 在不同浏览器下的处理顺序如下：<ul><li>chrome 下是 onclick、href、target</li><li>ie和firefox 下是 onclick、target、href</li></ul></li></ul><p>再回到上面的问题，由于 AngularJS 编译后自动加上了 <code>unsafe:</code> 前缀，变成了 <code>unsafe:javascript:void(0)</code>，因此 Firefox 无法识别这个协议，所以无法执行 <code>void(0)</code> 这个函数，浏览器地址栏变成了：<code>unsafe:javascript:void(0)</code>，说明进行了跳转，这里可以通过加上 <code>target=&quot;_blank&quot;</code> 属性验证这一点。</p><p>在 Chrome 上没有这个问题，是因为 Chrome 能够识别这个 unsafe 协议。</p><p>由此可见，Firefox 和 Chrome 在一些标准上开始出现了不一致的情况，以后这种情况可能会越来越多。</p><h2 id="3-解决方法"><a href="#3-解决方法" class="headerlink" title="3 解决方法"></a>3 解决方法</h2><p>根据上面的原因分析，我们可以通过两种方法来解决这个问题：</p><ol><li>方法一：直接去掉 href 属性</li><li>方法二：让 AngularJS 不会修改 href 属性值</li></ol><p>具体如下</p><h4 id="3-1-方法一：直接去掉-href-属性"><a href="#3-1-方法一：直接去掉-href-属性" class="headerlink" title="3.1 方法一：直接去掉 href 属性"></a>3.1 方法一：直接去掉 href 属性</h4><p>直接去掉 href 属性，修改成如下的方式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"cursor: pointer"</span> <span class="attr">ng-click</span>=<span class="string">"selectPage(1)"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中 <code>style=&quot;cursor: pointer&quot;</code> 可以让 a 链接元素拥有可点击样式，看起来的效果和 href 属性一样。</p><h4 id="3-2-让-AngularJS-不会修改-href-属性值"><a href="#3-2-让-AngularJS-不会修改-href-属性值" class="headerlink" title="3.2 让 AngularJS 不会修改 href 属性值"></a>3.2 让 AngularJS 不会修改 href 属性值</h4><p>配置编译白名单，让 AngularJS 不会编译 href 属性值中含有正则表达式：<code>/^\s*(https?|ftp|mailto|tel|file|sms|javascript):/</code> 指定的内容，具体如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstApp = angular.module(<span class="string">'firstApp'</span>, []);</span><br><span class="line">firstApp.config([<span class="string">'$compileProvider'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">$compileProvider</span>) </span>&#123;</span><br><span class="line">    $compileProvider.aHrefSanitizationWhitelist(<span class="regexp">/^\s*(https?|ftp|mailto|tel|file|sms|javascript):/</span>); <span class="comment">// 此处是正则表达式</span></span><br><span class="line">    <span class="comment">// Angular v1.2 之前使用 $compileProvider.urlSanitizationWhitelist(...)</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure><h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h2><ul><li>实际上这里使用 a 链接元素的目的在于：让待点击的元素拥有一个 a 链接元素的可点击样式，在 css2 中通过 <code>style=&quot;cursor: hand&quot;</code> 可以实现，在 css3 以上可以通过 <code>style=&quot;cursor: pointer&quot;</code> 实现，也就是上面的方法一</li><li>如果依赖的框架中有些 a 链接元素中既有 href 和 ng-click，那么只能通过方法二来解决</li></ul>]]></content>
    
    <summary type="html">
    
      深入分析 AngularJS 中 href 属性值由 javascript_void(0) 自动转成 unsafe_javascript_void(0) 的问题，最后提出两个解决方法。
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
  </entry>
  
  <entry>
    <title>关于 npm 的基本使用</title>
    <link href="http://ckjava.com/2019/07/22/npm-registry-proxy-install-usage/"/>
    <id>http://ckjava.com/2019/07/22/npm-registry-proxy-install-usage/</id>
    <published>2019-07-21T16:00:00.000Z</published>
    <updated>2019-07-22T14:15:14.256Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文介绍 npm 依赖的安装，卸载。以及通过设置镜像和代理来安装。</p><h2 id="2-镜像-registry"><a href="#2-镜像-registry" class="headerlink" title="2 镜像 registry"></a>2 镜像 registry</h2><h4 id="2-1-全局镜像维护"><a href="#2-1-全局镜像维护" class="headerlink" title="2.1 全局镜像维护"></a>2.1 全局镜像维护</h4><ol><li>获取当前镜像，默认是: <a href="https://registry.npmjs.org" target="_blank" rel="noopener">https://registry.npmjs.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure><ol start="2"><li>设置镜像为 <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><ol start="3"><li>删除镜像 <a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config delete registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h4 id="2-2-局部镜像"><a href="#2-2-局部镜像" class="headerlink" title="2.2 局部镜像"></a>2.2 局部镜像</h4><p>局部镜像是指在安装某个依赖的时候临时使用镜像</p><ol><li>下面通过淘宝的 NPM 镜像 <code>https://registry.npm.taobao.org</code> 来安装 <code>node-sass</code> 组件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install node-sass --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure><h4 id="2-3-镜像地址"><a href="#2-3-镜像地址" class="headerlink" title="2.3 镜像地址"></a>2.3 镜像地址</h4><ul><li>淘宝 npm 镜像</li></ul><ol><li>搜索地址：<a href="http://npm.taobao.org/" target="_blank" rel="noopener">http://npm.taobao.org/</a></li><li>registry 地址：<a href="http://registry.npm.taobao.org/" target="_blank" rel="noopener">http://registry.npm.taobao.org/</a></li></ol><ul><li>cnpmjs 镜像</li></ul><ol><li>搜索地址：<a href="http://cnpmjs.org/" target="_blank" rel="noopener">http://cnpmjs.org/</a></li><li>registry地址：<a href="http://r.cnpmjs.org/" target="_blank" rel="noopener">http://r.cnpmjs.org/</a></li></ol><h2 id="3-代理-proxy"><a href="#3-代理-proxy" class="headerlink" title="3 代理 proxy"></a>3 代理 proxy</h2><ol><li>设置代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy=http://127.0.0.1:8087</span><br><span class="line">npm config set https-proxy http://server:port</span><br></pre></td></tr></table></figure><ol start="2"><li>使用用户名和密码设置代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set proxy http://username:password@server:port</span><br><span class="line">npm confit set https-proxy http://username:password@server:port</span><br></pre></td></tr></table></figure><ol start="3"><li>删除代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config delete proxy</span><br><span class="line">npm config delete https-proxy</span><br></pre></td></tr></table></figure><ol start="4"><li>获取当前代理</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config get proxy</span><br><span class="line">npm config get https-proxy</span><br></pre></td></tr></table></figure><h2 id="4-依赖的安装和卸载"><a href="#4-依赖的安装和卸载" class="headerlink" title="4 依赖的安装和卸载"></a>4 依赖的安装和卸载</h2><h4 id="4-1-安装依赖"><a href="#4-1-安装依赖" class="headerlink" title="4.1 安装依赖"></a>4.1 安装依赖</h4><p>基本安装命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i angular-ui-select</span><br></pre></td></tr></table></figure><ol><li><code>i</code> 或者 <code>install</code> 表示安装</li><li><code>-g</code> 或者 <code>--global</code> 选项表示全局安装： <code>npm i -g angular-ui-select</code> <ul><li>带上表示会安装到 npm 组件所在的目录下的 node_modules 文件夹下</li><li>不带表示仅安装到当前目录的 node_modules 文件夹下</li></ul></li><li>带上 <a href="mailto:angular-ui-select@0.19.8" target="_blank" rel="noopener">angular-ui-select@0.19.8</a> 表示安装指定版本的包</li><li><code>-S</code> 或者 <code>--save</code> 选项表示增加在 package.json 中 dependencies 下的对应信息</li><li><code>-D</code> 或者 <code>--save-dev</code> 选项表示增加在 package.json 中 devDependencies 下的对应信息</li><li><code>-O</code> 或者 <code>--save-optional</code> 选项表示增加在 package.json 中 optionalDependencies 下的对应信息</li><li><code>-B</code> 或者 <code>--save-bundle</code> 选项表示增加在 package.json 中 bundleDependencies 下的对应信息</li></ol><h4 id="4-2-卸载依赖"><a href="#4-2-卸载依赖" class="headerlink" title="4.2 卸载依赖"></a>4.2 卸载依赖</h4><p>基本删除命令如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uni angular-ui-select</span><br></pre></td></tr></table></figure><p>删除本地模块时你应该思考的问题：是否将在 package.json 上的相应依赖信息也消除？</p><ol><li><code>uni</code> 或者 <code>uninstall</code> 选项表示默认删除模块，但不删除留在 package.json 中的对应信息</li><li><code>-g</code> 或者 <code>--global</code> 选项表示全局删除</li><li><code>-S</code> 或者 <code>--save</code> 选项表示删除在 package.json 中 dependencies 下的对应信息</li><li><code>-D</code> 或者 <code>--save-dev</code> 选项表示删除在 package.json 中 devDependencies 下的对应信息</li><li><code>-O</code> 或者 <code>--save-optional</code> 选项表示删除在 package.json 中 optionalDependencies 下的对应信息</li><li><code>-B</code> 或者 <code>--save-bundle</code> 选项表示删除在 package.json 中 bundleDependencies 下的对应信息</li></ol><h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5 参考"></a>5 参考</h2><ul><li><a href="https://www.npmjs.com/" target="_blank" rel="noopener">npmjs 官网</a></li><li><a href="http://www.cnblogs.com/penghuwan/p/6973702.html" target="_blank" rel="noopener">【npm】利用npm安装/删除/发布/更新/撤销发布包</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文介绍 npm 依赖的安装，卸载。以及通过设置镜像和代理来安装。
    
    </summary>
    
      <category term="npm" scheme="http://ckjava.com/categories/npm/"/>
    
    
      <category term="npm" scheme="http://ckjava.com/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS 下拉框组件 ui-select 使用介绍</title>
    <link href="http://ckjava.com/2019/06/27/AngularJS-ui-select-practice/"/>
    <id>http://ckjava.com/2019/06/27/AngularJS-ui-select-practice/</id>
    <published>2019-06-26T16:00:00.000Z</published>
    <updated>2019-06-27T13:25:09.270Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>一般情况下在 AngularJS 中使用 select 的方式如下</p><ol><li>在 Controller 中定义下拉框选项值</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$scope.envOptions = [</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'fat'</span>, <span class="attr">value</span>: <span class="string">'FAT'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'fws'</span>, <span class="attr">value</span>: <span class="string">'FWS'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'uat'</span>, <span class="attr">value</span>: <span class="string">'UAT'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">'prd'</span>, <span class="attr">value</span>: <span class="string">'PRD'</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">$scope.onEnvChange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>在页面上使用如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>环境<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"increment.env"</span> <span class="attr">ng-change</span>=<span class="string">"onEnvChange()"</span> <span class="attr">class</span>=<span class="string">"form-control input-group-sm"</span> <span class="attr">ng-init</span>=<span class="string">"increment.env = 'fat'"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">ng-repeat</span>=<span class="string">"item in envOptions"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;item.key&#125;&#125;"</span>&gt;</span>&#123;&#123;item.value&#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果要更加复杂的效果怎么办，比如输入一个字符自动加载相关的选项？下面来一一介绍 ui-select 的安装与具体的使用。</p><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2 安装"></a>2 安装</h2><ul><li>npm 依赖 <a href="https://www.npmjs.com/package/ui-select" target="_blank" rel="noopener">AngularJS ui-select</a></li><li>npm 安装： <code>npm i ui-select -S</code></li><li>复制到 <code>app\lib</code> 目录下</li><li>index.html 引入: <ul><li><code>&lt;script src=&quot;lib/ui-select/dist/select.js&quot;&gt;&lt;/script&gt;</code></li><li><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;lib/ui-select/dist/select.css&quot;&gt;</code></li></ul></li><li>js 的 module 中引入</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'myApp'</span>, [</span><br><span class="line">    <span class="string">'ui.select'</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure><h2 id="3-基本使用"><a href="#3-基本使用" class="headerlink" title="3 基本使用"></a>3 基本使用</h2><p>ui-select 指令包含了如下几个指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ui-select</span><br><span class="line">ui-select-match</span><br><span class="line">ui-select-header</span><br><span class="line">ui-select-choices</span><br><span class="line">ui-select-no-choice</span><br><span class="line">ui-select-footer</span><br><span class="line">uis-open-close</span><br></pre></td></tr></table></figure><p>基本的使用格式如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ui-select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-match</span>&gt;</span><span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-header</span>&gt;</span>Top of the list!<span class="tag">&lt;/<span class="name">ui-select-header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-choices</span>&gt;</span><span class="tag">&lt;<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ui-select-footer</span>&gt;</span>Bottom of the list.<span class="tag">&lt;/<span class="name">ui-select-footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-1-ui-select"><a href="#3-1-ui-select" class="headerlink" title="3.1 ui-select"></a>3.1 ui-select</h4><ul><li>使用 <code>theme=&quot;select2&quot;</code> 主题</li></ul><h4 id="3-2-ui-select-choices"><a href="#3-2-ui-select-choices" class="headerlink" title="3.2 ui-select-choices"></a>3.2 ui-select-choices</h4><ul><li>通过 <code>refresh=&quot;searchApp($select)&quot;</code> 和 <code>refresh-delay=&quot;300&quot;</code> 动态从后端 api 搜索下拉选项</li></ul><h4 id="3-3-设置通用属性"><a href="#3-3-设置通用属性" class="headerlink" title="3.3 设置通用属性"></a>3.3 设置通用属性</h4><ul><li>通过 uiSelectConfig 对象</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular.module(<span class="string">'myApp.pages.index'</span>, [<span class="string">'ui.router'</span>, <span class="string">'daterangepicker'</span>, <span class="string">'angular-uuid'</span>, <span class="string">'ui.select'</span>, <span class="string">'ngSanitize'</span>])</span><br><span class="line">        .config(pageConfig);</span><br><span class="line">    <span class="comment">/** @ngInject */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">pageConfig</span>(<span class="params">$stateProvider, uiSelectConfig</span>) </span>&#123;</span><br><span class="line">        $stateProvider.state(<span class="string">'index'</span>, &#123;</span><br><span class="line">            url: <span class="string">'/index'</span>,</span><br><span class="line">            templateUrl: <span class="string">'pages/index/manage/searchIndex.html'</span>,</span><br><span class="line">            controller: <span class="string">'MyAppCtrl'</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置 ui.select 的通用属性</span></span><br><span class="line">        uiSelectConfig.theme = <span class="string">'select2'</span>;</span><br><span class="line">        uiSelectConfig.resetSearchInput = <span class="literal">false</span>;</span><br><span class="line">        uiSelectConfig.appendToBody = <span class="literal">true</span>;</span><br><span class="line">        uiSelectConfig.searchEnabled = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h4 id="3-4-html-部分"><a href="#3-4-html-部分" class="headerlink" title="3.4 html 部分"></a>3.4 html 部分</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>appId<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ui-select</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ng-model</span>=<span class="string">"myApp.app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">"app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">theme</span>=<span class="string">"select2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">append-to-body</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">search-enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">reset-search-input</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ng-disabled</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">style</span>=<span class="string">"width: 300px;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">title</span>=<span class="string">"选择一个app"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ui-select-match</span> <span class="attr">placeholder</span>=<span class="string">"按照 app 的 id，名称，描述进行搜索"</span>&gt;</span></span><br><span class="line">                &#123;&#123;$select.selected.appId&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">refresh</span>=<span class="string">"searchApp($select)"</span> <span class="attr">refresh-delay</span>=<span class="string">"300"</span> <span class="attr">repeat</span>=<span class="string">"app in searchRes track by $index"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.appId | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h6</span>&gt;</span></span><br><span class="line">                    appName: &#123;&#123;app.appName&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    description: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.description | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>append-to-body=”true” 将下拉列表框追加到输入框下面</li><li>search-enabled=”true” 支持搜索下拉框中的内容</li><li>reset-search-input=”false” 选择一个选项后清除搜索输入框中的内容</li><li>其中 <code>ng-bind-html</code> 需要依赖 ngSanitize 模块</li></ul><h4 id="3-5-js-部分"><a href="#3-5-js-部分" class="headerlink" title="3.5 js 部分"></a>3.5 js 部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认选择</span></span><br><span class="line">$scope.searchRes = [&#123;<span class="string">"appId"</span>:<span class="string">"123456"</span>,<span class="string">"appName"</span>:<span class="string">"userService"</span>,<span class="string">"name"</span>:<span class="string">"用户信息服务"</span>,<span class="string">"description"</span>:<span class="string">"用户信息服务"</span>&#125;];</span><br><span class="line">$scope.myApp.app = $scope.searchRes[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">$scope.searchApp = <span class="function"><span class="keyword">function</span>(<span class="params">$select</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!$select.search) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    MyAppService.doSearchApp($select.search)</span><br><span class="line">        .then(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                $scope.searchRes = value.data;</span><br><span class="line">            &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">'searchApp has error, value:'</span> + <span class="built_in">JSON</span>.stringify(value));</span><br><span class="line">                toastr.error(<span class="string">'searchApp has error'</span>, <span class="string">'提示'</span>, $scope.notificationConfig);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        .catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.error(<span class="string">"searchApp has error"</span> + e.toString());</span><br><span class="line">        &#125;)</span><br><span class="line">        .finally(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'searchApp finally'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSearchApp</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deferred = $q.defer();</span><br><span class="line"></span><br><span class="line">    $http.get($localStorage.sysInfo[<span class="string">'api_base'</span>] + urls.SLASH + urls.APP_SEARCH, &#123; <span class="attr">params</span> : &#123;<span class="string">'keyword'</span>: keyword &#125; &#125;)</span><br><span class="line">        .then(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'doSearchApp successfully'</span>);</span><br><span class="line">                deferred.resolve(&#123;</span><br><span class="line">                    data: response.data.data</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">errResponse</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.error(<span class="string">'error doSearchApp, errResponse = '</span> + <span class="built_in">JSON</span>.stringify(errResponse));</span><br><span class="line">                deferred.reject(errResponse);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="4 使用场景"></a>4 使用场景</h2><h4 id="4-1-如何清空已经选择的选项"><a href="#4-1-如何清空已经选择的选项" class="headerlink" title="4.1 如何清空已经选择的选项"></a>4.1 如何清空已经选择的选项</h4><ol><li>如果使用的是 <code>select2</code> 主题，可以在 <code>ui-select-match</code> 元素中增加 <code>allow-clear=&quot;true&quot;</code> 属性，选择选项后右边会增加一个 <code>x</code> 图标，点击该图标就会清空已经选择的选项，具体如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ui-select-match allow-clear=<span class="string">"true"</span> placeholder=<span class="string">"Select or search a country in the list..."</span>&gt;</span><br><span class="line">&lt;span&gt;&#123;&#123;$select.selected.name&#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/ui</span>-select-match&gt;</span><br></pre></td></tr></table></figure><p>注意：<strong>点击 <code>x</code> 图标后会触发 ui-select 的 on-select 事件</strong></p><ol start="2"><li>手动在 <code>ui-select-match</code> 元素内增加一个 <code>x</code> 图标，并定义处理逻辑，具体如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ui-select-match placeholder=<span class="string">"Select or search a country in the list..."</span>&gt;</span><br><span class="line">&lt;span&gt;&#123;&#123;$select.selected.name&#125;&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;button class="clear" ng-click="clear($event)"&gt;&lt;span class="fa fa-remove"&gt;&lt;/</span>span&gt;<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/ui-select-match&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>clear 函数如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$scope.clear = <span class="function"><span class="keyword">function</span>(<span class="params">$event</span>) </span>&#123;</span><br><span class="line">   $event.stopPropagation(); </span><br><span class="line">   $scope.country.selected = <span class="literal">undefined</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>参考 <a href="https://stackoverflow.com/questions/26389542/clear-selected-option-in-ui-select-angular" target="_blank" rel="noopener">Clear selected option in ui-select angular</a>    </li></ul><h4 id="4-2-搜索选项的时候从-http-api-获取数据"><a href="#4-2-搜索选项的时候从-http-api-获取数据" class="headerlink" title="4.2 搜索选项的时候从 http api 获取数据"></a>4.2 搜索选项的时候从 http api 获取数据</h4><ol><li>在 <code>ui-select-choices</code> 元素中增加 <code>refresh=&quot;searchApp($select)&quot;</code> 和 <code>refresh-delay=&quot;300&quot;</code> 属性，具体如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">refresh</span>=<span class="string">"searchApp($select)"</span> <span class="attr">refresh-delay</span>=<span class="string">"300"</span> <span class="attr">repeat</span>=<span class="string">"app in searchRes track by $index"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.appId | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span></span><br><span class="line">appName: &#123;&#123;app.appName&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">description: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"app.description | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>searchApp 函数如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$scope.searchApp = <span class="function"><span class="keyword">function</span>(<span class="params">$select</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!$select.search) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">MyAppService.doSearchApp($select.search)</span><br><span class="line">.then(</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">$scope.searchAppRes = value.data;</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">'searchApp has error, value:'</span> + <span class="built_in">JSON</span>.stringify(value));</span><br><span class="line">toastr.error(<span class="string">'searchApp has error'</span>, <span class="string">'提示'</span>, $scope.notificationConfig);</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">.catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.error(<span class="string">"searchApp has error"</span> + e.toString());</span><br><span class="line">&#125;)</span><br><span class="line">.finally(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'searchApp finally'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="4-3-搜索选项的时候从数组中筛选数据"><a href="#4-3-搜索选项的时候从数组中筛选数据" class="headerlink" title="4.3 搜索选项的时候从数组中筛选数据"></a>4.3 搜索选项的时候从数组中筛选数据</h4><p>通过系统自带的 filter 函数：<code>mtd in searchAppRes | filter:$select.search track by $index</code>, 具体使用如下</p><ol><li>js 如下</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$scope.searchAppRes = [];</span><br></pre></td></tr></table></figure><ol start="2"><li>html如下</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>方法<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select</span></span></span><br><span class="line"><span class="tag"><span class="attr">ng-model</span>=<span class="string">"increment.method"</span></span></span><br><span class="line"><span class="tag"><span class="attr">name</span>=<span class="string">"method"</span></span></span><br><span class="line"><span class="tag"><span class="attr">ng-disabled</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag"><span class="attr">style</span>=<span class="string">"width: 400px;"</span></span></span><br><span class="line"><span class="tag"><span class="attr">title</span>=<span class="string">"选择一个App"</span></span></span><br><span class="line"><span class="tag"><span class="attr">on-select</span>=<span class="string">"submit()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-match</span> <span class="attr">allow-clear</span>=<span class="string">"true"</span> <span class="attr">placeholder</span>=<span class="string">"按照 app 名称进行搜索"</span>&gt;</span></span><br><span class="line">&#123;&#123;$select.selected&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-match</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-choices</span> <span class="attr">repeat</span>=<span class="string">"mtd in searchAppRes | filter:$select.search track by $index"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h6</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | highlight: $select.search"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span>&gt;</span></span><br><span class="line">Method: <span class="tag">&lt;<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:1 | highlight: $select.search"</span> /&gt;</span><span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">Service: <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind-html</span>=<span class="string">"mtd | serviceOrMethod:0 | highlight: $select.search"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-choices</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ui-select-no-choice</span>&gt;</span></span><br><span class="line">404: 搜索不到结果</span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select-no-choice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ui-select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-依赖"><a href="#5-依赖" class="headerlink" title="5 依赖"></a>5 依赖</h2><h4 id="5-1-npm-textAngular-或者-npm-angular-sanitize"><a href="#5-1-npm-textAngular-或者-npm-angular-sanitize" class="headerlink" title="5.1 npm textAngular 或者 npm angular-sanitize"></a>5.1 <a href="https://www.npmjs.com/package/textangular" target="_blank" rel="noopener">npm textAngular</a> 或者 <a href="https://www.npmjs.com/package/angular-sanitize" target="_blank" rel="noopener">npm angular-sanitize</a></h4><ul><li>引入 <code>&lt;script src=&quot;lib/angular-sanitize/angular-sanitize.js&quot;&gt;&lt;/script&gt;</code></li><li>引入 ngSanitize 模块</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angular.module(&apos;ngTest&apos;, [</span><br><span class="line">    &apos;ui.select&apos;, &apos;ngSanitize&apos;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h4 id="5-2-npm-select2"><a href="#5-2-npm-select2" class="headerlink" title="5.2 npm select2"></a>5.2 <a href="https://www.npmjs.com/package/select2" target="_blank" rel="noopener">npm select2</a></h4><ul><li>使用 <a href="mailto:`select2@3.4.5" target="_blank" rel="noopener">`select2@3.4.5</a>` 的版本</li><li>引入 <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;lib/select2/select2.css&quot;&gt;</code></li></ul><h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6 参考"></a>6 参考</h2><ul><li><a href="https://angular-ui.github.io/ui-select/" target="_blank" rel="noopener">UI Select 官网</a></li><li><a href="https://github.com/angular-ui/ui-select/wiki" target="_blank" rel="noopener">ui-select wiki</a></li></ul>]]></content>
    
    <summary type="html">
    
      AngularJS 下拉框组件 ui-select 使用介绍
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
      <category term="ui-select" scheme="http://ckjava.com/tags/ui-select/"/>
    
  </entry>
  
  <entry>
    <title>如何优雅的处理 Java 内部类（匿名方法）传值与返回的问题</title>
    <link href="http://ckjava.com/2019/06/24/Java-innerclass-value-propagation-practice/"/>
    <id>http://ckjava.com/2019/06/24/Java-innerclass-value-propagation-practice/</id>
    <published>2019-06-23T16:00:00.000Z</published>
    <updated>2019-06-24T13:22:56.895Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-问题"><a href="#1-问题" class="headerlink" title="1 问题"></a>1 问题</h2><p>传入 Java 内部类的对象必须是 final 的，如何将内部类中计算的结果返回呢？比如下面这个，如何将最终的 total 返回到外面？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numberList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    numberList.add(<span class="number">1</span>);</span><br><span class="line">    numberList.add(<span class="number">2</span>);</span><br><span class="line">    numberList.add(<span class="number">3</span>);</span><br><span class="line">    numberList.forEach(n -&gt; &#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">        total += n;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h2 id="2-解决方法"><a href="#2-解决方法" class="headerlink" title="2 解决方法"></a>2 解决方法</h2><h4 id="2-1-通过-AtomicReference-包裹最终返回的对象"><a href="#2-1-通过-AtomicReference-包裹最终返回的对象" class="headerlink" title="2.1 通过 AtomicReference 包裹最终返回的对象"></a>2.1 通过 AtomicReference 包裹最终返回的对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AtomicReference&lt;Integer&gt; atomicReference = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">numberList.forEach(n -&gt; atomicReference.set(n + atomicReference.get()));</span><br><span class="line"></span><br><span class="line">System.out.println(atomicReference.get());</span><br><span class="line">Assert.assertTrue(atomicReference.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure><h4 id="2-2-通过-ThreadLocal-包裹最终返回的对象"><a href="#2-2-通过-ThreadLocal-包裹最终返回的对象" class="headerlink" title="2.2 通过 ThreadLocal 包裹最终返回的对象"></a>2.2 通过 ThreadLocal 包裹最终返回的对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;Integer&gt; threadLocal = ThreadLocal.withInitial(() -&gt; <span class="number">0</span>);</span><br><span class="line">numberList.forEach(n -&gt; threadLocal.set(n + threadLocal.get()));</span><br><span class="line"></span><br><span class="line">System.out.println(threadLocal.get());</span><br><span class="line">Assert.assertTrue(threadLocal.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3 总结"></a>3 总结</h2><h4 id="3-1-共同点："><a href="#3-1-共同点：" class="headerlink" title="3.1 共同点："></a>3.1 共同点：</h4><ol><li>包裹最终返回的对象</li><li>通过 get 方法可以获取，通过 set 方法保存</li></ol><h4 id="3-2-不同点："><a href="#3-2-不同点：" class="headerlink" title="3.2 不同点："></a>3.2 不同点：</h4><ol><li>AtomicReference 有带参数的构造方法，ThreadLocal 没有</li></ol><h2 id="4-自定义一个包裹类"><a href="#4-自定义一个包裹类" class="headerlink" title="4 自定义一个包裹类"></a>4 自定义一个包裹类</h2><p>根据上面的总结，自定义的包裹类类有以下两个特征：</p><ol><li>通过 get 方法可以获取，通过 set 方法保存</li><li>通过构造函数设置初始值</li></ol><p>具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperUtils</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T t;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapperUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WrapperUtils <span class="title">init</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapperUtils</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.t = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WrapperUtils&lt;Integer&gt; wrapperUtils = <span class="keyword">new</span> WrapperUtils&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">numberList.forEach(t -&gt; wrapperUtils.set(wrapperUtils.get()+t));</span><br><span class="line">Assert.assertTrue(wrapperUtils.get() == <span class="number">6</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      传入 Java 内部类的对象必须是 final 的，如何将内部类中计算的结果返回呢？
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="innerclass" scheme="http://ckjava.com/tags/innerclass/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 中的 Optional 使用详解</title>
    <link href="http://ckjava.com/2019/06/22/understand-Java-8-Optional/"/>
    <id>http://ckjava.com/2019/06/22/understand-Java-8-Optional/</id>
    <published>2019-06-21T16:00:00.000Z</published>
    <updated>2019-06-22T10:48:26.307Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ul><li>Optional 的完整路径是 <code>java.util.Optional</code>，使用它是为了避免代码中的 <code>if (obj != null) { }</code> 这样范式的代码，可以采用链式编程的风格</li><li>而且通过 Optional 中提供的 filter 方法可以判断对象是否符合条件，在符合条件的情况下才会返回；map 方法可以在返回对象前修改对象中的属性</li><li>下面将一一分析这些方法的用法</li></ul><h2 id="2-方法列表"><a href="#2-方法列表" class="headerlink" title="2 方法列表"></a>2 方法列表</h2><ol><li><code>public&lt;U&gt; Optional&lt;U&gt; map(Function&lt;? super T, ? extends U&gt; mapper)</code>: 将 Optional 中的对象转成 其他对象，或者修改对象中的属性</li><li><code>public&lt;U&gt; Optional&lt;U&gt; flatMap(Function&lt;? super T, Optional&lt;U&gt;&gt; mapper)</code>：将 Optional 中的对象转成 Optional 对象，或者修改对象中的属性</li><li><code>public T orElse(T other)</code>: 在构造 Optional 的时候，如果其中的对象为 null, 通过 orElse 方法可以给定一个默认值</li><li><code>public T orElseGet(Supplier&lt;? extends T&gt; other)</code>：在构造 Optional 的时候，如果其中的对象为 null, 通过 orElseGet 方法可以动态构造一个对象;与 orElse 相比，orElseGet 的参数是 Supplier 接口对象</li><li><code>public void ifPresent(Consumer&lt;? super T&gt; consumer)</code>：ifPresent 表示 Optional 中的对象存在才会执行 Consumer 接口对象中的方法</li><li><code>public Optional&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code>：Optional 中的对象在不为空，并且满足某个条件的时候才会返回</li><li><code>public &lt;X extends Throwable&gt; T orElseThrow(Supplier&lt;? extends X&gt; exceptionSupplier) throws X</code>：在使用 Optional 包装的对象前，如果对象为 null 抛出自定义的异常</li></ol><h2 id="3-构造函数"><a href="#3-构造函数" class="headerlink" title="3 构造函数"></a>3 构造函数</h2><p>Optional 的三种构造方式: Optional.of(obj),  Optional.ofNullable(obj) 和明确的 Optional.empty()</p><ol><li><code>Optional.of(obj)</code>: 它要求传入的 obj 不能是 null 值的, 否则直接报 NullPointerException 异常。</li><li><code>Optional.ofNullable(obj)</code>: 它以一种智能的, 宽容的方式来构造一个 Optional 实例. 来者不拒, 传 null 进到就得到 Optional.empty(), 非 null 就调用 Optional.of(obj).</li><li><code>Optional.empty()</code>：返回一个空的 Optional 对象</li></ol><p>具体测试如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. empty() 返回一个空的 Optional 对象</span></span><br><span class="line"><span class="comment"> * 2. ofNullable 传入的对象可以是 null, 如果为 null 返回一个空的 Optional 对象</span></span><br><span class="line"><span class="comment"> * 3. of 传入的对象一定不能为 null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. empty() 返回一个空的 Optional 对象</span></span><br><span class="line">    Assert.assertTrue(Optional.empty().isPresent() == <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. of 里面如果为 null 直接抛出 NullPointerException 异常</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional.of(<span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> NullPointerException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ofNullable 如果参数为 null，返回空的集合</span></span><br><span class="line">    Assert.assertFalse(Optional.ofNullable(<span class="keyword">null</span>).isPresent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-使用场景"><a href="#4-使用场景" class="headerlink" title="4 使用场景"></a>4 使用场景</h2><p>这里结合具体的使用场景来使用 Optional 中的方法</p><h4 id="4-1-ifPresent：调用其他方法返回一个集合，在不通过-if-判断是否为-null-就可以放心的遍历"><a href="#4-1-ifPresent：调用其他方法返回一个集合，在不通过-if-判断是否为-null-就可以放心的遍历" class="headerlink" title="4.1 ifPresent：调用其他方法返回一个集合，在不通过 if 判断是否为 null 就可以放心的遍历"></a>4.1 ifPresent：调用其他方法返回一个集合，在不通过 if 判断是否为 null 就可以放心的遍历</h4><ul><li>通过 Optional 的 ofNullable 构造函数封装</li><li>然后通过其中的 ifPresent 方法：如果对象不为 null, 才会执行 Consumer 接口对象中的方法</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(userList)</span><br><span class="line">        .ifPresent()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIfPresent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ifPresent 表示 Optional 中的对象存在才会执行 Consumer 接口对象中的方法</span></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 不为空没有值的集合</span></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"1"</span>); <span class="comment">// 输出 1</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 为 null 的集合, 自动判断为 null, 没有执行 Consumer 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">null</span>;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"2"</span>); <span class="comment">// 没有执行</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 有值的集合</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"a"</span>);</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">"3"</span>); <span class="comment">// 输出 3</span></span><br><span class="line">                t.forEach(a -&gt; System.out.println(a));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 过去的方式, 多了 if 判断</span></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.getSize(dataList) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        dataList.forEach(a -&gt; System.out.println(a));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-filter：在判断是否为-null-后，仅遍历集合中符合条件的对象"><a href="#4-2-filter：在判断是否为-null-后，仅遍历集合中符合条件的对象" class="headerlink" title="4.2 filter：在判断是否为 null 后，仅遍历集合中符合条件的对象"></a>4.2 filter：在判断是否为 null 后，仅遍历集合中符合条件的对象</h4><ul><li>在通过 ifPresent 方法返回对象前通过 filter 方法设置过滤条件</li><li>filter 不会减少集合中对象的数量，只要集合中的任意一个对象满足条件就会返回整个集合，否则返回空集合</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(userList)</span><br><span class="line">        .filter()</span><br><span class="line">        .ifPresent()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化 user 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initEveryTestBefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">22</span>, <span class="string">"王旭"</span>, <span class="string">"wang.xu"</span>,<span class="string">"123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">21</span>, <span class="string">"孙萍"</span>, <span class="string">"sun.ping"</span>,<span class="string">"a123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">23</span>, <span class="string">"步传宇"</span>, <span class="string">"bu.zhuan.yu"</span>, <span class="string">"b123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">18</span>, <span class="string">"蔡明浩"</span>,  <span class="string">"cai.ming.hao"</span>,<span class="string">"c123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">17</span>, <span class="string">"郭林杰"</span>, <span class="string">"guo.lin.jie"</span>, <span class="string">"d123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">29</span>, <span class="string">"韩凯"</span>, <span class="string">"han.kai"</span>, <span class="string">"e123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">22</span>, <span class="string">"韩天琪"</span>,  <span class="string">"han.tian.qi"</span>,<span class="string">"f123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">21</span>, <span class="string">"郝玮"</span>,  <span class="string">"hao.wei"</span>,<span class="string">"g123456"</span>, <span class="string">'2'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">19</span>, <span class="string">"胡亚强"</span>,  <span class="string">"hu.ya.qing"</span>,<span class="string">"h123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">14</span>, <span class="string">"季恺"</span>,  <span class="string">"ji.kai"</span>,<span class="string">"i123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">17</span>, <span class="string">"荆帅"</span>,  <span class="string">"jing.shuai"</span>,<span class="string">"j123456"</span>, <span class="string">'1'</span>, <span class="keyword">true</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> User(<span class="number">16</span>, <span class="string">"姜有琪"</span>,  <span class="string">"jiang.you.qi"</span>,<span class="string">"k123456"</span>, <span class="string">'1'</span>, <span class="keyword">false</span>));</span><br><span class="line">    logger.info(<span class="string">"initEveryTestBefore, size &#123;&#125;"</span>, userList.size());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// filter: optional 中的对象在不为空，并且满足某个条件的时候才会返回</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 在集合中有年龄大于 18 岁的才会返回所有对象</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .filter(t -&gt; t.stream().anyMatch(u -&gt; u.getAge() &gt; <span class="number">18</span>))</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 因为集合中没有年龄大于 50 岁的，因此不会返回任何对象</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .filter(t -&gt; t.stream().anyMatch(u -&gt; u.getAge() &gt; <span class="number">50</span>))</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">22:24:31.666 [main] INFO  c.toulezu.test.optional.TestOptional - initEveryTestBefore, size 12</span><br><span class="line">1:User&#123;age=22, name=&apos;王旭&apos;, enName=&apos;wang.xu&apos;, password=&apos;123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=21, name=&apos;孙萍&apos;, enName=&apos;sun.ping&apos;, password=&apos;a123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=23, name=&apos;步传宇&apos;, enName=&apos;bu.zhuan.yu&apos;, password=&apos;b123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=18, name=&apos;蔡明浩&apos;, enName=&apos;cai.ming.hao&apos;, password=&apos;c123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=17, name=&apos;郭林杰&apos;, enName=&apos;guo.lin.jie&apos;, password=&apos;d123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=29, name=&apos;韩凯&apos;, enName=&apos;han.kai&apos;, password=&apos;e123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=22, name=&apos;韩天琪&apos;, enName=&apos;han.tian.qi&apos;, password=&apos;f123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=21, name=&apos;郝玮&apos;, enName=&apos;hao.wei&apos;, password=&apos;g123456&apos;, gender=2, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=19, name=&apos;胡亚强&apos;, enName=&apos;hu.ya.qing&apos;, password=&apos;h123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=14, name=&apos;季恺&apos;, enName=&apos;ji.kai&apos;, password=&apos;i123456&apos;, gender=1, hasMarried=false&#125;</span><br><span class="line">1:User&#123;age=17, name=&apos;荆帅&apos;, enName=&apos;jing.shuai&apos;, password=&apos;j123456&apos;, gender=1, hasMarried=true&#125;</span><br><span class="line">1:User&#123;age=16, name=&apos;姜有琪&apos;, enName=&apos;jiang.you.qi&apos;, password=&apos;k123456&apos;, gender=1, hasMarried=false&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3-orElse：在目标集合对象为-null-的时候可以设定默认值"><a href="#4-3-orElse：在目标集合对象为-null-的时候可以设定默认值" class="headerlink" title="4.3 orElse：在目标集合对象为 null 的时候可以设定默认值"></a>4.3 orElse：在目标集合对象为 null 的时候可以设定默认值</h4><ul><li>通过 orElse 函数设定默认值</li><li>ofNullable 函数为目标集合对象，如果为 null, 才会使用 orElse 函数设定的默认值</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElse()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在构造 Optional 的时候，如果其中的对象为 null, 通过 orElse 方法可以给定一个默认值</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会返回 orElse 方法提供的对象</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会返回 orElse 方法提供的对象</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"aa"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ab"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ac"</span>);</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 给定的对象不为 null 但是为 empty, 不会返回 orElse 方法提供的对象</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElse(tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"3:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1:a</span><br><span class="line">1:b</span><br><span class="line">1:c</span><br><span class="line">1:d</span><br><span class="line">2:aa</span><br><span class="line">2:ab</span><br><span class="line">2:ac</span><br></pre></td></tr></table></figure><h4 id="4-4-orElseGet：在目标集合对象为-null-的时候，可以动态从其他地方加载集合"><a href="#4-4-orElseGet：在目标集合对象为-null-的时候，可以动态从其他地方加载集合" class="headerlink" title="4.4 orElseGet：在目标集合对象为 null 的时候，可以动态从其他地方加载集合"></a>4.4 orElseGet：在目标集合对象为 null 的时候，可以动态从其他地方加载集合</h4><ul><li>在构造 Optional 的时候，如果其中的对象为 null, 通过 orElseGet 方法可以动态构造一个对象，比如可以再从数据库中加载</li><li>orElseGet 直接返回的是 Optional 中的对象</li><li>与 orElse 相比，orElseGet 的参数是 Supplier 接口对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElseGet()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElseGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    dataList.add(<span class="string">"aa"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ab"</span>);</span><br><span class="line">    dataList.add(<span class="string">"ac"</span>);</span><br><span class="line"></span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 给定的对象不为 null 但是 empty, 不会执行 orElseGet 方法提供的 Supplier 接口对象中的方法</span></span><br><span class="line">    dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseGet(() -&gt; tempList)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"3:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-5-orElseThrow：如果目标对象为-null，-抛出自定义的异常"><a href="#4-5-orElseThrow：如果目标对象为-null，-抛出自定义的异常" class="headerlink" title="4.5 orElseThrow：如果目标对象为 null， 抛出自定义的异常"></a>4.5 orElseThrow：如果目标对象为 null， 抛出自定义的异常</h4><ul><li>在使用 optional 包装的对象前，如果对象为 null 抛出自定义的异常</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .orElseThrow()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOrElseThrow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    tempList.add(<span class="string">"a"</span>);</span><br><span class="line">    tempList.add(<span class="string">"b"</span>);</span><br><span class="line">    tempList.add(<span class="string">"c"</span>);</span><br><span class="line">    tempList.add(<span class="string">"d"</span>);</span><br><span class="line"></span><br><span class="line">    RuntimeException runtimeException = <span class="keyword">new</span> RuntimeException(<span class="string">"dataList 对象为空"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 给定的对象为 null, 将会抛出异常</span></span><br><span class="line">    List&lt;String&gt; dataList = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Optional.ofNullable(dataList)</span><br><span class="line">                .orElseThrow(() -&gt; runtimeException)</span><br><span class="line">                .forEach(t -&gt; System.out.println(<span class="string">"1:"</span> + t));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> RuntimeException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 给定的对象不为 null, 不会抛出异常</span></span><br><span class="line">    dataList = tempList;</span><br><span class="line">    Optional.ofNullable(dataList)</span><br><span class="line">            .orElseThrow(() -&gt; runtimeException)</span><br><span class="line">            .forEach(t -&gt; System.out.println(<span class="string">"2:"</span> + t));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-6-map：将-optional-中的对象转成-其他对象，或者修改对象中的属性"><a href="#4-6-map：将-optional-中的对象转成-其他对象，或者修改对象中的属性" class="headerlink" title="4.6 map：将 optional 中的对象转成 其他对象，或者修改对象中的属性"></a>4.6 map：将 optional 中的对象转成 其他对象，或者修改对象中的属性</h4><ul><li>用于修改 Optional 中的对象，并返回对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .map()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 返回 optional 中的对象年龄在 18 岁以上的</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .map(t -&gt; &#123;</span><br><span class="line">                List&lt;User&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u.getAge() &gt; <span class="number">18</span>) &#123;</span><br><span class="line">                        tempList.add(u);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> tempList;</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将 optional 中的 User 对象的英文名改成大写</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .map(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    u.setEnName(u.getEnName().toUpperCase());</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-7-flatMap：将-optional-中的对象转成-optional-对象，或者修改对象中的属性"><a href="#4-7-flatMap：将-optional-中的对象转成-optional-对象，或者修改对象中的属性" class="headerlink" title="4.7 flatMap：将 optional 中的对象转成 optional 对象，或者修改对象中的属性"></a>4.7 flatMap：将 optional 中的对象转成 optional 对象，或者修改对象中的属性</h4><ul><li>用于修改 Optional 中的对象，并返回 Optional 对象</li><li>使用范式如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable()</span><br><span class="line">        .flatMap()</span><br></pre></td></tr></table></figure><ul><li>具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFlatMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 返回 Optional 中的对象年龄在 18 岁以上的</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .flatMap(t -&gt; &#123;</span><br><span class="line">                List&lt;User&gt; tempList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (u.getAge() &gt; <span class="number">18</span>) &#123;</span><br><span class="line">                        tempList.add(u);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> Optional.of(tempList);</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"1:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 将 optional 中的 User 对象的英文名改成大写</span></span><br><span class="line">    Optional.ofNullable(userList)</span><br><span class="line">            .flatMap(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    u.setEnName(u.getEnName().toUpperCase());</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> Optional.of(t);</span><br><span class="line">            &#125;)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                t.forEach(u -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">"2:"</span> + u.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-基于-Optional-设计一个-CRUD-的接口"><a href="#5-基于-Optional-设计一个-CRUD-的接口" class="headerlink" title="5 基于 Optional 设计一个 CRUD 的接口"></a>5 基于 Optional 设计一个 CRUD 的接口</h2><ul><li>在接口中定义返回 Optional 包裹的对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.toulezu.test.stream.api.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;User&gt; <span class="title">getUser</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;T&gt;&gt; findAll();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;T&gt;&gt; search(String keyword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在假设数据库中查询返回为 null 的情况</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.toulezu.test.stream.api.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">BaseService</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Optional&lt;User&gt; <span class="title">getUser</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;User&gt;&gt; findAll() &#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;List&lt;User&gt;&gt; search(String keyword) &#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过 ifPresent 方法可以避免 null 判断，具体测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">    userService.getUser(<span class="number">1l</span>)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(t != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    userService.findAll()</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(userList != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    userService.search(<span class="string">"a"</span>)</span><br><span class="line">            .ifPresent(t -&gt; &#123;</span><br><span class="line">                Assert.assertTrue(userList != <span class="keyword">null</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Optional 的完整路径是 java.util.Optional，使用它是为了避免代码中的 if (obj != null) { } 这样范式的代码，可以采用链式编程的风格。而且通过 Optional 中提供的 filter 方法可以判断对象是否符合条件，在符合条件的情况下才会返回；map 方法可以在返回对象前修改对象中的属性
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
      <category term="Optional" scheme="http://ckjava.com/tags/Optional/"/>
    
  </entry>
  
  <entry>
    <title>对 JavaScript function 对象中 this 的理解</title>
    <link href="http://ckjava.com/2019/05/31/understand-JavaScript-function-this/"/>
    <id>http://ckjava.com/2019/05/31/understand-JavaScript-function-this/</id>
    <published>2019-05-30T16:00:00.000Z</published>
    <updated>2019-05-31T00:36:31.894Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>最近看到了 <a href="https://docs.angularjs.org/api/ng/function/angular.bind" target="_blank" rel="noopener">angular.bind</a> 函数，其中有个地方吸引了我的注意：函数修改了 function 对象中的 this 和参数。</p><h2 id="2-angular-bind-的使用"><a href="#2-angular-bind-的使用" class="headerlink" title="2 angular.bind 的使用"></a>2 angular.bind 的使用</h2><h4 id="2-1-函数说明"><a href="#2-1-函数说明" class="headerlink" title="2.1 函数说明"></a>2.1 函数说明</h4><p>angular.bind 函数具体使用如下</p><p><code>angular.bind(self, fn, args);</code>：将 self 对象绑定到 fn 中，通过 args 给 fn 传入参数</p><ul><li>self：Object 类型，在 fn 中通过 this 关键字引用；</li><li>fn: <code>function()</code> 类型，最后的返回值也是该 fn 对象</li><li>args: 任意类型，可选，通过 args 给 fn 传入参数</li></ul><p>angular.bind 函数从本质上改变了 function 对象中的 this 作用域和参数</p><h4 id="2-2-具体使用"><a href="#2-2-具体使用" class="headerlink" title="2.2 具体使用"></a>2.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> self = &#123;</span><br><span class="line">  name: <span class="string">'boyi'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例1--带参数</span></span><br><span class="line"><span class="keyword">var</span> f = angular.bind(self, <span class="comment">// 绑定对象，作为函数的上下文</span></span><br><span class="line">  <span class="comment">// 被绑定的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is '</span> + age + <span class="string">' !'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//绑定的参数，可省略</span></span><br><span class="line">  <span class="string">'15'</span></span><br><span class="line">);</span><br><span class="line">f(); <span class="comment">//调用绑定之后的function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//示例2--不带参数</span></span><br><span class="line"><span class="keyword">var</span> m = angular.bind(self, <span class="comment">//绑定对象，作为函数的上下文</span></span><br><span class="line">  <span class="comment">//被绑定的函数</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">age</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is '</span> + age + <span class="string">' !'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//省略参数</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">m(<span class="number">3</span>); <span class="comment">//调用传参的函数</span></span><br></pre></td></tr></table></figure><h2 id="3-JavaScript-中的-this"><a href="#3-JavaScript-中的-this" class="headerlink" title="3 JavaScript 中的 this"></a>3 JavaScript 中的 this</h2><h4 id="3-1-表示全局对象"><a href="#3-1-表示全局对象" class="headerlink" title="3.1 表示全局对象"></a>3.1 表示全局对象</h4><p>默认情况下 this 是指 全局对象</p><ul><li><code>全局对象.fn();</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line">test();  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h4 id="3-2-表示对象本身"><a href="#3-2-表示对象本身" class="headerlink" title="3.2 表示对象本身"></a>3.2 表示对象本身</h4><p>对象中的 function 是对象本身，</p><ul><li><code>对象.fn();</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.x = <span class="number">1</span>;</span><br><span class="line">obj.m = test;</span><br><span class="line"></span><br><span class="line">obj.m(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><h4 id="3-3-指定对象"><a href="#3-3-指定对象" class="headerlink" title="3.3 指定对象"></a>3.3 指定对象</h4><ul><li><code>apply()</code> 是函数的一个方法，作用是改变函数的调用对象，通过 <code>apply()</code> 可以修改 this 的引用</li><li>只有一个参数，可以为空，如果为空表示全局对象，如果传入参数 obj, 那么函数中的 this 的引用就指向 obj</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">　<span class="built_in">console</span>.log(<span class="keyword">this</span>.x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line">obj.x = <span class="number">1</span>;</span><br><span class="line">obj.m = test;</span><br><span class="line">obj.m.apply() <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><p><code>apply()</code> 的参数为空时，表示全局对象调用函数。因此，这时的运行结果为 0，证明 this 指的是全局对象。</p><p>如果把最后一行代码修改为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.m.apply(obj); <span class="comment">//1</span></span><br></pre></td></tr></table></figure><p>运行结果就变成了1，证明了这时this代表的是对象obj。</p><h2 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2010/04/using_this_keyword_in_javascript.html" target="_blank" rel="noopener">JavaScript 的 this 用法</a></li></ul>]]></content>
    
    <summary type="html">
    
      由 angular.bind 函数联想到有关 JavaScript function 对象中 this 的作用域问题。
    
    </summary>
    
      <category term="JavaScript" scheme="http://ckjava.com/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://ckjava.com/tags/JavaScript/"/>
    
      <category term="this" scheme="http://ckjava.com/tags/this/"/>
    
  </entry>
  
  <entry>
    <title>AngularJS 判断类型函数使用总结</title>
    <link href="http://ckjava.com/2019/05/31/AngularJS-function-practice/"/>
    <id>http://ckjava.com/2019/05/31/AngularJS-function-practice/</id>
    <published>2019-05-30T16:00:00.000Z</published>
    <updated>2019-05-31T00:43:26.558Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>AngularJS 中判断类型的函数共有 10 个，类似 9 个<code>angular.isXXX</code> 这种以及 <code>angular.equals</code>，这里将一一介绍这些函数的使用。</p><h2 id="2-angular-isUndefined"><a href="#2-angular-isUndefined" class="headerlink" title="2 angular.isUndefined"></a>2 angular.isUndefined</h2><ul><li><code>angular.isUndefined(value);</code></li></ul><h4 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h4><p>判断 value 是否是 undefined</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="2-2-具体使用"><a href="#2-2-具体使用" class="headerlink" title="2.2 具体使用"></a>2.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// true</span></span><br><span class="line">a = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a.name)); <span class="comment">// true</span></span><br><span class="line">a = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// false</span></span><br><span class="line">a = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a:%s isUndefined:%s"</span>, a, angular.isUndefined(a)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="3-angular-isDefined"><a href="#3-angular-isDefined" class="headerlink" title="3 angular.isDefined"></a>3 angular.isDefined</h2><ul><li><code>angular.isDefined(value);</code></li></ul><h4 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h4><p>判断参数 value 是否定义</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="3-2-具体使用"><a href="#3-2-具体使用" class="headerlink" title="3.2 具体使用"></a>3.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// false</span></span><br><span class="line">b = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b.name)); <span class="comment">// false</span></span><br><span class="line">b = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// true</span></span><br><span class="line">b = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b:%s isDefined:%s"</span>, b, angular.isDefined(b)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="4-angular-isObject"><a href="#4-angular-isObject" class="headerlink" title="4 angular.isObject"></a>4 angular.isObject</h2><ul><li><code>angular.isObject(value);</code></li></ul><h4 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h4><p>判断 value 是否是 Object，注意数组也认为是 Object</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="4-2-具体使用"><a href="#4-2-具体使用" class="headerlink" title="4.2 具体使用"></a>4.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br><span class="line">c = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// true</span></span><br><span class="line">c = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// true</span></span><br><span class="line">c = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c:%s isObject:%s"</span>, c, angular.isObject(c)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="5-angular-isString"><a href="#5-angular-isString" class="headerlink" title="5 angular.isString"></a>5 angular.isString</h2><ul><li><code>angular.isString(value);</code></li></ul><h4 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h4><p>判断 value 是否是 String</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型，字符串，<code>&#39;&#39;</code> 以及 <code>&quot;&quot;</code> 都会返回 true</li></ul><h4 id="5-2-具体使用"><a href="#5-2-具体使用" class="headerlink" title="5.2 具体使用"></a>5.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> h;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// true</span></span><br><span class="line">h = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br><span class="line">h = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s isString:%s"</span>, h, angular.isString(h)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="6-angular-isNumber"><a href="#6-angular-isNumber" class="headerlink" title="6 angular.isNumber"></a>6 angular.isNumber</h2><ul><li><code>angular.isNumber(value);</code></li></ul><h4 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h4><p>判断 value 是否是 Number 对象，注意 <code>NaN</code>, <code>+Infinity</code> and <code>-Infinity</code> 这些特殊的 Number，判断它们也会返回 true, 通过 isFinite 方法判断才返回 false</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="6-2-具体使用"><a href="#6-2-具体使用" class="headerlink" title="6.2 具体使用"></a>6.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> j;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// false</span></span><br><span class="line">j = <span class="number">12</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = <span class="literal">NaN</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = +<span class="literal">Infinity</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line">j = -<span class="literal">Infinity</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"j:%s isNumber:%s"</span>, j, angular.isNumber(j)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"NaN isNaN:%s"</span>, <span class="built_in">isNaN</span>(<span class="literal">NaN</span>)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"NaN isFinite:%s"</span>, <span class="built_in">isFinite</span>(<span class="literal">NaN</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"+Infinity isFinite:%s"</span>, <span class="built_in">isFinite</span>(+<span class="literal">Infinity</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"-Infinity isFinite:%s"</span>, <span class="built_in">isFinite</span>(-<span class="literal">Infinity</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="7-angular-isArray"><a href="#7-angular-isArray" class="headerlink" title="7 angular.isArray"></a>7 angular.isArray</h2><ul><li><code>angular.isArray(value);</code></li></ul><h4 id="7-1-概述"><a href="#7-1-概述" class="headerlink" title="7.1 概述"></a>7.1 概述</h4><p>判断 value 是否是 Array 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="7-2-具体使用"><a href="#7-2-具体使用" class="headerlink" title="7.2 具体使用"></a>7.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> d;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">"vala"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br><span class="line">d = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// true</span></span><br><span class="line">d = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"d:%s isArray:%s"</span>, d, angular.isArray(d)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="8-angular-isDate"><a href="#8-angular-isDate" class="headerlink" title="8 angular.isDate"></a>8 angular.isDate</h2><ul><li><code>angular.isDate(value);</code></li></ul><h4 id="8-1-概述"><a href="#8-1-概述" class="headerlink" title="8.1 概述"></a>8.1 概述</h4><p>判断 value 是否是 Date 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="8-2-具体使用"><a href="#8-2-具体使用" class="headerlink" title="8.2 具体使用"></a>8.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// true</span></span><br><span class="line">e = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br><span class="line">e = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"e:%s isDate:%s"</span>, e, angular.isDate(e)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="9-angular-isFunction"><a href="#9-angular-isFunction" class="headerlink" title="9 angular.isFunction"></a>9 angular.isFunction</h2><ul><li><code>angular.isFunction(value);</code></li></ul><h4 id="9-1-概述"><a href="#9-1-概述" class="headerlink" title="9.1 概述"></a>9.1 概述</h4><p>判断 value 是否是 Function 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="9-2-具体使用"><a href="#9-2-具体使用" class="headerlink" title="9.2 具体使用"></a>9.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// true</span></span><br><span class="line">f = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br><span class="line">f = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"f:%s isFunction:%s"</span>, f, angular.isFunction(f)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="10-angular-isElement"><a href="#10-angular-isElement" class="headerlink" title="10 angular.isElement"></a>10 angular.isElement</h2><ul><li><code>angular.isElement(value);</code></li></ul><h4 id="10-1-概述"><a href="#10-1-概述" class="headerlink" title="10.1 概述"></a>10.1 概述</h4><p>判断 value 是否是 DOM element 对象或者 jQuery 对象</p><ul><li>参数 value 可以是任意类型</li><li>返回值 boolean 类型</li></ul><h4 id="10-2-具体使用"><a href="#10-2-具体使用" class="headerlink" title="10.2 具体使用"></a>10.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="built_in">document</span>.getElementById(<span class="string">'eleTest'</span>); <span class="comment">// 原生js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = angular.element(<span class="built_in">document</span>).find(<span class="string">'#eleTest'</span>); <span class="comment">// angularJS 内置jQuery</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = $(<span class="string">'#eleTest'</span>); <span class="comment">// jQuery 的方式</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// true</span></span><br><span class="line">g = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br><span class="line">g = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"g:%s isElement:%s"</span>, g, angular.isElement(g)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="11-angular-equals"><a href="#11-angular-equals" class="headerlink" title="11 angular.equals"></a>11 angular.equals</h2><ul><li><code>angular.equals(o1, o2);</code></li></ul><h4 id="11-1-概述"><a href="#11-1-概述" class="headerlink" title="11.1 概述"></a>11.1 概述</h4><ul><li>参数 o1 和 o2 可以是任意类型</li><li><p>返回值 boolean 类型</p></li><li><p>判断两个对象或者两个值是否相等，判断的对象或者类型包括：值对象，正则表达式，数组，对象</p></li><li>如果两个对象相等，那么必须至少满足下面任意一个条件<ol><li>都是对象或者值，并且 <code>o1===o2</code></li><li>如果是对象，那么对象中的所有属性一致，如果是值，那么值的类型必须一致并且相等（===）</li><li>都是 NaN</li><li>都是正则表达式，angular.equals(/abc/, /abc/) 返回值为 true</li></ol></li><li>在比较中，对象中的方法属性或者属性以<code>$</code>开头将被忽略</li></ul><h4 id="11-2-具体使用"><a href="#11-2-具体使用" class="headerlink" title="11.2 具体使用"></a>11.2 具体使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// angular.equals</span></span><br><span class="line"><span class="keyword">var</span> h;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">"2014-12-14"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> h2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">var</span> abc = <span class="string">'abcd'</span>; &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h2, angular.equals(h, h2)); <span class="comment">// false</span></span><br><span class="line">h = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">''</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, &#123;<span class="string">'name'</span>:<span class="string">'joe'</span>&#125;)); <span class="comment">// false</span></span><br><span class="line">h = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br><span class="line">h = <span class="literal">undefined</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"h:%s equals:%s"</span>, h, angular.equals(h, h)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2 id="12-参考"><a href="#12-参考" class="headerlink" title="12 参考"></a>12 参考</h2><ul><li><a href="https://docs.angularjs.org/api/ng/function" target="_blank" rel="noopener">AngularJS 函数官方文档</a></li><li><a href="https://embed.plnkr.co/UoISeN/" target="_blank" rel="noopener">plnkr 代码</a></li></ul>]]></content>
    
    <summary type="html">
    
      AngularJS 中判断类型的函数共有 10 个，类似 9 个`angular.isXXX` 这种以及 `angular.equals`，这里将一一介绍这些函数的使用。
    
    </summary>
    
      <category term="AngularJS" scheme="http://ckjava.com/categories/AngularJS/"/>
    
    
      <category term="AngularJS" scheme="http://ckjava.com/tags/AngularJS/"/>
    
      <category term="函数" scheme="http://ckjava.com/tags/%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 集成 Jpa 实现单表 CRUD 功能并提供 RESTful api 服务</title>
    <link href="http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/"/>
    <id>http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/</id>
    <published>2019-05-26T16:00:00.000Z</published>
    <updated>2019-07-23T14:26:13.512Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><ol><li>这里介绍在 SpringBoot 集成 Jpa 并提供 RESTful api 服务，实现单表的 CRUD 功能</li><li>使用 Swagger 自动生成 RESTful api 文档</li><li>通过泛型封装 Service 和 Controller 抽象基类</li></ol><h2 id="2-应用配置"><a href="#2-应用配置" class="headerlink" title="2 应用配置"></a>2 应用配置</h2><ul><li>通过 application-dev.yml 和 application-prd.yml 区分不同的开发环境，测试开发使用 h2 db, 生产环境使用 mysql</li><li><p>在 IDE 开发中通过在 vm 参数中增加 <code>-Dspring.profiles.active=dev</code> 来使用  application-dev.yml 文件中的配置, 在生产环境的启动脚本中通过 <code>java -Dspring.profiles.active=prd -jar appProject.jar</code> 来使用 application-prd.yml 文件中的配置</p></li><li><p><code>src\main\resources\application-dev.yml</code> 配置如下</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:h2:~/test</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">SA</span></span><br><span class="line"><span class="attr">    password:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">create-drop</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.H2Dialect</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><code>src\main\resources\application-prd.yml</code> 配置如下      <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jpaTest;DB_CLOSE_ON_EXIT=FALSE</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">update</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.MySQLDialect</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="3-jpa-配置"><a href="#3-jpa-配置" class="headerlink" title="3 jpa 配置"></a>3 jpa 配置</h2><ul><li>通过 Environment 和 @Value 两种方式来获取 application.yml 中的配置</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.xutils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories</span>(basePackages = <span class="string">"com.ckjava.test"</span>,</span><br><span class="line">        entityManagerFactoryRef = <span class="string">"entityManagerFactory"</span>,</span><br><span class="line">        transactionManagerRef = <span class="string">"transactionManager"</span>)</span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;datasource.sampleapp.maxPoolSize:10&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 将配置填充到 SpringBoot 中的 DataSourceProperties 对象里面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"datasource.sampleapp"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">dataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 配置 HikariCP 连接池数据源.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceProperties dataSourceProperties = dataSourceProperties();</span><br><span class="line">        HikariDataSource dataSource = (HikariDataSource) DataSourceBuilder</span><br><span class="line">                .create(dataSourceProperties.getClassLoader())</span><br><span class="line">                .driverClassName(dataSourceProperties.getDriverClassName())</span><br><span class="line">                .url(dataSourceProperties.getUrl())</span><br><span class="line">                .username(dataSourceProperties.getUsername())</span><br><span class="line">                .password(dataSourceProperties.getPassword())</span><br><span class="line">                .type(HikariDataSource.class)</span><br><span class="line">                .build();</span><br><span class="line">        dataSource.setMaximumPoolSize(maxPoolSize);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Entity Manager Factory 配置.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> <span class="keyword">throws</span> NamingException </span>&#123;</span><br><span class="line">        LocalContainerEntityManagerFactoryBean factoryBean = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</span><br><span class="line">        factoryBean.setDataSource(dataSource());</span><br><span class="line">        factoryBean.setPackagesToScan(<span class="keyword">new</span> String[]&#123;<span class="string">"com.ckjava.test.domain"</span>&#125;);</span><br><span class="line">        factoryBean.setJpaVendorAdapter(jpaVendorAdapter());</span><br><span class="line">        factoryBean.setJpaProperties(jpaProperties());</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定 hibernate 为 jpa 的持久化框架</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HibernateJpaVendorAdapter hibernateJpaVendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();</span><br><span class="line">        <span class="keyword">return</span> hibernateJpaVendorAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 读取 hibernate 相关配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Properties <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.put(<span class="string">"hibernate.dialect"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.dialect"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.hbm2ddl.auto"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.hbm2ddl.auto"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.show_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.show_sql"</span>));</span><br><span class="line">        properties.put(<span class="string">"hibernate.format_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.format_sql"</span>));</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>))) &#123;</span><br><span class="line">            properties.put(<span class="string">"hibernate.default_schema"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">(EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">        JpaTransactionManager txManager = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">        txManager.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">        <span class="keyword">return</span> txManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-集成-Swagger"><a href="#4-集成-Swagger" class="headerlink" title="4 集成 Swagger"></a>4 集成 Swagger</h2><p>Swagger 用于将 RESTful api 提供一个可视化，可调试的页面，便于开发和测试</p><ul><li>maven 依赖如下</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Swagger 配置类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">api</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2).select()</span><br><span class="line">.apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br><span class="line">.paths(PathSelectors.any()).build()</span><br><span class="line">.apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(<span class="string">"api 标题"</span>).description(<span class="string">"api 描述"</span>).version(<span class="string">"1.0.0"</span>)</span><br><span class="line">.termsOfServiceUrl(<span class="string">"http://ckjava.com"</span>).license(<span class="string">"MIT"</span>)</span><br><span class="line">.licenseUrl(<span class="string">"http://ckjava.com"</span>).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>WebAppConfig 用于配置 swagger-ui.html 页面的访问地址， swagger-ui.html 这页面是通过 Maven 依赖引入的，在系统中的实际路径是：<code>classpath:/META-INF/resources/swagger-ui.html</code>, 通过映射，可以通过 <code>http://host:ip/contextPath/swagger-ui.html</code> 访问到。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 自动将 `src\main\resources\webStatic` 目录的文件映射到 /**</span></span><br><span class="line"><span class="comment">         * /** 表示匹配任意层级的目录和文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//registry.addResourceHandler(new String[]&#123;"/**"&#125;).addResourceLocations("classpath:/webStatic/").setCacheControl(CacheControl.noCache());</span></span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">"swagger-ui.html"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/"</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">"/webjars/**"</span>).addResourceLocations(<span class="string">"classpath:/META-INF/resources/webjars/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-业务开发"><a href="#5-业务开发" class="headerlink" title="5 业务开发"></a>5 业务开发</h2><p>具体的业务开发分为业务实体定义，业务逻辑以及web 接口。</p><h4 id="5-1-业务实体定义-domain"><a href="#5-1-业务实体定义-domain" class="headerlink" title="5.1 业务实体定义 domain"></a>5.1 业务实体定义 domain</h4><ul><li>定义实体基类 BaseJpaEntity，包含了基本的字段</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MappedSuperclass</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEL_YES = <span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEL_NO = <span class="string">"0"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy= GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">protected</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"create_date"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"创建时间"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="keyword">protected</span> Date createDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"create_user"</span>, length = <span class="number">64</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"创建人"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"update_date"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"更新时间"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="keyword">protected</span> Date updateDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"update_user"</span>, length = <span class="number">64</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"更新人"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String updateUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"del_flag"</span>, length = <span class="number">1</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"删除标识"</span>)</span><br><span class="line">    <span class="keyword">protected</span> String delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"排序字段"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> String orderBy;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"排序方式 "</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Boolean desc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"起始行数"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Integer start;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"每页数据大小"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Integer pageSize;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(hidden = <span class="keyword">true</span>, value = <span class="string">"查询条件"</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">transient</span> Map&lt;String, String&gt; conditionMap;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 忽略 get/set 构造函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义 Task 实体类，继承 BaseJpaEntity</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.NotEmpty;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"task"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Task</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"name"</span>, length = <span class="number">255</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"任务名称"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"date"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(timezone = <span class="string">"GMT+08"</span>, pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 返回格式化的字符串</span></span><br><span class="line">    <span class="meta">@DateTimeFormat</span>(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>) <span class="comment">// 接收格式化的字符串，转为Date类型对象</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"所属日期"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"content"</span>, length = <span class="number">2000</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"具体内容"</span>)</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略 get/set 构造函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义分页参数对象 PageParamer, 用于处理前端传过来的 分页参数，查询条件，排序等字段</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页参数对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModel</span>(<span class="string">"分页参数对象"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageParamer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"排序对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Sort sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"字段搜索对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Search search;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"分页导航条对象"</span>)</span><br><span class="line">    <span class="keyword">private</span> Pagination pagination;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sort <span class="title">getSort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSort</span><span class="params">(Sort sort)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = sort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Search <span class="title">getSearch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> search;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSearch</span><span class="params">(Search search)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.search = search;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pagination <span class="title">getPagination</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pagination;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPagination</span><span class="params">(Pagination pagination)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pagination = pagination;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"排序对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sort</span> </span>&#123;</span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"排序字段"</span>)</span><br><span class="line">        <span class="keyword">private</span> String predicate;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"是否倒序"</span>)</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> reverse;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getPredicate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> predicate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPredicate</span><span class="params">(String predicate)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicate = predicate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isReverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> reverse;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReverse</span><span class="params">(<span class="keyword">boolean</span> reverse)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.reverse = reverse;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Sort</span><span class="params">(String predicate, <span class="keyword">boolean</span> reverse)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicate = predicate;</span><br><span class="line">            <span class="keyword">this</span>.reverse = reverse;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字段搜索对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"字段搜索对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Search</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"关键字段"</span>)</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, String&gt; predicateObject;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getPredicateObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPredicateObject</span><span class="params">(Map&lt;String, String&gt; predicateObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicateObject = predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Search</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Search</span><span class="params">(Map&lt;String, String&gt; predicateObject)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.predicateObject = predicateObject;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页导航条对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiModel</span>(<span class="string">"分页导航条对象"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pagination</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"起始行"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer start;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"总记录数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer totalItemCount;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"每页记录数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer number;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@ApiModelProperty</span>(<span class="string">"总页数"</span>)</span><br><span class="line">        <span class="keyword">private</span> Integer numberOfPages;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(Integer start)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> totalItemCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalItemCount</span><span class="params">(Integer totalItemCount)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.totalItemCount = totalItemCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> number;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(Integer number)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.number = number;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getNumberOfPages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumberOfPages</span><span class="params">(Integer numberOfPages)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.numberOfPages = numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pagination</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pagination</span><span class="params">(Integer start, Integer totalItemCount, Integer number, Integer numberOfPages)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.start = start;</span><br><span class="line">            <span class="keyword">this</span>.totalItemCount = totalItemCount;</span><br><span class="line">            <span class="keyword">this</span>.number = number;</span><br><span class="line">            <span class="keyword">this</span>.numberOfPages = numberOfPages;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageParamer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PageParamer</span><span class="params">(Sort sort, Search search, Pagination pagination)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sort = sort;</span><br><span class="line">        <span class="keyword">this</span>.search = search;</span><br><span class="line">        <span class="keyword">this</span>.pagination = pagination;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-2-业务逻辑-service"><a href="#5-2-业务逻辑-service" class="headerlink" title="5.2 业务逻辑 service"></a>5.2 业务逻辑 service</h4><ol><li>BaseJpaCrudService 泛型基类<ul><li>通过封装 EntityManager 对象和泛型来定义 BaseJpaCrudService 对象，做到通用化</li><li>增加 <code>@Transactional(readOnly = true)</code>，子类所有的方法默认没有事务，<code>@Transactional</code> 是可继承的</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.TypedQuery;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaCrudService</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span>&gt; <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Class&lt;E&gt; <span class="title">getClassType</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 查询一个对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entityManager.find(getClassType(), id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;E&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;E&gt; dataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dataList = entityManager.createQuery( <span class="string">"from "</span> + getClassType().getName(), getClassType()).getResultList();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页获取数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;E&gt; <span class="title">getPage</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        StringBuilder qlString = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        qlString.append(<span class="string">"from "</span> + getClassType().getName());</span><br><span class="line">        qlString.append(<span class="string">" where 1=1 "</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; conditionMap = e.getConditionMap();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = conditionMap.entrySet().iterator(); it.hasNext();) &#123;</span><br><span class="line">            Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">            <span class="comment">// key name, value like,张三</span></span><br><span class="line">            <span class="comment">// key age, value =,10</span></span><br><span class="line"></span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            String value = entry.getValue();</span><br><span class="line">            String op = value.split(SPLITER.COMMA)[<span class="number">0</span>];</span><br><span class="line">            qlString.append(<span class="string">" and "</span> + key + <span class="string">" "</span> + op + <span class="string">" :"</span> + key); <span class="comment">// name LIKE :name 或者 age = :age</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        qlString.append(<span class="string">" order by :desc "</span>);</span><br><span class="line"></span><br><span class="line">        TypedQuery&lt;E&gt; typedQuery = entityManager.createQuery(qlString.toString(), getClassType())</span><br><span class="line">                .setParameter(<span class="string">"desc"</span>, e.getDesc())</span><br><span class="line">                .setFirstResult(e.getStart())</span><br><span class="line">                .setMaxResults(e.getPageSize());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = conditionMap.entrySet().iterator(); it.hasNext();) &#123;</span><br><span class="line">            Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            String value = entry.getValue();</span><br><span class="line">            String valued = value.split(SPLITER.COMMA)[<span class="number">1</span>];</span><br><span class="line">            typedQuery.setParameter(key, valued);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Page&lt;&gt;(e.getStart(), e.getPageSize(), typedQuery.getMaxResults(), typedQuery.getResultList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdate</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e.getId() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            save(e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            update(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setDelFlag(E.DEL_NO);</span><br><span class="line">        e.setCreateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        entityManager.persist(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">update</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setUpdateDate(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> entityManager.merge(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        e.setDelFlag(E.DEL_YES);</span><br><span class="line">        update(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        E e = get(id);</span><br><span class="line">        delete(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>TaskService 实现如下</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.base.BaseJpaCrudService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.transaction.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskService</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudService</span>&lt;<span class="title">Task</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;Task&gt; <span class="title">getClassType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Task.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-3-web-接口-RESTful-api"><a href="#5-3-web-接口-RESTful-api" class="headerlink" title="5.3 web 接口 RESTful api"></a>5.3 web 接口 RESTful api</h4><ol><li>CorsController 抽象类: 通过 <code>@CrossOrigin</code> 注解使 RESTful api 可以跨域访问</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CrossOrigin</span>(</span><br><span class="line">        origins = <span class="string">"*"</span>,</span><br><span class="line">        allowedHeaders = <span class="string">"*"</span>,</span><br><span class="line">        allowCredentials = <span class="string">"true"</span>,</span><br><span class="line">        methods = &#123;RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, RequestMethod.OPTIONS, RequestMethod.HEAD&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>BaseJpaCrudController 泛型抽象基类，继承 CorsController，并通过泛型做到通用化</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.base.BaseJpaEntity;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.base.BaseJpaCrudService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.Constants;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseJpaCrudController</span>&lt;<span class="title">S</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudService</span>, <span class="title">E</span> <span class="keyword">extends</span> <span class="title">BaseJpaEntity</span>&gt; <span class="keyword">extends</span> <span class="title">CorsController</span> <span class="keyword">implements</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> S service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"根据 id 获取一个对象"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;Object&gt; <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(service.get(id), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"获取所有的对象"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/all"</span>)</span><br><span class="line">    <span class="keyword">public</span> HttpResponse&lt;List&lt;E&gt;&gt; findAll() &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(service.findAll(), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"保存或者修改一个对象"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse&lt;String&gt; <span class="title">saveOrUpdate</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @RequestBody E e)</span> </span>&#123;</span><br><span class="line">        service.saveOrUpdate(e);</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(HttpResponse.SUCCESS, HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"根据 id 删除一个对象"</span>)</span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">delete</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        service.delete(id);</span><br><span class="line">        <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>TaskController 实现类，这里只提供分页方法，其他 CRUD 接口自动继承</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.PageParamer;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.service.TaskService;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.web.base.BaseJpaCrudController;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.http.Page;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Api</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/task"</span>, produces = <span class="string">"application/json;charset=utf-8"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">BaseJpaCrudController</span>&lt;<span class="title">TaskService</span>, <span class="title">Task</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(<span class="string">"分页获取数据"</span>)</span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"page"</span>)</span><br><span class="line">    <span class="keyword">public</span> HttpResponse&lt;Page&lt;Task&gt;&gt; page(</span><br><span class="line">            <span class="meta">@ApiParam</span>(<span class="string">"&#123;\n"</span> +</span><br><span class="line">                    <span class="string">"    \"sort\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"predicate\": \"id\",\n"</span> +</span><br><span class="line">                    <span class="string">"        \"reverse\": true\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                    <span class="string">"    \"search\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"predicateObject\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"            \"name\": \"like,test\"\n"</span> +</span><br><span class="line">                    <span class="string">"        &#125;\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;,\n"</span> +</span><br><span class="line">                    <span class="string">"    \"pagination\": &#123;\n"</span> +</span><br><span class="line">                    <span class="string">"        \"start\": 1,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"totalItemCount\": 0,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"number\": 10,\n"</span> +</span><br><span class="line">                    <span class="string">"        \"numberOfPages\": 2\n"</span> +</span><br><span class="line">                    <span class="string">"    &#125;"</span> +</span><br><span class="line">                    <span class="string">" &#125;\n"</span> +</span><br><span class="line">                    <span class="string">"对于 predicateObject 中的参数，如果 activity=false, 传参为： \"activity\": \"=,false\"，"</span> +</span><br><span class="line">                    <span class="string">"如果 activity like '%false%', 传参为 \"activity\": \"like,false\""</span> +</span><br><span class="line">                    <span class="string">"&#125;"</span>)</span><br><span class="line">            <span class="meta">@RequestParam</span> String params) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            PageParamer pageParamer = JSONObject.parseObject(params, PageParamer.class);</span><br><span class="line"></span><br><span class="line">            Task task = <span class="keyword">new</span> Task();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 排序</span></span><br><span class="line">            task.setOrderBy(pageParamer.getSort().getPredicate());</span><br><span class="line">            task.setDesc(pageParamer.getSort().isReverse());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查询字段</span></span><br><span class="line">            task.setConditionMap(pageParamer.getSearch().getPredicateObject());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 分页导航</span></span><br><span class="line">            task.setStart(pageParamer.getPagination().getStart());</span><br><span class="line">            task.setPageSize(pageParamer.getPagination().getNumber());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> HttpResponse.getReturn(service.getPage(task), HttpResponse.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> HttpResponse.getReturn(<span class="keyword">null</span>, HttpResponse.EXCEPTION, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-完整的-pom"><a href="#6-完整的-pom" class="headerlink" title="6 完整的 pom"></a>6 完整的 pom</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ckjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-jpa-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-boot-jpa-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ckjava.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swagger2.version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">swagger2.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.15.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Test --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- swagger2 相关 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- jpa --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jpa --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Add Hikari Connection Pooling support --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Add Hikari Connection Pooling support --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- freemarker --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- freemarker --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- h2 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.199<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- h2 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ckjava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      这里介绍在 SpringBoot 集成 Jpa 并提供 RESTful api 服务，实现单表的 CRUD 功能；使用 Swagger 自动生成 RESTful api 文档；通过泛型封装 Service 和 Controller 抽象基类。
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="jpa" scheme="http://ckjava.com/tags/jpa/"/>
    
      <category term="RESTful" scheme="http://ckjava.com/tags/RESTful/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot Jpa 单元测试实践</title>
    <link href="http://ckjava.com/2019/05/27/SpringBoot-jpa-junit-test-practice/"/>
    <id>http://ckjava.com/2019/05/27/SpringBoot-jpa-junit-test-practice/</id>
    <published>2019-05-26T16:00:00.000Z</published>
    <updated>2019-07-23T14:25:59.663Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>本文将介绍如何在 SpringBoot 环境中编写独立于 Spring context 的 Jpa 单元测试，比如：单个 service, 单个 controller 的单元测试。</p><h2 id="2-依赖"><a href="#2-依赖" class="headerlink" title="2 依赖"></a>2 依赖</h2><p>依赖如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.13.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.196<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>spring-boot-starter-test</code> 是 SpringBoot 测试的主要依赖</li><li>h2 DB 是内存型数据库，与数据有关的操作仅在测试环境中有效</li></ul><h2 id="3-父类-BaseTest-定义"><a href="#3-父类-BaseTest-定义" class="headerlink" title="3 父类 BaseTest 定义"></a>3 父类 BaseTest 定义</h2><p>BaseTest 定义了测试需要的 Bean 以及测试需要用的配置文件，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.web.TaskController;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.xutils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.zaxxer.hikari.HikariDataSource;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.ConfigFileApplicationContextInitializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.TestConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.JpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ActiveProfiles;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.TestPropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.setup.MockMvcBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.PlatformTransactionManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(initializers = ConfigFileApplicationContextInitializer.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestConfiguration</span></span><br><span class="line">    <span class="meta">@TestPropertySource</span>(locations = <span class="string">"classpath:application.yml"</span>)</span><br><span class="line">    <span class="meta">@ActiveProfiles</span>(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TestContextConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">private</span> Environment environment;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value</span>(<span class="string">"$&#123;datasource.sampleapp.maxPoolSize:10&#125;"</span>)</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxPoolSize;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 将 application.yml 的配置填充到 SpringBoot 中的 DataSourceProperties 对象里面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@Primary</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSourceProperties <span class="title">dataSourceProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DataSourceProperties dataSourceProperties = <span class="keyword">new</span> DataSourceProperties();</span><br><span class="line">            dataSourceProperties.setDriverClassName(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.driverClassName"</span>));</span><br><span class="line">            dataSourceProperties.setUrl(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.url"</span>));</span><br><span class="line">            dataSourceProperties.setUsername(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.username"</span>));</span><br><span class="line">            dataSourceProperties.setPassword(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.password"</span>));</span><br><span class="line">            <span class="keyword">return</span> dataSourceProperties;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 配置 HikariCP 连接池数据源.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            DataSourceProperties dataSourceProperties = dataSourceProperties();</span><br><span class="line">            HikariDataSource dataSource = (HikariDataSource) DataSourceBuilder</span><br><span class="line">                    .create(dataSourceProperties.getClassLoader())</span><br><span class="line">                    .driverClassName(dataSourceProperties.getDriverClassName())</span><br><span class="line">                    .url(dataSourceProperties.getUrl())</span><br><span class="line">                    .username(dataSourceProperties.getUsername())</span><br><span class="line">                    .password(dataSourceProperties.getPassword())</span><br><span class="line">                    .type(HikariDataSource.class)</span><br><span class="line">                    .build();</span><br><span class="line">            dataSource.setMaximumPoolSize(maxPoolSize);</span><br><span class="line">            <span class="keyword">return</span> dataSource;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Entity Manager Factory 配置.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> <span class="keyword">throws</span> NamingException </span>&#123;</span><br><span class="line">            LocalContainerEntityManagerFactoryBean factoryBean = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</span><br><span class="line">            factoryBean.setDataSource(dataSource());</span><br><span class="line">            factoryBean.setPackagesToScan(<span class="keyword">new</span> String[]&#123;<span class="string">"com.ckjava.test.domain"</span>&#125;);</span><br><span class="line">            factoryBean.setJpaVendorAdapter(jpaVendorAdapter());</span><br><span class="line">            factoryBean.setJpaProperties(jpaProperties());</span><br><span class="line">            <span class="keyword">return</span> factoryBean;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 指定 hibernate 为 jpa 的持久化框架</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            HibernateJpaVendorAdapter hibernateJpaVendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();</span><br><span class="line">            <span class="keyword">return</span> hibernateJpaVendorAdapter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 从 application.yml 中读取 hibernate 相关配置</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Properties <span class="title">jpaProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            properties.put(<span class="string">"hibernate.dialect"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.dialect"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.hbm2ddl.auto"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.hbm2ddl.auto"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.show_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.show_sql"</span>));</span><br><span class="line">            properties.put(<span class="string">"hibernate.format_sql"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.hibernate.format_sql"</span>));</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotEmpty(environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>))) &#123;</span><br><span class="line">                properties.put(<span class="string">"hibernate.default_schema"</span>, environment.getRequiredProperty(<span class="string">"datasource.sampleapp.defaultSchema"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> properties;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">transactionManager</span><span class="params">(EntityManagerFactory entityManagerFactory)</span> </span>&#123;</span><br><span class="line">            JpaTransactionManager txManager = <span class="keyword">new</span> JpaTransactionManager();</span><br><span class="line">            txManager.setEntityManagerFactory(entityManagerFactory);</span><br><span class="line">            <span class="keyword">return</span> txManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TaskService <span class="title">taskService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TaskService();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TaskController <span class="title">taskController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TaskController();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> MockMvc <span class="title">mockMvc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Object[] contorllers = &#123; taskController() &#125;;</span><br><span class="line">            <span class="keyword">return</span> MockMvcBuilders.standaloneSetup(contorllers).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>@ContextConfiguration(initializers = ConfigFileApplicationContextInitializer.class)</code> 必须放在父类中，这个配置用于解析测试配置文件 application.yml</li><li><code>@TestConfiguration</code> 配置测试需要的 Bean, 包含了 jpa 数据源 DataSource Bean， entityManagerFactory Bean, transactionManager Bean 等</li><li><code>@TestPropertySource(locations = &quot;classpath:application.yml&quot;)</code> 表示测试使用的配置文件</li><li><code>@ActiveProfiles(&quot;local&quot;)</code> 表示测试使用 application.yml 配置文件中的 local profile</li></ul><h2 id="4-Service-单元测试"><a href="#4-Service-单元测试" class="headerlink" title="4 Service 单元测试"></a>4 Service 单元测试</h2><ul><li>TestTaskService 直接继承 BaseTest， 通过 <code>@Autowired</code> 注入待测 TaskService Bean</li><li>TaskService Bean 在 BaseTest 中的 TestContextConfiguration 类中定义</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTaskService</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TaskService taskService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// save</span></span><br><span class="line">        Task task = <span class="keyword">new</span> Task();</span><br><span class="line">        task.setName(<span class="string">"test1"</span>);</span><br><span class="line">        task.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        task.setContent(<span class="string">"test content"</span>);</span><br><span class="line">        taskService.save(task);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// findAll</span></span><br><span class="line">        List&lt;Task&gt; taskList = taskService.findAll();</span><br><span class="line">        Assert.assertTrue(taskList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        task = taskList.get(<span class="number">0</span>);</span><br><span class="line">        taskService.delete(task);</span><br><span class="line"></span><br><span class="line">        taskList = taskService.findAll();</span><br><span class="line">        task = taskList.get(<span class="number">0</span>);</span><br><span class="line">        Assert.assertTrue(task.getDelFlag().equals(<span class="string">"1"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Controller-单元测试"><a href="#5-Controller-单元测试" class="headerlink" title="5  Controller 单元测试"></a>5  Controller 单元测试</h2><ul><li>TestTaskController 直接继承 BaseTest， 通过 <code>@Autowired</code> 注入待测 MockMvc Bean</li><li>MockMvc Bean 在 BaseTest 中的 TestContextConfiguration 类中定义</li><li>其中 MockMvc Bean 创建过程中引入了 TaskController Bean</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.ckjava.test.domain.Task;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mock.web.MockHttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.MvcResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.ResultActions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTaskController</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Task task = <span class="keyword">new</span> Task();</span><br><span class="line">        task.setId(<span class="number">1L</span>);</span><br><span class="line">        task.setName(<span class="string">"test"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// post</span></span><br><span class="line">        ResultActions postResultActions = mockMvc.perform(</span><br><span class="line">                MockMvcRequestBuilders.post(<span class="string">"/api/task"</span>)</span><br><span class="line">                        .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                        .content(JSONObject.toJSONString(task))</span><br><span class="line">                        .contentType(MediaType.APPLICATION_JSON));</span><br><span class="line">        Assert.assertTrue(postResultActions.andReturn().getResponse().getStatus() == <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get</span></span><br><span class="line">        ResultActions resultActions = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">"/api/task/"</span>.concat(task.getId().toString()))</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        MvcResult mvcResult = resultActions.andReturn();</span><br><span class="line">        MockHttpServletResponse resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        JSONObject obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        JSONObject dataObj = obj.getJSONObject(<span class="string">"data"</span>);</span><br><span class="line">        task = dataObj.toJavaObject(Task.class);</span><br><span class="line">        Assert.assertTrue(task.getId() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// findAll</span></span><br><span class="line">        resultActions = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">"/api/task/all"</span>)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        mvcResult = resultActions.andReturn();</span><br><span class="line">        resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        JSONArray dataArr = obj.getJSONArray(<span class="string">"data"</span>);</span><br><span class="line">        List&lt;Task&gt; dataList = dataArr.toJavaList(Task.class);</span><br><span class="line">        Assert.assertTrue(dataList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        task = dataList.get(<span class="number">0</span>);</span><br><span class="line">        Assert.assertTrue(task.getId() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// delete</span></span><br><span class="line">        resultActions = mockMvc.perform(MockMvcRequestBuilders.delete(<span class="string">"/api/task/"</span>.concat(task.getId().toString()))</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON));</span><br><span class="line"></span><br><span class="line">        mvcResult = resultActions.andReturn();</span><br><span class="line">        resp = mvcResult.getResponse();</span><br><span class="line">        Assert.assertEquals(resp.getStatus(), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        obj = JSONObject.parseObject(resp.getContentAsString());</span><br><span class="line">        dataObj = obj.getJSONObject(<span class="string">"data"</span>);</span><br><span class="line">        Assert.assertNull(dataObj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-问题"><a href="#6-问题" class="headerlink" title="6 问题"></a>6 问题</h2><h4 id="6-1-javax-persistence-TransactionRequiredException-No-EntityManager-with-actual-transaction-available-for-current-thread-cannot-reliably-process-39-persist-39-call"><a href="#6-1-javax-persistence-TransactionRequiredException-No-EntityManager-with-actual-transaction-available-for-current-thread-cannot-reliably-process-39-persist-39-call" class="headerlink" title="6.1 javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process &#39;persist&#39; call"></a>6.1 <code>javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process &#39;persist&#39; call</code></h4><ul><li>解决方法如下</li></ul><p>在相关的测试方法上也要加上 <code>@Transactional</code>，具体如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCRUD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// save</span></span><br><span class="line">    Task task = <span class="keyword">new</span> Task();</span><br><span class="line">    task.setName(<span class="string">"test1"</span>);</span><br><span class="line">    task.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">    task.setContent(<span class="string">"test content"</span>);</span><br><span class="line">    taskService.save(task);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// findAll</span></span><br><span class="line">    List&lt;Task&gt; taskList = taskService.findAll();</span><br><span class="line">    Assert.assertTrue(taskList.size() == <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    task = taskList.get(<span class="number">0</span>);</span><br><span class="line">    taskService.delete(task);</span><br><span class="line"></span><br><span class="line">    taskList = taskService.findAll();</span><br><span class="line">    task = taskList.get(<span class="number">0</span>);</span><br><span class="line">    Assert.assertTrue(task.getDelFlag().equals(<span class="string">"1"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-2-org-h2-jdbc-JdbcSQLException-Database-is-already-closed-to-disable-automatic-closing-at-VM-shutdown-add-quot-DB-CLOSE-ON-EXIT-FALSE-quot-to-the-db-URL"><a href="#6-2-org-h2-jdbc-JdbcSQLException-Database-is-already-closed-to-disable-automatic-closing-at-VM-shutdown-add-quot-DB-CLOSE-ON-EXIT-FALSE-quot-to-the-db-URL" class="headerlink" title="6.2 org.h2.jdbc.JdbcSQLException: Database is already closed (to disable automatic closing at VM shutdown, add &quot;;DB_CLOSE_ON_EXIT=FALSE&quot; to the db URL)"></a>6.2 <code>org.h2.jdbc.JdbcSQLException: Database is already closed (to disable automatic closing at VM shutdown, add &quot;;DB_CLOSE_ON_EXIT=FALSE&quot; to the db URL)</code></h4><ul><li>解决方法如下</li></ul><p>在数据库连接 url 后面追加上 <code>;DB_CLOSE_ON_EXIT=FALSE</code>, 具体如下</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span> <span class="string">local,default</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line"><span class="attr">  sampleapp:</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:h2:~/test;DB_CLOSE_ON_EXIT=FALSE</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">SA</span></span><br><span class="line"><span class="attr">    password:</span></span><br><span class="line"><span class="attr">    driverClassName:</span> <span class="string">org.h2.Driver</span></span><br><span class="line"><span class="attr">    defaultSchema:</span></span><br><span class="line"><span class="attr">    maxPoolSize:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="string">hbm2ddl.auto:</span> <span class="string">create-drop</span></span><br><span class="line"><span class="attr">      show_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      format_sql:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      dialect:</span> <span class="string">org.hibernate.dialect.H2Dialect</span></span><br></pre></td></tr></table></figure><h2 id="7-参考"><a href="#7-参考" class="headerlink" title="7 参考"></a>7 参考</h2><ul><li><a href="http://ckjava.com/2019/05/27/SpringBoot-jpa-RESTful-practice/">SpringBoot 集成 Jpa 实现单表 CRUD 功能并提供 RESTful api 服务</a></li></ul>]]></content>
    
    <summary type="html">
    
      本文将介绍如何在 SpringBoot 环境中编写独立于 Spring context 的 Jpa 单元测试，比如：单个 service, 单个 controller 的单元测试。
    
    </summary>
    
      <category term="SpringBoot" scheme="http://ckjava.com/categories/SpringBoot/"/>
    
    
      <category term="SpringBoot" scheme="http://ckjava.com/tags/SpringBoot/"/>
    
      <category term="jpa" scheme="http://ckjava.com/tags/jpa/"/>
    
      <category term="junit" scheme="http://ckjava.com/tags/junit/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 Lambda 表达式介绍</title>
    <link href="http://ckjava.com/2019/05/17/understand-Java-8-Lambda/"/>
    <id>http://ckjava.com/2019/05/17/understand-Java-8-Lambda/</id>
    <published>2019-05-16T16:00:00.000Z</published>
    <updated>2019-06-22T10:12:39.379Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-概要"><a href="#1-概要" class="headerlink" title="1 概要"></a>1 概要</h2><ul><li>Lambda 表达式，也可称为闭包或者内部类，返回的是一个接口的实例，是 Java 8 的最重要新特性。</li><li>使用 Lambda 表达式可以使代码变的更加简洁紧凑。</li></ul><h2 id="2-语法"><a href="#2-语法" class="headerlink" title="2 语法"></a>2 语法</h2><p>lambda 表达式的语法格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression</span><br></pre></td></tr></table></figure><p>或<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; &#123; statements; &#125;</span><br></pre></td></tr></table></figure></p><p>以下是 lambda 表达式的重要特征:</p><ol><li>可选类型声明：不需要声明参数类型，编译器可以统一识别参数值。</li><li>可选的参数圆括号：一个参数无需定义圆括号，但多个参数需要定义圆括号。</li><li>可选的大括号：如果主体包含了一个语句，就不需要使用大括号。</li><li>可选的返回关键字：如果主体只有一个表达式返回值则编译器会自动返回值，大括号需要指定明表达式返回了一个数值。</li></ol><h4 id="2-1-可选类型声明"><a href="#2-1-可选类型声明" class="headerlink" title="2.1 可选类型声明"></a>2.1 可选类型声明</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Append</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">doAppend</span><span class="params">(T t1, T t2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">append</span><span class="params">(T t1, T t2, Append&lt;T&gt; append)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> append.doAppend(t1, t2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    String str = AppendUtils.append(<span class="number">1</span>, <span class="number">2</span>, (Integer t1, Integer t2) -&gt; &#123;<span class="keyword">return</span> t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = AppendUtils.append(<span class="number">1</span>, <span class="number">2</span>, (t1, t2) -&gt; &#123;<span class="keyword">return</span> t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(Integer t1, Integer t2) -&gt; {return t1.toString() + t2.toString();}</code></li><li><code>(t1, t2) -&gt; {return t1.toString() + t2.toString();}</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的。</p><h4 id="2-2-可选的参数圆括号"><a href="#2-2-可选的参数圆括号" class="headerlink" title="2.2 可选的参数圆括号"></a>2.2 可选的参数圆括号</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StringParse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">parseString</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringParseUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">parse</span><span class="params">(T t, StringParse&lt;T&gt; stringParse)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stringParse.parseString(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String str = StringParseUtils.parse(<span class="number">1</span>, (t) -&gt; t.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = StringParseUtils.parse(<span class="number">1</span>, t -&gt; t.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(t) -&gt; t.toString()</code></li><li><code>t -&gt; t.toString()</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的。</p><h4 id="2-3-可选的大括号"><a href="#2-3-可选的大括号" class="headerlink" title="2.3 可选的大括号"></a>2.3 可选的大括号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2 () &#123;</span><br><span class="line">    String str = AppendUtils.append(1, 2, (Integer t1, Integer t2) -&gt; &#123;return t1.toString() + t2.toString();&#125;);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str = AppendUtils.append(1, 2, (t1, t2) -&gt; t1.toString() + t2.toString());</span><br><span class="line">    System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>(Integer t1, Integer t2) -&gt; {return t1.toString() + t2.toString();}</code></li><li><code>(t1, t2) -&gt; t1.toString() + t2.toString()</code></li></ul><p>上面的 Lambda 表达式实现的效果是一样的, 并且忽略了 return 关键字</p><h4 id="2-4-可选的返回关键字"><a href="#2-4-可选的返回关键字" class="headerlink" title="2.4 可选的返回关键字"></a>2.4 可选的返回关键字</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test5() throws Exception &#123;</span><br><span class="line">    ExecutorService executorService = Executors.newFixedThreadPool(1);</span><br><span class="line">    /*Future&lt;String&gt; future = executorService.submit(new Callable&lt;String&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public String call() throws Exception &#123;</span><br><span class="line">            return &quot;success&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);*/</span><br><span class="line"></span><br><span class="line">    Future&lt;String&gt; future = executorService.submit(() -&gt; &quot;success&quot;);</span><br><span class="line">    executorService.shutdown();</span><br><span class="line">    System.out.println(future.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>() -&gt; &quot;success&quot;</code> 是 <code>Callable</code> 的实例</li><li>如果没有参数必须要使用 <code>()</code></li><li>忽略了 return 关键字</li></ul><h2 id="3-需要注意的问题"><a href="#3-需要注意的问题" class="headerlink" title="3 需要注意的问题"></a>3 需要注意的问题</h2><ol><li>Lambda 表达式主要用来定义行内执行的方法类型接口，例如，一个简单方法接口。</li><li>Lambda 表达式免去了使用匿名方法的麻烦，并且给予 Java 简单但是强大的函数化的编程能力。</li></ol><h2 id="4-变量作用域"><a href="#4-变量作用域" class="headerlink" title="4 变量作用域"></a>4 变量作用域</h2><ol><li>Lambda 表达式本质上类似于内部类，跟 JavaScript 闭包一样，在 Java 中只能引用标记了 final 的外层局部变量，这就是说不能在 lambda 内部修改定义在域外的局部变量，否则会编译错误。</li></ol><p>定义接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface Converter&lt;T&gt; &#123;</span><br><span class="line">    String convert(T t1, T t2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面的 c 变量在 Lambda 表达式中不能被修改。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test6() &#123;</span><br><span class="line">    int a = 10;</span><br><span class="line">    int b = 10;</span><br><span class="line">    int c = 10;</span><br><span class="line"></span><br><span class="line">    Converter&lt;Integer&gt; converter = (t1, t2) -&gt; &#123;</span><br><span class="line">        // c += 10; 编译的时候报错</span><br><span class="line">        return String.valueOf(t1+t2+c);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    System.out.println(converter.convert(a, b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-参考"><a href="#5-参考" class="headerlink" title="5 参考"></a>5 参考</h2><ul><li><a href="https://www.runoob.com/java/java8-lambda-expressions.html" target="_blank" rel="noopener">Java 8 Lambda 表达式</a></li><li><a href="http://blog.oneapm.com/apm-tech/226.html" target="_blank" rel="noopener">深入浅出 Java 8 Lambda 表达式</a></li><li><a href="https://www.cnblogs.com/figure9/p/java-8-lambdas-insideout-language-features.html" target="_blank" rel="noopener">深入理解Java 8 Lambda（语言篇——lambda，方法引用，目标类型和默认方法）</a></li></ul>]]></content>
    
    <summary type="html">
    
      Java 8 Lambda 表达式介绍
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
      <category term="Lambda" scheme="http://ckjava.com/tags/Lambda/"/>
    
  </entry>
  
  <entry>
    <title>Java 8 中双冒号(method reference)的用法</title>
    <link href="http://ckjava.com/2019/05/14/understand-Java-8-method-reference/"/>
    <id>http://ckjava.com/2019/05/14/understand-Java-8-method-reference/</id>
    <published>2019-05-13T16:00:00.000Z</published>
    <updated>2019-06-22T10:12:37.160Z</updated>
    
    <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul><li>双冒号（::）是 Java 8 引入 Lambda 表达式后的一种用法，表示方法引用（method reference），可以更加简洁的实例化接口</li><li>双冒号表达式返回的是一个 函数式接口对象（用 @FunctionalInterface 注解的 interface 类型）的实例，如下：  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    Consumer&lt;Integer&gt; consumer = System.out::println;</span><br><span class="line">    list.forEach(consumer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// java.util.function.Consumer</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="方法引用-Method-Reference-具体使用"><a href="#方法引用-Method-Reference-具体使用" class="headerlink" title="方法引用 Method Reference 具体使用"></a>方法引用 Method Reference 具体使用</h2><ul><li>双冒号（::）运算符在 Java 8 中被用作方法引用（method reference），方法引用是与 lambda 表达式相关的一个重要特性。</li><li>它提供了一种不执行方法的方法：双冒号的方式只是指明方法引用，具体执行还是传统的方式。</li><li>方法引用需要兼容 函数式接口 组成的目标类型上下文：也就是说被引用的方法的参数和 函数式接口 的参数类型必须一致。</li><li>具体使用方式有以下几种<ol><li>静态方法引用(Reference to a static method)<ul><li>语法：ContainingClass::staticMethodName </li><li>例如：Person::getAge</li></ul></li><li>对象的实例方法引用(Reference to an instance method of a particular object)<ul><li>语法：containingObject::instanceMethodName</li><li>例如：System.out::println</li></ul></li><li>特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)<ul><li>语法：(ContainingType::methodName)</li><li>例如：String::compareToIgnoreCase</li></ul></li><li>类构造器引用语法(Reference to a constructor)：<ul><li>语法：ClassName::new </li><li>例如：ArrayList::new</li></ul></li></ol></li></ul><h4 id="1-静态方法引用-Reference-to-a-static-method"><a href="#1-静态方法引用-Reference-to-a-static-method" class="headerlink" title="1 静态方法引用(Reference to a static method)"></a>1 静态方法引用(Reference to a static method)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toUpperCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(str.toUpperCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">toInt</span><span class="params">(Long data)</span> </span>&#123;</span><br><span class="line">        System.out.println(data.intValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"aaaa"</span>, <span class="string">"bbbb"</span>, <span class="string">"cccc"</span>);</span><br><span class="line">    <span class="comment">// 参数是 String, 正确</span></span><br><span class="line">    list.forEach(StringUtils::toUpperCase);</span><br><span class="line">    <span class="comment">// 参数是 Long, 报错</span></span><br><span class="line">    <span class="comment">//list.forEach(StringUtils::toInt);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-对象的实例方法引用-Reference-to-an-instance-method-of-a-particular-object"><a href="#2-对象的实例方法引用-Reference-to-an-instance-method-of-a-particular-object" class="headerlink" title="2 对象的实例方法引用(Reference to an instance method of a particular object)"></a>2 对象的实例方法引用(Reference to an instance method of a particular object)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLowerCase</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(str.toLowerCase());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">"AAAA"</span>, <span class="string">"BBBB"</span>, <span class="string">"CCCC"</span>);</span><br><span class="line">    <span class="comment">// 参数是 String, 正确</span></span><br><span class="line">    list.forEach(<span class="keyword">new</span> StringUtils()::toLowerCase);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-特定类型的任意对象实例的方法-Reference-to-an-instance-method-of-an-arbitrary-object-of-a-particular-type"><a href="#3-特定类型的任意对象实例的方法-Reference-to-an-instance-method-of-an-arbitrary-object-of-a-particular-type" class="headerlink" title="3 特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)"></a>3 特定类型的任意对象实例的方法(Reference to an instance method of an arbitrary object of a particular type)</h4><ul><li>先看下官方的例子</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] stringArray = &#123; <span class="string">"Barbara"</span>, <span class="string">"James"</span>, <span class="string">"Mary"</span>, <span class="string">"John"</span>, <span class="string">"Patricia"</span>, <span class="string">"Robert"</span>, <span class="string">"Michael"</span>, <span class="string">"Linda"</span> &#125;;</span><br><span class="line">    Arrays.sort(stringArray, String::compareToIgnoreCase);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringArray.length; i++) &#123;</span><br><span class="line">        System.out.println(stringArray[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>String::compareToIgnoreCase</code>：看起来 compareToIgnoreCase 方法应该是 String 类的 static 方法，实际上不是，这怎么理解呢？下面来一一分解：</li></ul><ol><li>这里的 <code>particular type</code> 是指 String 类型</li><li><code>arbitrary object</code> 是指 String 对象</li><li><code>instance method</code> 是指 String 对象的 compareToIgnoreCase</li><li><code>Arrays.sort(stringArray, String::compareToIgnoreCase);</code> 用 lambda 可以写成 <code>Arrays.sort(stringArray, (o1, o2) -&gt; o1.compareToIgnoreCase(o2));</code></li><li>可见 <code>Arrays.sort(T[] a, Comparator&lt;? super T&gt; c)</code> 中的 Comparator 实例第一个参数 o1 为 String 对象本身，o2 为 compareToIgnoreCase 方法的第一个参数，如果还有 o3 那就是第二参数</li></ol><ul><li>基于上面的分析写个例子：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Append</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">append</span><span class="params">(StringAppend a, StringAppend b, StringAppend c)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringAppend</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringAppend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringAppend</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">append</span><span class="params">(StringAppend a, StringAppend b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getData() + a.getData() + b.getData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">doAppend</span><span class="params">(String[] arr, Append append)</span> </span>&#123;</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i+<span class="number">2</span> &lt;= arr.length-<span class="number">1</span>) &#123;</span><br><span class="line">                result += append.append(<span class="keyword">new</span> StringAppend(arr[i]), <span class="keyword">new</span> StringAppend(arr[i+<span class="number">1</span>]), <span class="keyword">new</span> StringAppend(arr[i+<span class="number">2</span>]));</span><br><span class="line">                i += <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += append.append(<span class="keyword">new</span> StringAppend(arr[i]), <span class="keyword">new</span> StringAppend(<span class="string">""</span>), <span class="keyword">new</span> StringAppend(<span class="string">""</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String[] stringArray = &#123; <span class="string">"Barbara"</span>, <span class="string">"James"</span>, <span class="string">"Mary"</span>, <span class="string">"John"</span>, <span class="string">"Mike"</span> &#125;;</span><br><span class="line">    String str1 = StringAppend.doAppend(stringArray, (t1,t2,t3) -&gt; t1.getData()+t2.getData()+t3.getData());</span><br><span class="line">    String str2 = StringAppend.doAppend(stringArray, StringAppend::append);</span><br><span class="line">    Assert.assertTrue(str1.equals(str2));</span><br><span class="line">    System.out.println(str1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终输出为: BarbaraJamesMaryJohnMike</p><h4 id="4-类构造函数用法-Reference-to-a-constructor"><a href="#4-类构造函数用法-Reference-to-a-constructor" class="headerlink" title="4 类构造函数用法(Reference to a constructor)"></a>4 类构造函数用法(Reference to a constructor)</h4><p>下面的 ITool 和 JSONTool 用于将字符串转成 JSON 字符串</p><ul><li>接口定义是传入一个字符串 name, 返回一个 JSONTool 对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITool</span> </span>&#123;</span><br><span class="line">    <span class="function">JSONTool <span class="title">create</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>JSONTool 类的构造函数：<code>public JSONTool(String name)</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONTool</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JSONTool</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JSONObject <span class="title">parseJSON</span><span class="params">(JSONTool jsonTool)</span> </span>&#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(jsonTool.getName(), jsonTool.getName());</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJSONString</span><span class="params">(String name, ITool iTool)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parseJSON(iTool.create(name)).toJSONString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>测试如下</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, JSONTool::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"a"</span>:<span class="string">"a"</span>&#125;</span><br></pre></td></tr></table></figure><p>上面的例子分析如下：</p><ol><li>从字面上看 JSONTool::new 返回的是 ITool 接口对象的实例</li><li>因此通过在 getJSONString 方法中调用 ITool 接口对象的实例的 create 方法返回一个 JSONTool 对象</li><li><p>通过 lambda 也可以返回一个 ITool 接口对象实例：<code>t -&gt; new JSONTool(t)</code>，因此测试代码写成下面的方式也可以</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", JSONTool::new));</span></span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, t -&gt; <span class="keyword">new</span> JSONTool(t)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>通过 Java 1.8 以前的匿名类方法如下</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", JSONTool::new));</span></span><br><span class="line">    <span class="comment">//System.out.println(JSONTool.getJSONString("a", t -&gt; new JSONTool(t)));</span></span><br><span class="line">    System.out.println(JSONTool.getJSONString(<span class="string">"a"</span>, <span class="keyword">new</span> ITool() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> JSONTool <span class="title">create</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JSONTool(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li>双冒号相比 Lambda 表达式更加简洁</li><li>将方法作为接口的实例来使用</li></ol><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/lsmsrc/article/details/41747159" target="_blank" rel="noopener">Java8中的[方法引用]“双冒号”——走进Java Lambda(四)</a></li><li><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html" target="_blank" rel="noopener">Java8 method references</a></li><li><a href="https://stackoverflow.com/questions/32855138/how-does-a-method-reference-to-an-instance-method-of-an-arbitrary-object-of-a-p?rq=1" target="_blank" rel="noopener">How does a method “reference to an instance method of an arbitrary object of a particular type” resolve the arbitrary object? </a></li></ul>]]></content>
    
    <summary type="html">
    
      Java 8 中双冒号(method reference)的用法
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Java8" scheme="http://ckjava.com/tags/Java8/"/>
    
  </entry>
  
  <entry>
    <title>Java Servlet 中两种重定向 forward 和 sendRedirect 的区分</title>
    <link href="http://ckjava.com/2019/04/25/Java-Servlet-sendRedirect-forward/"/>
    <id>http://ckjava.com/2019/04/25/Java-Servlet-sendRedirect-forward/</id>
    <published>2019-04-24T16:00:00.000Z</published>
    <updated>2019-06-22T10:45:41.461Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-示例代码"><a href="#1-示例代码" class="headerlink" title="1 示例代码"></a>1 示例代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/"</span>, method = RequestMethod.GET, produces = <span class="string">"text/plain;charset=UTF-8"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//request.getRequestDispatcher("/swagger-ui.html").forward(request, response);</span></span><br><span class="line">    response.sendRedirect(<span class="string">"/swagger-ui.html"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-forward"><a href="#2-forward" class="headerlink" title="2 forward"></a>2 forward</h2><p>简单来说：浏览器想请求 /a 的资源，但是服务器不告知浏览器真正的资源在 /b，直接将 /b 的内容返回给浏览器。</p><ul><li>服务器将 url 的资源直接解析后返回给浏览器</li><li>属于服务器内部跳转，浏览器地址栏的 url 不会发生变化</li><li>浏览器一共进行了一次请求</li></ul><h2 id="3-sendRedirect"><a href="#3-sendRedirect" class="headerlink" title="3 sendRedirect"></a>3 sendRedirect</h2><p>简单来说：浏览器想请求 /a 的资源，但是服务器告知真实的资源在 /b 那里，随后浏览器又去请求 /b 的资源。</p><p>关键点如下：</p><ul><li>服务器将 url 告知浏览器，浏览器随后再次请求 url，</li><li>浏览器地址栏的 url 会发生变化</li><li>服务器响应码为 302，Response Headers 的具体内容如下</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302</span><br><span class="line">Location: http://localhost:8011/swagger-ui.html</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Sun, 16 Dec 2018 03:57:12 GMT</span><br></pre></td></tr></table></figure><ul><li>浏览器一共进行了两次请求</li></ul>]]></content>
    
    <summary type="html">
    
      Java Servlet 中两种重定向 forward 和 sendRedirect 的区分
    
    </summary>
    
      <category term="Java" scheme="http://ckjava.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://ckjava.com/tags/Java/"/>
    
      <category term="Servlet" scheme="http://ckjava.com/tags/Servlet/"/>
    
  </entry>
  
</feed>
